<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 8.3.0" />
    <title>simmate.database.third_parties.webscraping.cod API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{display:none;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox">
            <div>
                        <a class="pdoc-button module-list-button" href="../webscraping.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;simmate.database.third_parties.webscraping</a>

<a href="https://github.com/jacksund/simmate">                        <img src="https://github.com/jacksund/simmate/blob/main/logo/simmate.svg?raw=true" class="logo" alt="project logo"/>
</a>
                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>



                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="function" href="#load_all_structures">load_all_structures</a>
            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/database/third_parties/webscraping/cod.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../../simmate.html">simmate</a><wbr>.<a href="./../../../database.html">database</a><wbr>.<a href="./../../third_parties.html">third_parties</a><wbr>.<a href="./../webscraping.html">webscraping</a><wbr>.cod    </h1>

                        <div class="docstring"><blockquote>
  <p>:warning: This file is only for use by the Simmate team. Users should instead
  access data via the load_remote_archive method.</p>
</blockquote>

<p>This file is for pulling COD data into the Simmate database. </p>

<p>The COD let's you download all of their data as a zip file 
<a href="http://www.crystallography.net/archives/">here</a>. While they do have a
REST API, it looks like they prefer you to use the zip file if you want all structures
and metadata. This is a big download even when compressed (18GB), so it's a slow
process -- but more importantly a stable one. For future reference though, the REST
API is outlined <a href="https://wiki.crystallography.net/RESTful_API/">here</a>.</p>

<p>Once downloaded, all of the cif files are organized into folders based on their first
few numbers -- for example, the cif 1234567 would be in folder /cif/1/23/45/1234567.cif
It's an odd way of storing the files, but we just need to script open all of the folders.
Note that some folders also don't have any cifs in them! There is also extra data
in each cif file -- such as the doi of the paper it came from.</p>

<p>There looks to be a lot of problematic cif files in the COD, but it's not worth parsing
through all of these. Instead, I simply try to load the cif file into a pymatgen
Structure object, and if it fails, I just move on. I'm slowly adding functionality
to account for these problematic cif files though.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">&gt; :warning: This file is only for use by the Simmate team. Users should instead</span>
<span class="sd">access data via the load_remote_archive method.</span>

<span class="sd">This file is for pulling COD data into the Simmate database. </span>

<span class="sd">The COD let&#39;s you download all of their data as a zip file </span>
<span class="sd">[here](http://www.crystallography.net/archives/). While they do have a</span>
<span class="sd">REST API, it looks like they prefer you to use the zip file if you want all structures</span>
<span class="sd">and metadata. This is a big download even when compressed (18GB), so it&#39;s a slow</span>
<span class="sd">process -- but more importantly a stable one. For future reference though, the REST</span>
<span class="sd">API is outlined [here](https://wiki.crystallography.net/RESTful_API/).</span>

<span class="sd">Once downloaded, all of the cif files are organized into folders based on their first</span>
<span class="sd">few numbers -- for example, the cif 1234567 would be in folder /cif/1/23/45/1234567.cif</span>
<span class="sd">It&#39;s an odd way of storing the files, but we just need to script open all of the folders.</span>
<span class="sd">Note that some folders also don&#39;t have any cifs in them! There is also extra data</span>
<span class="sd">in each cif file -- such as the doi of the paper it came from.</span>

<span class="sd">There looks to be a lot of problematic cif files in the COD, but it&#39;s not worth parsing</span>
<span class="sd">through all of these. Instead, I simply try to load the cif file into a pymatgen</span>
<span class="sd">Structure object, and if it fails, I just move on. I&#39;m slowly adding functionality</span>
<span class="sd">to account for these problematic cif files though.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.cif</span> <span class="kn">import</span> <span class="n">CifParser</span>

<span class="kn">from</span> <span class="nn">simmate.database.third_parties</span> <span class="kn">import</span> <span class="n">CodStructure</span>
<span class="kn">from</span> <span class="nn">simmate.utilities</span> <span class="kn">import</span> <span class="n">get_sanitized_structure</span>

<span class="c1"># --------------------------------------------------------------------------------------</span>


<span class="k">def</span> <span class="nf">load_all_structures</span><span class="p">(</span><span class="n">base_directory</span><span class="o">=</span><span class="s2">&quot;cod/cif/&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Only use this function if you are part of the Simmate dev team!</span>

<span class="sd">    Loads all structures directly for the COD database into the local</span>
<span class="sd">    Simmate database.</span>

<span class="sd">    Make sure you have downloaded the</span>
<span class="sd">    [COD archive]([here](http://www.crystallography.net/archives/))</span>
<span class="sd">    and have it upacked to match your base_directory input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># For debuging and development, I keep track of all cif files that fail, and I</span>
    <span class="c1"># also keep track of all possible data in the cif files.</span>
    <span class="n">all_keywords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">failed_cifs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># We need to look at all the folders that have numbered-names (1,2,3..,9). and</span>
    <span class="c1"># grab the folder inside that are also numbers. This continues until we find cif</span>
    <span class="c1"># files that we can pull structures from. Note the name of the cif file is also</span>
    <span class="c1"># the cod-id.</span>
    <span class="c1"># We also use tqdm to monitor progress.</span>
    <span class="k">for</span> <span class="n">folder_name1</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)):</span>

        <span class="c1"># skip if the folder name isn&#39;t a number</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_name1</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># otherwise go through the folders inside of this one</span>
        <span class="k">for</span> <span class="n">folder_name2</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="n">folder_name1</span><span class="p">)):</span>
            <span class="c1"># and then one more level until we hit the cifs!</span>
            <span class="k">for</span> <span class="n">folder_name3</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="n">folder_name1</span><span class="p">,</span> <span class="n">folder_name2</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># we now have all the foldernames we need. Let&#39;s record the full path</span>
                <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">base_directory</span><span class="p">,</span> <span class="n">folder_name1</span><span class="p">,</span> <span class="n">folder_name2</span><span class="p">,</span> <span class="n">folder_name3</span>
                <span class="p">)</span>

                <span class="c1"># now go through each cif file in this directory</span>
                <span class="k">for</span> <span class="n">cif_filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>

                    <span class="c1"># construct the full path to the file we are after</span>
                    <span class="n">cif_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>

                        <span class="c1"># Load the structure and extra data from the cif file.</span>
                        <span class="c1"># Note, some occupancies are not scaled to sum to 1. For</span>
                        <span class="c1"># example, a disordered site may have [Ca:1, Sr:1] instead of</span>
                        <span class="c1"># [Ca:0.5, Sr:0.5]. By setting our occupancy tolerance to</span>
                        <span class="c1"># infinity, we allow this  let pymatgen scale the occupancies</span>
                        <span class="c1"># so they sum to 1.</span>
                        <span class="n">cif</span> <span class="o">=</span> <span class="n">CifParser</span><span class="p">(</span>
                            <span class="n">cif_filepath</span><span class="p">,</span>
                            <span class="n">occupancy_tolerance</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                        <span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

                        <span class="c1"># pull out the structure</span>
                        <span class="c1"># note we use CifParser.get_structures instead of</span>
                        <span class="c1"># Structure.from_file because we wanted the extra data too.</span>
                        <span class="c1"># The COD has a lot of structures that aren&#39;t formatted properly</span>
                        <span class="c1"># and various errors are thrown throughout the loading process.</span>
                        <span class="c1"># for now, I just skip the ones that give issues.</span>
                        <span class="c1"># !!! I should take a closer look at failed cifs in the future.</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">structure</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">get_structures</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                            <span class="c1"># There is a common error where no structure is found, but</span>
                            <span class="c1"># if this error ends up being something different, we should</span>
                            <span class="c1"># make sure it&#39;s raised for visibility.</span>
                            <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">!=</span> <span class="p">(</span><span class="s2">&quot;Invalid cif file with no structures!&quot;</span><span class="p">,):</span>
                                <span class="k">raise</span> <span class="n">error</span>
                            <span class="c1"># otherwise skip to the next cif file</span>
                            <span class="k">continue</span>

                        <span class="c1"># Run symmetry analysis and sanitization on the structure</span>
                        <span class="n">structure_sanitized</span> <span class="o">=</span> <span class="n">get_sanitized_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span>
                            <span class="s2">&quot;Structure has implicit hydrogens defined, parsed structure&quot;</span>
                            <span class="s2">&quot; unlikely to be suitable for use in calculations unless&quot;</span>
                            <span class="s2">&quot; hydrogens added.&quot;</span> <span class="ow">in</span> <span class="n">cif</span><span class="o">.</span><span class="n">warnings</span>
                        <span class="p">):</span>
                            <span class="n">has_implicit_hydrogens</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">has_implicit_hydrogens</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="c1"># Check that there aren&#39;t any new keywords. If any are new,</span>
                        <span class="c1"># add them to our list.</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">header</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_keywords</span><span class="p">:</span>
                                    <span class="n">all_keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

                        <span class="c1"># Compile all of our data into a dictionary</span>
                        <span class="n">entry_dict</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="c1"># the split removes &quot;.cif&quot; from each file name and</span>
                            <span class="c1"># the remaining number is the id</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;cod-&quot;</span> <span class="o">+</span> <span class="n">cif_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="n">structure_sanitized</span><span class="p">,</span>
                            <span class="s2">&quot;is_ordered&quot;</span><span class="p">:</span> <span class="n">structure</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">,</span>
                            <span class="s2">&quot;has_implicit_hydrogens&quot;</span><span class="p">:</span> <span class="n">has_implicit_hydrogens</span><span class="p">,</span>
                            <span class="c1"># OPTMIZE: right now I use the title of the paper,</span>
                            <span class="c1"># but I would much rather use the DOI as it&#39;s shorter</span>
                            <span class="c1"># and more useful. But a lot of cifs are missing the</span>
                            <span class="c1"># _journal_paper_doi... This should be fixed.</span>
                            <span class="c1"># &quot;paper_title&quot;: data[key].get(&quot;_publ_section_title&quot;),</span>
                        <span class="p">}</span>

                        <span class="c1"># now convert the entry to a database object</span>
                        <span class="n">structure_db</span> <span class="o">=</span> <span class="n">CodStructure</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry_dict</span><span class="p">)</span>

                        <span class="c1"># and save it to our database!</span>
                        <span class="n">structure_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                    <span class="k">except</span><span class="p">:</span>  <span class="c1"># there are a bunch of different Exceptions...</span>
                        <span class="n">failed_cifs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cif_filepath</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">failed_cifs</span><span class="p">)))</span>
                        <span class="k">continue</span>  <span class="c1"># skip to the next structure</span>

    <span class="c1"># when all structures are done, let&#39;s write the list of headers and the list</span>
    <span class="c1"># of failed calculations to a file for storing.</span>
    <span class="c1"># OPTIMIZE: it may be worth storing these in the database too.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;failed_cifs.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">failed_cifs</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;all_keywords.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">all_keywords</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;failed_cifs&quot;</span><span class="p">:</span> <span class="n">failed_cifs</span><span class="p">,</span>
        <span class="s2">&quot;all_keywords&quot;</span><span class="p">:</span> <span class="n">all_keywords</span><span class="p">,</span>
    <span class="p">}</span>


<span class="c1"># --------------------------------------------------------------------------------------</span>

<span class="c1"># This a list of all CIF keywords that are seen in the COD database. Here, I go</span>
<span class="c1"># through all of them and decide which to remove and which to store. The removed</span>
<span class="c1"># keywords are commented out and I add an explanation as to why. For determining</span>
<span class="c1"># the meaning of each keyword, look here:</span>
<span class="c1">#   https://www.iucr.org/resources/cif/dictionaries/search</span>
<span class="n">cif_keywords</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># I&#39;m removing _atom_rho_multipole_* and _atom_local_axes_* keywords for now.</span>
    <span class="c1"># These are composed of electron density information and I should consider</span>
    <span class="c1"># adding a separate django model to store this information.</span>
    <span class="c1"># https://www.iucr.org/__data/iucr/cifdic_html/1/cif_rho.dic/index.html</span>
    <span class="c1"># &quot;_atom_local_axes_atom0&quot;,</span>
    <span class="c1"># &quot;_atom_local_axes_atom1&quot;,</span>
    <span class="c1"># &quot;_atom_local_axes_atom2&quot;,</span>
    <span class="c1"># &quot;_atom_local_axes_atom_label&quot;,</span>
    <span class="c1"># &quot;_atom_local_axes_ax1&quot;,</span>
    <span class="c1"># &quot;_atom_local_axes_ax2&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_atom_label&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P00&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P1-1&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P10&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P11&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P2-1&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P2-2&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P20&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P21&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P22&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P3-1&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P3-2&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P3-3&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P30&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P31&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P32&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P33&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P4-1&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P4-2&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P4-3&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P4-4&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P40&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P41&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P42&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P43&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_P44&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_coeff_Pv&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_kappa&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_kappa_prime0&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_kappa_prime1&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_kappa_prime2&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_kappa_prime3&quot;,</span>
    <span class="c1"># &quot;_atom_rho_multipole_kappa_prime4&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># These _atom_* keywords are part of the core library. The main data will</span>
    <span class="c1"># stored in the pymatgen structure we pull out, but I may need to return to</span>
    <span class="c1"># some keywords. See here:</span>
    <span class="c1">#   https://www.iucr.org/__data/iucr/cifdic_html/1/cif_core.dic/index.html</span>
    <span class="c1"># &quot;_atom_site_B_iso_or_equiv&quot;,</span>
    <span class="c1"># &quot;_atom_site_U_iso_or_equiv&quot;,</span>
    <span class="c1"># &quot;_atom_site_Wyckoff_symbol&quot;,</span>
    <span class="c1"># &quot;_atom_site_adp_type&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_U_11&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_U_12&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_U_13&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_U_22&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_U_23&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_U_33&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_label&quot;,</span>
    <span class="c1"># &quot;_atom_site_aniso_type_symbol&quot;,</span>
    <span class="c1"># &quot;_atom_site_attached_hydrogens&quot;,</span>
    <span class="c1"># &quot;_atom_site_calc_flag&quot;,</span>
    <span class="c1"># &quot;_atom_site_disorder_assembly&quot;,</span>
    <span class="c1"># &quot;_atom_site_disorder_group&quot;,</span>
    <span class="c1"># &quot;_atom_site_fract_x&quot;,</span>
    <span class="c1"># &quot;_atom_site_fract_y&quot;,</span>
    <span class="c1"># &quot;_atom_site_fract_z&quot;,</span>
    <span class="c1"># &quot;_atom_site_label&quot;,</span>
    <span class="c1"># &quot;_atom_site_occupancy&quot;,</span>
    <span class="c1"># &quot;_atom_site_refinement_flags&quot;,</span>
    <span class="c1"># &quot;_atom_site_refinement_flags_adp&quot;,</span>
    <span class="c1"># &quot;_atom_site_refinement_flags_occupancy&quot;,</span>
    <span class="c1"># &quot;_atom_site_refinement_flags_posn&quot;,</span>
    <span class="c1"># &quot;_atom_site_site_symmetry_multiplicity&quot;,</span>
    <span class="c1"># &quot;_atom_site_site_symmetry_order&quot;,</span>
    <span class="c1"># &quot;_atom_site_symmetry_multiplicity&quot;,</span>
    <span class="c1"># &quot;_atom_site_thermal_displace_type&quot;,</span>
    <span class="c1"># &quot;_atom_site_type_symbol&quot;,</span>
    <span class="c1"># &quot;_atom_sites_solution_hydrogens&quot;,</span>
    <span class="c1"># &quot;_atom_sites_solution_primary&quot;,</span>
    <span class="c1"># &quot;_atom_sites_solution_secondary&quot;,</span>
    <span class="c1"># &quot;_atom_type_description&quot;,</span>
    <span class="c1"># &quot;_atom_type_oxidation_number&quot;,</span>
    <span class="c1"># &quot;_atom_type_scat_dispersion_imag&quot;,</span>
    <span class="c1"># &quot;_atom_type_scat_dispersion_real&quot;,</span>
    <span class="c1"># &quot;_atom_type_scat_source&quot;,</span>
    <span class="c1"># &quot;_atom_type_symbol&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># The _audit_* keywords hold information about the creation and subsequent</span>
    <span class="c1"># updating of the cif file.</span>
    <span class="c1"># &quot;_audit_block_code&quot;,</span>
    <span class="c1"># &quot;_audit_conform_dict_location&quot;,</span>
    <span class="c1"># &quot;_audit_conform_dict_name&quot;,</span>
    <span class="c1"># &quot;_audit_conform_dict_version&quot;,</span>
    <span class="c1"># &quot;_audit_creation_date&quot;,</span>
    <span class="c1"># &quot;_audit_creation_method&quot;,</span>
    <span class="c1"># &quot;_audit_update_record&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># These keywords are simply the lattice, which are stored via pymatgen.</span>
    <span class="c1"># &quot;_cell_angle_alpha&quot;,</span>
    <span class="c1"># &quot;_cell_angle_beta&quot;,</span>
    <span class="c1"># &quot;_cell_angle_gamma&quot;,</span>
    <span class="c1"># &quot;_cell_formula_units_Z&quot;,</span>
    <span class="c1"># &quot;_cell_length_a&quot;,</span>
    <span class="c1"># &quot;_cell_length_b&quot;,</span>
    <span class="c1"># &quot;_cell_length_c&quot;,</span>
    <span class="c1"># &quot;_cell_volume&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># This includes important experimental information for how the lattice was</span>
    <span class="c1"># determined.</span>
    <span class="c1"># &quot;_cell_measurement_reflns_used&quot;,</span>
    <span class="c1"># &quot;_cell_measurement_temperature&quot;,</span>
    <span class="c1"># &quot;_cell_measurement_theta_max&quot;,</span>
    <span class="c1"># &quot;_cell_measurement_theta_min&quot;,</span>
    <span class="c1"># &quot;_cell_measurement_wavelength&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># This is simple composition information that we get from the pymatgen structure</span>
    <span class="c1"># anyways.</span>
    <span class="c1"># &quot;_chemical_formula_analytical&quot;,</span>
    <span class="c1"># &quot;_chemical_formula_iupac&quot;,</span>
    <span class="c1"># &quot;_chemical_formula_moiety&quot;,</span>
    <span class="c1"># &quot;_chemical_formula_structural&quot;,</span>
    <span class="c1"># &quot;_chemical_formula_sum&quot;,</span>
    <span class="c1"># &quot;_chemical_formula_weight&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Important information for how the compsition was determined and how the aquired</span>
    <span class="c1"># same was aquired.</span>
    <span class="c1"># &quot;_chemical_absolute_configuration&quot;,</span>
    <span class="c1"># &quot;_chemical_compound_source&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Important information about the physical properties of the compound.</span>
    <span class="c1"># &quot;_chemical_melting_point&quot;,</span>
    <span class="c1"># &quot;_chemical_melting_point_gt&quot;,</span>
    <span class="c1"># &quot;_chemical_melting_point_lt&quot;,</span>
    <span class="c1"># &quot;_chemical_properties_physical&quot;,</span>
    <span class="c1"># &quot;_chemical_temperature_decomposition_gt&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># I remove naming for now, but I may want to re-add these for the mineral</span>
    <span class="c1"># names.</span>
    <span class="c1"># &quot;_chemical_name_common&quot;,</span>
    <span class="c1"># &quot;_chemical_name_mineral&quot;,</span>
    <span class="c1"># &quot;_chemical_name_systematic&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># These properties aren&#39;t shown on https://www.iucr.org/ so I remove them.</span>
    <span class="c1"># &quot;_chemical_oxdiff_formula&quot;,</span>
    <span class="c1"># &quot;_chemical_oxdiff_usercomment&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Important COD information. Some of this I remove for not being particularly</span>
    <span class="c1"># useful in a secondary database.</span>
    <span class="s2">&quot;_cod_data_source_block&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_data_source_file&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_database_code&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_database_fobs_code&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_depositor_comments&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_duplicate_entry&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;_cod_original_cell_volume&quot;,</span>
    <span class="c1"># &quot;_cod_original_formula_sum&quot;,</span>
    <span class="c1"># &quot;_cod_original_sg_symbol_H-M&quot;,</span>
    <span class="c1"># &quot;_cod_original_sg_symbol_Hall&quot;,</span>
    <span class="s2">&quot;_cod_related_entry_code&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_related_entry_database&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_related_entry_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_cod_struct_determination_method&quot;</span><span class="p">,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># The _computing_* keywords contain information about the computer software</span>
    <span class="c1"># used to perform the analysis.</span>
    <span class="c1"># &quot;_computing_cell_refinement&quot;,</span>
    <span class="c1"># &quot;_computing_data_collection&quot;,</span>
    <span class="c1"># &quot;_computing_data_reduction&quot;,</span>
    <span class="c1"># &quot;_computing_molecular_graphics&quot;,</span>
    <span class="c1"># &quot;_computing_publication_material&quot;,</span>
    <span class="c1"># &quot;_computing_structure_refinement&quot;,</span>
    <span class="c1"># &quot;_computing_structure_solution&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Important information about the experimental conditions, where _diffrn_*</span>
    <span class="c1"># relate to DURING diffraction, while _exptl_* are BEFORE diffraction.</span>
    <span class="c1"># There is a lot of information here, including the spectrum aquired. This</span>
    <span class="c1"># is worth putting into a separate django Model to store.</span>
    <span class="c1"># &quot;_diffrn_ambient_environment&quot;,</span>
    <span class="c1"># &quot;_diffrn_ambient_pressure&quot;,</span>
    <span class="c1"># &quot;_diffrn_ambient_temperature&quot;,</span>
    <span class="c1"># &quot;_diffrn_detector&quot;,</span>
    <span class="c1"># &quot;_diffrn_detector_area_resol_mean&quot;,</span>
    <span class="c1"># &quot;_diffrn_detector_type&quot;,</span>
    <span class="c1"># &quot;_diffrn_measured_fraction_theta_full&quot;,</span>
    <span class="c1"># &quot;_diffrn_measured_fraction_theta_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_measurement_details&quot;,</span>
    <span class="c1"># &quot;_diffrn_measurement_device&quot;,</span>
    <span class="c1"># &quot;_diffrn_measurement_device_details&quot;,</span>
    <span class="c1"># &quot;_diffrn_measurement_device_type&quot;,</span>
    <span class="c1"># &quot;_diffrn_measurement_method&quot;,</span>
    <span class="c1"># &quot;_diffrn_measurement_specimen_support&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_11&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_12&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_13&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_21&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_22&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_23&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_31&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_32&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_UB_33&quot;,</span>
    <span class="c1"># &quot;_diffrn_orient_matrix_type&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_collimation&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_detector&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_monochromator&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_probe&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_source&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_type&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_wavelength&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_wavelength_wt&quot;,</span>
    <span class="c1"># &quot;_diffrn_radiation_xray_symbol&quot;,</span>
    <span class="c1"># &quot;_diffrn_refln_index_h&quot;,</span>
    <span class="c1"># &quot;_diffrn_refln_index_k&quot;,</span>
    <span class="c1"># &quot;_diffrn_refln_index_l&quot;,</span>
    <span class="c1"># &quot;_diffrn_refln_intensity_net&quot;,</span>
    <span class="c1"># &quot;_diffrn_refln_intensity_u&quot;,</span>
    <span class="c1"># &quot;_diffrn_refln_scale_group_code&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_Laue_measured_fraction_full&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_Laue_measured_fraction_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_av_R_equivalents&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_av_sigmaI/netI&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_av_unetI/netI&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_laue_measured_fraction_full&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_laue_measured_fraction_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_limit_h_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_limit_h_min&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_limit_k_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_limit_k_min&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_limit_l_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_limit_l_min&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_number&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_point_group_measured_fraction_full&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_point_group_measured_fraction_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_reduction_process&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_theta_full&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_theta_max&quot;,</span>
    <span class="c1"># &quot;_diffrn_reflns_theta_min&quot;,</span>
    <span class="c1"># &quot;_diffrn_source&quot;,</span>
    <span class="c1"># &quot;_diffrn_source_current&quot;,</span>
    <span class="c1"># &quot;_diffrn_source_power&quot;,</span>
    <span class="c1"># &quot;_diffrn_source_target&quot;,</span>
    <span class="c1"># &quot;_diffrn_source_type&quot;,</span>
    <span class="c1"># &quot;_diffrn_source_voltage&quot;,</span>
    <span class="c1"># &quot;_diffrn_standards_decay_%&quot;,</span>
    <span class="c1"># &quot;_diffrn_standards_interval_count&quot;,</span>
    <span class="c1"># &quot;_diffrn_standards_interval_time&quot;,</span>
    <span class="c1"># &quot;_diffrn_standards_number&quot;,</span>
    <span class="c1"># &quot;_exptl_absorpt_coefficient_mu&quot;,</span>
    <span class="c1"># &quot;_exptl_absorpt_correction_T_max&quot;,</span>
    <span class="c1"># &quot;_exptl_absorpt_correction_T_min&quot;,</span>
    <span class="c1"># &quot;_exptl_absorpt_correction_type&quot;,</span>
    <span class="c1"># &quot;_exptl_absorpt_process_details&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_F_000&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_colour&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_colour_lustre&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_colour_modifier&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_colour_primary&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_density_diffrn&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_density_meas&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_density_method&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_description&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_face_index_h&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_face_index_k&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_face_index_l&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_face_perp_dist&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_preparation&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_pressure_history&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_recrystallization_method&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_size_max&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_size_mid&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_size_min&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_size_rad&quot;,</span>
    <span class="c1"># &quot;_exptl_crystal_thermal_history&quot;,</span>
    <span class="c1"># &quot;_exptl_oxdiff_crystal_face_indexfrac_h&quot;,</span>
    <span class="c1"># &quot;_exptl_oxdiff_crystal_face_indexfrac_k&quot;,</span>
    <span class="c1"># &quot;_exptl_oxdiff_crystal_face_indexfrac_l&quot;,</span>
    <span class="c1"># &quot;_exptl_oxdiff_crystal_face_x&quot;,</span>
    <span class="c1"># &quot;_exptl_oxdiff_crystal_face_y&quot;,</span>
    <span class="c1"># &quot;_exptl_oxdiff_crystal_face_z&quot;,</span>
    <span class="c1"># &quot;_exptl_transmission_factor_max&quot;,</span>
    <span class="c1"># &quot;_exptl_transmission_factor_min&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># All _geom_* keywords are redundant and can be calculated by other methods.</span>
    <span class="c1"># Read more here:</span>
    <span class="c1">#   https://www.iucr.org/__data/iucr/cifdic_html/1/cif_core.dic/Cgeom.html</span>
    <span class="c1"># &quot;_geom_angle&quot;,</span>
    <span class="c1"># &quot;_geom_angle_atom_site_label_1&quot;,</span>
    <span class="c1"># &quot;_geom_angle_atom_site_label_2&quot;,</span>
    <span class="c1"># &quot;_geom_angle_atom_site_label_3&quot;,</span>
    <span class="c1"># &quot;_geom_angle_publ_flag&quot;,</span>
    <span class="c1"># &quot;_geom_angle_site_symmetry_1&quot;,</span>
    <span class="c1"># &quot;_geom_angle_site_symmetry_2&quot;,</span>
    <span class="c1"># &quot;_geom_angle_site_symmetry_3&quot;,</span>
    <span class="c1"># &quot;_geom_bond_atom_site_label_1&quot;,</span>
    <span class="c1"># &quot;_geom_bond_atom_site_label_2&quot;,</span>
    <span class="c1"># &quot;_geom_bond_distance&quot;,</span>
    <span class="c1"># &quot;_geom_bond_publ_flag&quot;,</span>
    <span class="c1"># &quot;_geom_bond_site_symmetry_1&quot;,</span>
    <span class="c1"># &quot;_geom_bond_site_symmetry_2&quot;,</span>
    <span class="c1"># &quot;_geom_contact_atom_site_label_1&quot;,</span>
    <span class="c1"># &quot;_geom_contact_atom_site_label_2&quot;,</span>
    <span class="c1"># &quot;_geom_contact_distance&quot;,</span>
    <span class="c1"># &quot;_geom_contact_publ_flag&quot;,</span>
    <span class="c1"># &quot;_geom_contact_site_symmetry_2&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_angle_DHA&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_atom_site_label_A&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_atom_site_label_D&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_atom_site_label_H&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_distance_DA&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_distance_DH&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_distance_HA&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_publ_flag&quot;,</span>
    <span class="c1"># &quot;_geom_hbond_site_symmetry_A&quot;,</span>
    <span class="c1"># &quot;_geom_torsion&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_atom_site_label_1&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_atom_site_label_2&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_atom_site_label_3&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_atom_site_label_4&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_publ_flag&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_site_symmetry_1&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_site_symmetry_2&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_site_symmetry_3&quot;,</span>
    <span class="c1"># &quot;_geom_torsion_site_symmetry_4&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Important information about where the data was originally published. Ideally,</span>
    <span class="c1"># I would only ever want to store the doi, but it looks like many COD structures</span>
    <span class="c1"># are missing this entry.</span>
    <span class="s2">&quot;_journal_coden_ASTM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_issue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_name_full&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_page_first&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_page_last&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_paper_doi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_volume&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_journal_year&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_author_name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_contact_author&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_contact_author_address&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_contact_author_email&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_contact_author_name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_contact_author_phone&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_publ_section_title&quot;</span><span class="p">,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># These keywords should be clumped in with _computing_* ones because they</span>
    <span class="c1"># are each for a specific software and the details on its setup.</span>
    <span class="c1"># &quot;_olex2_date_sample_data_collection&quot;,</span>
    <span class="c1"># &quot;_olex2_date_sample_submission&quot;,</span>
    <span class="c1"># &quot;_olex2_diffrn_ambient_temperature_device&quot;,</span>
    <span class="c1"># &quot;_olex2_exptl_crystal_mounting_method&quot;,</span>
    <span class="c1"># &quot;_olex2_refinement_description&quot;,</span>
    <span class="c1"># &quot;_olex2_submission_original_sample_id&quot;,</span>
    <span class="c1"># &quot;_olex2_submission_special_instructions&quot;,</span>
    <span class="c1"># &quot;_shelx_estimated_absorpt_t_max&quot;,</span>
    <span class="c1"># &quot;_shelx_estimated_absorpt_t_min&quot;,</span>
    <span class="c1"># &quot;_shelx_fab_checksum&quot;,</span>
    <span class="c1"># &quot;_shelx_fab_file&quot;,</span>
    <span class="c1"># &quot;_shelx_hkl_checksum&quot;,</span>
    <span class="c1"># &quot;_shelx_hkl_file&quot;,</span>
    <span class="c1"># &quot;_shelx_res_checksum&quot;,</span>
    <span class="c1"># &quot;_shelx_res_file&quot;,</span>
    <span class="c1"># &quot;_shelx_shelxl_version_number&quot;,</span>
    <span class="c1"># &quot;_shelx_space_group_comment&quot;,</span>
    <span class="c1"># &quot;_shelxl_hkl_file&quot;,</span>
    <span class="c1"># &quot;_shelxl_res_file&quot;,</span>
    <span class="c1"># &quot;_shelxl_version_number&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_average_x&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_average_y&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_average_z&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_content&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_count_electrons&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_nr&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_probe_radius&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_truncation_radius&quot;,</span>
    <span class="c1"># &quot;_smtbx_masks_void_volume&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_details&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_average_x&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_average_y&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_average_z&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_content&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_count_electrons&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_nr&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_probe_radius&quot;,</span>
    <span class="c1"># &quot;_platon_squeeze_void_volume&quot;,</span>
    <span class="c1"># &quot;_iucr_refine_instructions_details&quot;,</span>
    <span class="c1"># &quot;_iucr_refine_reflections_details&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># !!! unknown</span>
    <span class="c1"># &quot;_oxdiff_exptl_absorpt_empirical_details&quot;,</span>
    <span class="c1"># &quot;_oxdiff_exptl_absorpt_empirical_full_max&quot;,</span>
    <span class="c1"># &quot;_oxdiff_exptl_absorpt_empirical_full_min&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># All _pd_* keywords contain information about powder diffraction. It may</span>
    <span class="c1"># be worth combining with the _diffrn_* section. Read more here:</span>
    <span class="c1">#   https://www.iucr.org/__data/iucr/cifdic_html/1/cif_pd.dic/index.html</span>
    <span class="c1"># &quot;_pd_char_colour&quot;,</span>
    <span class="c1"># &quot;_pd_meas_2theta_range_inc&quot;,</span>
    <span class="c1"># &quot;_pd_meas_2theta_range_max&quot;,</span>
    <span class="c1"># &quot;_pd_meas_2theta_range_min&quot;,</span>
    <span class="c1"># &quot;_pd_meas_scan_method&quot;,</span>
    <span class="c1"># &quot;_pd_proc_ls_pref_orient_corr&quot;,</span>
    <span class="c1"># &quot;_pd_proc_ls_prof_R_factor&quot;,</span>
    <span class="c1"># &quot;_pd_proc_ls_prof_wR_expected&quot;,</span>
    <span class="c1"># &quot;_pd_proc_ls_prof_wR_factor&quot;,</span>
    <span class="c1"># &quot;_pd_proc_ls_profile_function&quot;,</span>
    <span class="c1"># &quot;_pd_proc_number_of_points&quot;,</span>
    <span class="c1"># &quot;_pd_spec_mount_mode&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Important information about the structure refinement and how it was done.</span>
    <span class="c1"># Consider joining with software details (_computing_*)</span>
    <span class="c1"># &quot;_refine_diff_density_max&quot;,</span>
    <span class="c1"># &quot;_refine_diff_density_min&quot;,</span>
    <span class="c1"># &quot;_refine_diff_density_rms&quot;,</span>
    <span class="c1"># &quot;_refine_ls_R_I_factor&quot;,</span>
    <span class="c1"># &quot;_refine_ls_R_factor_all&quot;,</span>
    <span class="c1"># &quot;_refine_ls_R_factor_gt&quot;,</span>
    <span class="c1"># &quot;_refine_ls_R_factor_obs&quot;,</span>
    <span class="c1"># &quot;_refine_ls_abs_structure_Flack&quot;,</span>
    <span class="c1"># &quot;_refine_ls_abs_structure_details&quot;,</span>
    <span class="c1"># &quot;_refine_ls_coordinate_system&quot;,</span>
    <span class="c1"># &quot;_refine_ls_extinction_coef&quot;,</span>
    <span class="c1"># &quot;_refine_ls_extinction_expression&quot;,</span>
    <span class="c1"># &quot;_refine_ls_extinction_method&quot;,</span>
    <span class="c1"># &quot;_refine_ls_goodness_of_fit_all&quot;,</span>
    <span class="c1"># &quot;_refine_ls_goodness_of_fit_gt&quot;,</span>
    <span class="c1"># &quot;_refine_ls_goodness_of_fit_ref&quot;,</span>
    <span class="c1"># &quot;_refine_ls_hydrogen_treatment&quot;,</span>
    <span class="c1"># &quot;_refine_ls_matrix_type&quot;,</span>
    <span class="c1"># &quot;_refine_ls_number_constraints&quot;,</span>
    <span class="c1"># &quot;_refine_ls_number_parameters&quot;,</span>
    <span class="c1"># &quot;_refine_ls_number_reflns&quot;,</span>
    <span class="c1"># &quot;_refine_ls_number_restraints&quot;,</span>
    <span class="c1"># &quot;_refine_ls_restrained_S_all&quot;,</span>
    <span class="c1"># &quot;_refine_ls_shift/su_max&quot;,</span>
    <span class="c1"># &quot;_refine_ls_shift/su_mean&quot;,</span>
    <span class="c1"># &quot;_refine_ls_structure_factor_coef&quot;,</span>
    <span class="c1"># &quot;_refine_ls_svd_threshold&quot;,</span>
    <span class="c1"># &quot;_refine_ls_wR_factor_all&quot;,</span>
    <span class="c1"># &quot;_refine_ls_wR_factor_gt&quot;,</span>
    <span class="c1"># &quot;_refine_ls_wR_factor_obs&quot;,</span>
    <span class="c1"># &quot;_refine_ls_wR_factor_ref&quot;,</span>
    <span class="c1"># &quot;_refine_ls_weighting_details&quot;,</span>
    <span class="c1"># &quot;_refine_ls_weighting_scheme&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># !!! How do these differ from _diffrn_refln_* ?? Consider joining this data</span>
    <span class="c1"># with that section.</span>
    <span class="c1"># &quot;_refln_F_squared_meas&quot;,</span>
    <span class="c1"># &quot;_refln_F_squared_sigma&quot;,</span>
    <span class="c1"># &quot;_refln_index_h&quot;,</span>
    <span class="c1"># &quot;_refln_index_k&quot;,</span>
    <span class="c1"># &quot;_refln_index_l&quot;,</span>
    <span class="c1"># &quot;_refln_scale_group_code&quot;,</span>
    <span class="c1"># &quot;_reflns.d_resolution_high&quot;,</span>
    <span class="c1"># &quot;_reflns.d_resolution_low&quot;,</span>
    <span class="c1"># &quot;_reflns_Friedel_coverage&quot;,</span>
    <span class="c1"># &quot;_reflns_Friedel_fraction_full&quot;,</span>
    <span class="c1"># &quot;_reflns_Friedel_fraction_max&quot;,</span>
    <span class="c1"># &quot;_reflns_number_gt&quot;,</span>
    <span class="c1"># &quot;_reflns_number_total&quot;,</span>
    <span class="c1"># &quot;_reflns_odcompleteness_completeness&quot;,</span>
    <span class="c1"># &quot;_reflns_odcompleteness_iscentric&quot;,</span>
    <span class="c1"># &quot;_reflns_odcompleteness_theta&quot;,</span>
    <span class="c1"># &quot;_reflns_threshold_expression&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># This is extra information that can be reattained in pymatgen.</span>
    <span class="c1"># &quot;_space_group_IT_number&quot;,</span>
    <span class="c1"># &quot;_space_group_crystal_system&quot;,</span>
    <span class="c1"># &quot;_space_group_name_H-M_alt&quot;,</span>
    <span class="c1"># &quot;_space_group_name_Hall&quot;,</span>
    <span class="c1"># &quot;_space_group_symop_id&quot;,</span>
    <span class="c1"># &quot;_space_group_symop_operation_xyz&quot;,</span>
    <span class="c1"># &quot;_symmetry_Int_Tables_number&quot;,</span>
    <span class="c1"># &quot;_symmetry_cell_setting&quot;,</span>
    <span class="c1"># &quot;_symmetry_equiv_pos_as_xyz&quot;,</span>
    <span class="c1"># &quot;_symmetry_equiv_pos_site_id&quot;,</span>
    <span class="c1"># &quot;_symmetry_space_group_name_H-M&quot;,</span>
    <span class="c1"># &quot;_symmetry_space_group_name_Hall&quot;,</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># !!! unknown keywords</span>
    <span class="c1"># &quot;_twin_individual_id&quot;,</span>
    <span class="c1"># &quot;_twin_individual_mass_fraction_refined&quot;,</span>
    <span class="c1"># &quot;_citation_journal_id_ASTM&quot;,</span>
    <span class="c1"># &quot;_database_code_amcsd&quot;,</span>
<span class="p">]</span>
</pre></div>

        </details>

            </section>
                <section id="load_all_structures">
                            <div class="attr function"><a class="headerlink" href="#load_all_structures">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">load_all_structures</span><span class="signature">(base_directory=&#39;cod/cif/&#39;)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_all_structures</span><span class="p">(</span><span class="n">base_directory</span><span class="o">=</span><span class="s2">&quot;cod/cif/&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Only use this function if you are part of the Simmate dev team!</span>

<span class="sd">    Loads all structures directly for the COD database into the local</span>
<span class="sd">    Simmate database.</span>

<span class="sd">    Make sure you have downloaded the</span>
<span class="sd">    [COD archive]([here](http://www.crystallography.net/archives/))</span>
<span class="sd">    and have it upacked to match your base_directory input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># For debuging and development, I keep track of all cif files that fail, and I</span>
    <span class="c1"># also keep track of all possible data in the cif files.</span>
    <span class="n">all_keywords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">failed_cifs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># We need to look at all the folders that have numbered-names (1,2,3..,9). and</span>
    <span class="c1"># grab the folder inside that are also numbers. This continues until we find cif</span>
    <span class="c1"># files that we can pull structures from. Note the name of the cif file is also</span>
    <span class="c1"># the cod-id.</span>
    <span class="c1"># We also use tqdm to monitor progress.</span>
    <span class="k">for</span> <span class="n">folder_name1</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)):</span>

        <span class="c1"># skip if the folder name isn&#39;t a number</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_name1</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># otherwise go through the folders inside of this one</span>
        <span class="k">for</span> <span class="n">folder_name2</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="n">folder_name1</span><span class="p">)):</span>
            <span class="c1"># and then one more level until we hit the cifs!</span>
            <span class="k">for</span> <span class="n">folder_name3</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="n">folder_name1</span><span class="p">,</span> <span class="n">folder_name2</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># we now have all the foldernames we need. Let&#39;s record the full path</span>
                <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">base_directory</span><span class="p">,</span> <span class="n">folder_name1</span><span class="p">,</span> <span class="n">folder_name2</span><span class="p">,</span> <span class="n">folder_name3</span>
                <span class="p">)</span>

                <span class="c1"># now go through each cif file in this directory</span>
                <span class="k">for</span> <span class="n">cif_filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>

                    <span class="c1"># construct the full path to the file we are after</span>
                    <span class="n">cif_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>

                        <span class="c1"># Load the structure and extra data from the cif file.</span>
                        <span class="c1"># Note, some occupancies are not scaled to sum to 1. For</span>
                        <span class="c1"># example, a disordered site may have [Ca:1, Sr:1] instead of</span>
                        <span class="c1"># [Ca:0.5, Sr:0.5]. By setting our occupancy tolerance to</span>
                        <span class="c1"># infinity, we allow this  let pymatgen scale the occupancies</span>
                        <span class="c1"># so they sum to 1.</span>
                        <span class="n">cif</span> <span class="o">=</span> <span class="n">CifParser</span><span class="p">(</span>
                            <span class="n">cif_filepath</span><span class="p">,</span>
                            <span class="n">occupancy_tolerance</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                        <span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

                        <span class="c1"># pull out the structure</span>
                        <span class="c1"># note we use CifParser.get_structures instead of</span>
                        <span class="c1"># Structure.from_file because we wanted the extra data too.</span>
                        <span class="c1"># The COD has a lot of structures that aren&#39;t formatted properly</span>
                        <span class="c1"># and various errors are thrown throughout the loading process.</span>
                        <span class="c1"># for now, I just skip the ones that give issues.</span>
                        <span class="c1"># !!! I should take a closer look at failed cifs in the future.</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">structure</span> <span class="o">=</span> <span class="n">cif</span><span class="o">.</span><span class="n">get_structures</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                            <span class="c1"># There is a common error where no structure is found, but</span>
                            <span class="c1"># if this error ends up being something different, we should</span>
                            <span class="c1"># make sure it&#39;s raised for visibility.</span>
                            <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">!=</span> <span class="p">(</span><span class="s2">&quot;Invalid cif file with no structures!&quot;</span><span class="p">,):</span>
                                <span class="k">raise</span> <span class="n">error</span>
                            <span class="c1"># otherwise skip to the next cif file</span>
                            <span class="k">continue</span>

                        <span class="c1"># Run symmetry analysis and sanitization on the structure</span>
                        <span class="n">structure_sanitized</span> <span class="o">=</span> <span class="n">get_sanitized_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span>
                            <span class="s2">&quot;Structure has implicit hydrogens defined, parsed structure&quot;</span>
                            <span class="s2">&quot; unlikely to be suitable for use in calculations unless&quot;</span>
                            <span class="s2">&quot; hydrogens added.&quot;</span> <span class="ow">in</span> <span class="n">cif</span><span class="o">.</span><span class="n">warnings</span>
                        <span class="p">):</span>
                            <span class="n">has_implicit_hydrogens</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">has_implicit_hydrogens</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="c1"># Check that there aren&#39;t any new keywords. If any are new,</span>
                        <span class="c1"># add them to our list.</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">header</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_keywords</span><span class="p">:</span>
                                    <span class="n">all_keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

                        <span class="c1"># Compile all of our data into a dictionary</span>
                        <span class="n">entry_dict</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="c1"># the split removes &quot;.cif&quot; from each file name and</span>
                            <span class="c1"># the remaining number is the id</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;cod-&quot;</span> <span class="o">+</span> <span class="n">cif_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="n">structure_sanitized</span><span class="p">,</span>
                            <span class="s2">&quot;is_ordered&quot;</span><span class="p">:</span> <span class="n">structure</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">,</span>
                            <span class="s2">&quot;has_implicit_hydrogens&quot;</span><span class="p">:</span> <span class="n">has_implicit_hydrogens</span><span class="p">,</span>
                            <span class="c1"># OPTMIZE: right now I use the title of the paper,</span>
                            <span class="c1"># but I would much rather use the DOI as it&#39;s shorter</span>
                            <span class="c1"># and more useful. But a lot of cifs are missing the</span>
                            <span class="c1"># _journal_paper_doi... This should be fixed.</span>
                            <span class="c1"># &quot;paper_title&quot;: data[key].get(&quot;_publ_section_title&quot;),</span>
                        <span class="p">}</span>

                        <span class="c1"># now convert the entry to a database object</span>
                        <span class="n">structure_db</span> <span class="o">=</span> <span class="n">CodStructure</span><span class="o">.</span><span class="n">from_toolkit</span><span class="p">(</span><span class="o">**</span><span class="n">entry_dict</span><span class="p">)</span>

                        <span class="c1"># and save it to our database!</span>
                        <span class="n">structure_db</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                    <span class="k">except</span><span class="p">:</span>  <span class="c1"># there are a bunch of different Exceptions...</span>
                        <span class="n">failed_cifs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cif_filepath</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">failed_cifs</span><span class="p">)))</span>
                        <span class="k">continue</span>  <span class="c1"># skip to the next structure</span>

    <span class="c1"># when all structures are done, let&#39;s write the list of headers and the list</span>
    <span class="c1"># of failed calculations to a file for storing.</span>
    <span class="c1"># OPTIMIZE: it may be worth storing these in the database too.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;failed_cifs.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">failed_cifs</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;all_keywords.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">all_keywords</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;failed_cifs&quot;</span><span class="p">:</span> <span class="n">failed_cifs</span><span class="p">,</span>
        <span class="s2">&quot;all_keywords&quot;</span><span class="p">:</span> <span class="n">all_keywords</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>

        </details>

            <div class="docstring"><p>Only use this function if you are part of the Simmate dev team!</p>

<p>Loads all structures directly for the COD database into the local
Simmate database.</p>

<p>Make sure you have downloaded the
<a href="[here](http://www.crystallography.net/archives/)">COD archive</a>
and have it upacked to match your base_directory input.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>