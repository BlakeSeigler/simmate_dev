<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.1.0"/>
    <title>simmate.workflow_engine.common_tasks.load_input_and_register API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../common_tasks.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.workflow_engine.common_tasks</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#LoadInputAndRegister">LoadInputAndRegister</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LoadInputAndRegister.__init__">LoadInputAndRegister</a>
                        </li>
                        <li>
                                <a class="function" href="#LoadInputAndRegister.run">run</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/workflow_engine/common_tasks/load_input_and_register.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../simmate.html">simmate</a><wbr>.<a href="./../../workflow_engine.html">workflow_engine</a><wbr>.<a href="./../common_tasks.html">common_tasks</a><wbr>.load_input_and_register    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="L-0"><a href="#L-0"><span class="linenos">  0</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">yaml</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">prefect</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">Task</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">simmate.utilities</span> <span class="kn">import</span> <span class="n">get_directory</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">simmate.toolkit</span> <span class="kn">import</span> <span class="n">Structure</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">simmate.database.base_data_types</span> <span class="kn">import</span> <span class="n">DatabaseTable</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># OPTIMIZE: consider splitting this task into load_structure, load_directory,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># and register_calc so that our flow_visualize looks cleaner</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">LoadInputAndRegister</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>        <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>        <span class="n">input_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>        <span class="n">calculation_table</span><span class="p">:</span> <span class="n">DatabaseTable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="p">):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_name</span> <span class="o">=</span> <span class="n">workflow_name</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_obj_name</span> <span class="o">=</span> <span class="n">input_obj_name</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span> <span class="o">=</span> <span class="n">calculation_table</span>  <span class="c1"># If None, registration is skipped</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="n">input_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="n">input_class</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="n">source</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="n">copy_previous_directory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        How the input was submitted as a parameter depends on if we are submitting</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">        to Prefect Cloud, running the flow locally, or even continuing from a</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        previous calculation.  Here, we use a task to convert the input to a toolkit</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        object and (if requested) provide the directory as well.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        input_class is any class that has a from_dynamic method accepts the</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        input_obj format. In the large majority of cases, this is just</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        a Structure object so we use that as the default.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        directory is optional</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        copy_previous_directory is only used when we are pulling a structure from a</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        previous calculation. If copy_previous_directory=True, then the directory</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        parameter is ignored.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        **kwargs is anything extra that you want saved to simmate_metadata.yaml</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="c1"># First we load the structure to a toolkit structure object</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">input_cleaned</span> <span class="o">=</span> <span class="n">input_class</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">input_obj</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="c1"># Now let&#39;s load the directory</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="c1"># Start by creating a new directory or grabbing the one given. We create</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="c1"># this directly immediately (rather than just passing the name to the</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="c1"># S3Task). We do this because NestedWorkflows often use a parent directory</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="c1"># to organize results.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="n">directory_cleaned</span> <span class="o">=</span> <span class="n">get_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="c1"># if the user requested, we grab the previous directory as well</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="n">copy_previous_directory</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>            <span class="c1"># catch incorrect use of this function</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>                    <span class="s2">&quot;There isn&#39;t a previous directory available! Your source &quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>                    <span class="s2">&quot;structure must point to a past calculation to use this feature.&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>                <span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>            <span class="c1"># the past directory should be stored on the input object</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">previous_directory</span> <span class="o">=</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">calculation</span><span class="o">.</span><span class="n">directory</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="c1"># First check if the previous directory exists. There are several</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="c1"># possibilities that we need to check for:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="c1">#   1. directory exists on the same file system and can be found</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>            <span class="c1">#   2. directory exists on the same file system but is now an archive</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>            <span class="c1">#   3. directory/archive is on another file system (requires ssh to access)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            <span class="c1">#   4. directory was deleted and unavailable</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="c1"># When copying over the directory, we ignore any `simmate_` files</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="c1"># that correspond to metadata/results/corrections/etc.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">):</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                <span class="c1"># copy the old directory to the new one</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                    <span class="n">src</span><span class="o">=</span><span class="n">previous_directory</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                    <span class="n">dst</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;simmate_*&quot;</span><span class="p">),</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">):</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="c1"># unpack the old archive</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                    <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                    <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">),</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                <span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>                <span class="c1"># copy the old directory to the new one</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>                    <span class="n">src</span><span class="o">=</span><span class="n">previous_directory</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                    <span class="n">dst</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;simmate_*&quot;</span><span class="p">),</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                <span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                <span class="c1"># Then remove the unpacked archive now that we copied it.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                <span class="c1"># This leaves the original archive behind and unaltered too.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                    <span class="s2">&quot;Unable to locate the previous calculation to copy. Make sure the &quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                    <span class="s2">&quot;past directory is located on the same file system. Directory that &quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>                    <span class="sa">f</span><span class="s2">&quot;couldn&#39;t be found was... </span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                <span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="c1"># TODO: for possibility 3, I could implement automatic copying with</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="c1"># the &quot;fabric&quot; python package (uses ssh). I&#39;d also need to store</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="c1"># filesystem names (e.g. &quot;WarWulf&quot;) to know where to connect.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="c1"># Load the source of the input object</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="c1"># If we were given a input from a previous calculation, the source should</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="c1"># point directory to that same input. Otherwise we are incorrectly trying</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="c1"># to change what the source is.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="n">source</span> <span class="ow">and</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="c1"># note input_obj here is a dictionary</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="k">assert</span> <span class="n">source</span> <span class="o">==</span> <span class="n">input_obj</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="k">elif</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="n">input_obj</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">elif</span> <span class="n">source</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="c1"># Register the calculation so the user can follow along in the UI.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="c1"># This is only done if a table is provided. Some special-case workflows</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="c1"># don&#39;t store calculation information bc the flow is just a quick python</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="c1"># analysis.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="n">prefect_flow_run_id</span> <span class="o">=</span> <span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">flow_run_id</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="c1"># load/create the calculation for this workflow run</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                <span class="c1"># We pass the initial input_obj in case the calculation wasn&#39;t created</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="c1"># yet (and creation requires the structure)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">input_cleaned</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                <span class="c1"># BUG: what if the initial structure changed? An example of this happening</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                <span class="c1"># is with a relaxation where a correction was applied and the calc</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="c1"># was not fully restarted. This issue also will not matter when</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                <span class="c1"># workflows are ran through cloud -- as the structure is already</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                <span class="c1"># saved and won&#39;t be overwritten here.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source_cleaned</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="c1"># Lastly, we want to write a file summarizing the inputs used for this</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="c1"># workflow run. This allows future users to reproduce the results if</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="c1"># desired -- and it also allows us to load old results into a database.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="n">input_summary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="n">workflow_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_name</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source_cleaned</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="n">directory</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="c1"># this ID is ingored as an input but needed for loading past data</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="n">prefect_flow_run_id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="c1"># As a final thing to add, we want the input_obj, but we want to save</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># this to the proper input name. Also, this input should either be a</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="c1"># dictionary or a python object, where we convert to a dictionary in</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="c1"># order to write to file.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="n">input_dict</span> <span class="o">=</span> <span class="n">input_obj</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">input_obj</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">input_summary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_obj_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_dict</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="c1"># now write the summary to file in the same directory as the calc.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">input_summary_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="n">directory_cleaned</span><span class="p">,</span> <span class="s2">&quot;simmate_metadata.yaml&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_summary_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">input_summary</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="c1"># the rest of the calculation doesn&#39;t need the source (that was only for</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># registering the calc), so we just return the pymatgen structure and dir</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="n">input_cleaned</span><span class="p">,</span> <span class="n">directory_cleaned</span>
</span></pre></div>

        </details>

            </section>
                <section id="LoadInputAndRegister">
                                <div class="attr class">
        <a class="headerlink" href="#LoadInputAndRegister">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">LoadInputAndRegister</span><wbr>(<span class="base">prefect.core.task.Task</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LoadInputAndRegister-20"><a href="#LoadInputAndRegister-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">LoadInputAndRegister</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
</span><span id="LoadInputAndRegister-21"><a href="#LoadInputAndRegister-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-22"><a href="#LoadInputAndRegister-22"><span class="linenos"> 22</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-23"><a href="#LoadInputAndRegister-23"><span class="linenos"> 23</span></a>        <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-24"><a href="#LoadInputAndRegister-24"><span class="linenos"> 24</span></a>        <span class="n">input_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-25"><a href="#LoadInputAndRegister-25"><span class="linenos"> 25</span></a>        <span class="n">calculation_table</span><span class="p">:</span> <span class="n">DatabaseTable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-26"><a href="#LoadInputAndRegister-26"><span class="linenos"> 26</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-27"><a href="#LoadInputAndRegister-27"><span class="linenos"> 27</span></a>    <span class="p">):</span>
</span><span id="LoadInputAndRegister-28"><a href="#LoadInputAndRegister-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_name</span> <span class="o">=</span> <span class="n">workflow_name</span>
</span><span id="LoadInputAndRegister-29"><a href="#LoadInputAndRegister-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_obj_name</span> <span class="o">=</span> <span class="n">input_obj_name</span>
</span><span id="LoadInputAndRegister-30"><a href="#LoadInputAndRegister-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span> <span class="o">=</span> <span class="n">calculation_table</span>  <span class="c1"># If None, registration is skipped</span>
</span><span id="LoadInputAndRegister-31"><a href="#LoadInputAndRegister-31"><span class="linenos"> 31</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="LoadInputAndRegister-32"><a href="#LoadInputAndRegister-32"><span class="linenos"> 32</span></a>
</span><span id="LoadInputAndRegister-33"><a href="#LoadInputAndRegister-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-34"><a href="#LoadInputAndRegister-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-35"><a href="#LoadInputAndRegister-35"><span class="linenos"> 35</span></a>        <span class="n">input_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-36"><a href="#LoadInputAndRegister-36"><span class="linenos"> 36</span></a>        <span class="n">input_class</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-37"><a href="#LoadInputAndRegister-37"><span class="linenos"> 37</span></a>        <span class="n">source</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-38"><a href="#LoadInputAndRegister-38"><span class="linenos"> 38</span></a>        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-39"><a href="#LoadInputAndRegister-39"><span class="linenos"> 39</span></a>        <span class="n">copy_previous_directory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-40"><a href="#LoadInputAndRegister-40"><span class="linenos"> 40</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-41"><a href="#LoadInputAndRegister-41"><span class="linenos"> 41</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="LoadInputAndRegister-42"><a href="#LoadInputAndRegister-42"><span class="linenos"> 42</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="LoadInputAndRegister-43"><a href="#LoadInputAndRegister-43"><span class="linenos"> 43</span></a><span class="sd">        How the input was submitted as a parameter depends on if we are submitting</span>
</span><span id="LoadInputAndRegister-44"><a href="#LoadInputAndRegister-44"><span class="linenos"> 44</span></a><span class="sd">        to Prefect Cloud, running the flow locally, or even continuing from a</span>
</span><span id="LoadInputAndRegister-45"><a href="#LoadInputAndRegister-45"><span class="linenos"> 45</span></a><span class="sd">        previous calculation.  Here, we use a task to convert the input to a toolkit</span>
</span><span id="LoadInputAndRegister-46"><a href="#LoadInputAndRegister-46"><span class="linenos"> 46</span></a><span class="sd">        object and (if requested) provide the directory as well.</span>
</span><span id="LoadInputAndRegister-47"><a href="#LoadInputAndRegister-47"><span class="linenos"> 47</span></a>
</span><span id="LoadInputAndRegister-48"><a href="#LoadInputAndRegister-48"><span class="linenos"> 48</span></a><span class="sd">        input_class is any class that has a from_dynamic method accepts the</span>
</span><span id="LoadInputAndRegister-49"><a href="#LoadInputAndRegister-49"><span class="linenos"> 49</span></a><span class="sd">        input_obj format. In the large majority of cases, this is just</span>
</span><span id="LoadInputAndRegister-50"><a href="#LoadInputAndRegister-50"><span class="linenos"> 50</span></a><span class="sd">        a Structure object so we use that as the default.</span>
</span><span id="LoadInputAndRegister-51"><a href="#LoadInputAndRegister-51"><span class="linenos"> 51</span></a>
</span><span id="LoadInputAndRegister-52"><a href="#LoadInputAndRegister-52"><span class="linenos"> 52</span></a><span class="sd">        directory is optional</span>
</span><span id="LoadInputAndRegister-53"><a href="#LoadInputAndRegister-53"><span class="linenos"> 53</span></a>
</span><span id="LoadInputAndRegister-54"><a href="#LoadInputAndRegister-54"><span class="linenos"> 54</span></a><span class="sd">        copy_previous_directory is only used when we are pulling a structure from a</span>
</span><span id="LoadInputAndRegister-55"><a href="#LoadInputAndRegister-55"><span class="linenos"> 55</span></a><span class="sd">        previous calculation. If copy_previous_directory=True, then the directory</span>
</span><span id="LoadInputAndRegister-56"><a href="#LoadInputAndRegister-56"><span class="linenos"> 56</span></a><span class="sd">        parameter is ignored.</span>
</span><span id="LoadInputAndRegister-57"><a href="#LoadInputAndRegister-57"><span class="linenos"> 57</span></a>
</span><span id="LoadInputAndRegister-58"><a href="#LoadInputAndRegister-58"><span class="linenos"> 58</span></a><span class="sd">        **kwargs is anything extra that you want saved to simmate_metadata.yaml</span>
</span><span id="LoadInputAndRegister-59"><a href="#LoadInputAndRegister-59"><span class="linenos"> 59</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LoadInputAndRegister-60"><a href="#LoadInputAndRegister-60"><span class="linenos"> 60</span></a>
</span><span id="LoadInputAndRegister-61"><a href="#LoadInputAndRegister-61"><span class="linenos"> 61</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister-62"><a href="#LoadInputAndRegister-62"><span class="linenos"> 62</span></a>
</span><span id="LoadInputAndRegister-63"><a href="#LoadInputAndRegister-63"><span class="linenos"> 63</span></a>        <span class="c1"># First we load the structure to a toolkit structure object</span>
</span><span id="LoadInputAndRegister-64"><a href="#LoadInputAndRegister-64"><span class="linenos"> 64</span></a>
</span><span id="LoadInputAndRegister-65"><a href="#LoadInputAndRegister-65"><span class="linenos"> 65</span></a>        <span class="n">input_cleaned</span> <span class="o">=</span> <span class="n">input_class</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">input_obj</span><span class="p">)</span>
</span><span id="LoadInputAndRegister-66"><a href="#LoadInputAndRegister-66"><span class="linenos"> 66</span></a>
</span><span id="LoadInputAndRegister-67"><a href="#LoadInputAndRegister-67"><span class="linenos"> 67</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister-68"><a href="#LoadInputAndRegister-68"><span class="linenos"> 68</span></a>
</span><span id="LoadInputAndRegister-69"><a href="#LoadInputAndRegister-69"><span class="linenos"> 69</span></a>        <span class="c1"># Now let&#39;s load the directory</span>
</span><span id="LoadInputAndRegister-70"><a href="#LoadInputAndRegister-70"><span class="linenos"> 70</span></a>
</span><span id="LoadInputAndRegister-71"><a href="#LoadInputAndRegister-71"><span class="linenos"> 71</span></a>        <span class="c1"># Start by creating a new directory or grabbing the one given. We create</span>
</span><span id="LoadInputAndRegister-72"><a href="#LoadInputAndRegister-72"><span class="linenos"> 72</span></a>        <span class="c1"># this directly immediately (rather than just passing the name to the</span>
</span><span id="LoadInputAndRegister-73"><a href="#LoadInputAndRegister-73"><span class="linenos"> 73</span></a>        <span class="c1"># S3Task). We do this because NestedWorkflows often use a parent directory</span>
</span><span id="LoadInputAndRegister-74"><a href="#LoadInputAndRegister-74"><span class="linenos"> 74</span></a>        <span class="c1"># to organize results.</span>
</span><span id="LoadInputAndRegister-75"><a href="#LoadInputAndRegister-75"><span class="linenos"> 75</span></a>        <span class="n">directory_cleaned</span> <span class="o">=</span> <span class="n">get_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="LoadInputAndRegister-76"><a href="#LoadInputAndRegister-76"><span class="linenos"> 76</span></a>
</span><span id="LoadInputAndRegister-77"><a href="#LoadInputAndRegister-77"><span class="linenos"> 77</span></a>        <span class="c1"># if the user requested, we grab the previous directory as well</span>
</span><span id="LoadInputAndRegister-78"><a href="#LoadInputAndRegister-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="n">copy_previous_directory</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-79"><a href="#LoadInputAndRegister-79"><span class="linenos"> 79</span></a>
</span><span id="LoadInputAndRegister-80"><a href="#LoadInputAndRegister-80"><span class="linenos"> 80</span></a>            <span class="c1"># catch incorrect use of this function</span>
</span><span id="LoadInputAndRegister-81"><a href="#LoadInputAndRegister-81"><span class="linenos"> 81</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-82"><a href="#LoadInputAndRegister-82"><span class="linenos"> 82</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-83"><a href="#LoadInputAndRegister-83"><span class="linenos"> 83</span></a>                    <span class="s2">&quot;There isn&#39;t a previous directory available! Your source &quot;</span>
</span><span id="LoadInputAndRegister-84"><a href="#LoadInputAndRegister-84"><span class="linenos"> 84</span></a>                    <span class="s2">&quot;structure must point to a past calculation to use this feature.&quot;</span>
</span><span id="LoadInputAndRegister-85"><a href="#LoadInputAndRegister-85"><span class="linenos"> 85</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister-86"><a href="#LoadInputAndRegister-86"><span class="linenos"> 86</span></a>
</span><span id="LoadInputAndRegister-87"><a href="#LoadInputAndRegister-87"><span class="linenos"> 87</span></a>            <span class="c1"># the past directory should be stored on the input object</span>
</span><span id="LoadInputAndRegister-88"><a href="#LoadInputAndRegister-88"><span class="linenos"> 88</span></a>            <span class="n">previous_directory</span> <span class="o">=</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">calculation</span><span class="o">.</span><span class="n">directory</span>
</span><span id="LoadInputAndRegister-89"><a href="#LoadInputAndRegister-89"><span class="linenos"> 89</span></a>
</span><span id="LoadInputAndRegister-90"><a href="#LoadInputAndRegister-90"><span class="linenos"> 90</span></a>            <span class="c1"># First check if the previous directory exists. There are several</span>
</span><span id="LoadInputAndRegister-91"><a href="#LoadInputAndRegister-91"><span class="linenos"> 91</span></a>            <span class="c1"># possibilities that we need to check for:</span>
</span><span id="LoadInputAndRegister-92"><a href="#LoadInputAndRegister-92"><span class="linenos"> 92</span></a>            <span class="c1">#   1. directory exists on the same file system and can be found</span>
</span><span id="LoadInputAndRegister-93"><a href="#LoadInputAndRegister-93"><span class="linenos"> 93</span></a>            <span class="c1">#   2. directory exists on the same file system but is now an archive</span>
</span><span id="LoadInputAndRegister-94"><a href="#LoadInputAndRegister-94"><span class="linenos"> 94</span></a>            <span class="c1">#   3. directory/archive is on another file system (requires ssh to access)</span>
</span><span id="LoadInputAndRegister-95"><a href="#LoadInputAndRegister-95"><span class="linenos"> 95</span></a>            <span class="c1">#   4. directory was deleted and unavailable</span>
</span><span id="LoadInputAndRegister-96"><a href="#LoadInputAndRegister-96"><span class="linenos"> 96</span></a>            <span class="c1"># When copying over the directory, we ignore any `simmate_` files</span>
</span><span id="LoadInputAndRegister-97"><a href="#LoadInputAndRegister-97"><span class="linenos"> 97</span></a>            <span class="c1"># that correspond to metadata/results/corrections/etc.</span>
</span><span id="LoadInputAndRegister-98"><a href="#LoadInputAndRegister-98"><span class="linenos"> 98</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">):</span>
</span><span id="LoadInputAndRegister-99"><a href="#LoadInputAndRegister-99"><span class="linenos"> 99</span></a>                <span class="c1"># copy the old directory to the new one</span>
</span><span id="LoadInputAndRegister-100"><a href="#LoadInputAndRegister-100"><span class="linenos">100</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-101"><a href="#LoadInputAndRegister-101"><span class="linenos">101</span></a>                    <span class="n">src</span><span class="o">=</span><span class="n">previous_directory</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-102"><a href="#LoadInputAndRegister-102"><span class="linenos">102</span></a>                    <span class="n">dst</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-103"><a href="#LoadInputAndRegister-103"><span class="linenos">103</span></a>                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;simmate_*&quot;</span><span class="p">),</span>
</span><span id="LoadInputAndRegister-104"><a href="#LoadInputAndRegister-104"><span class="linenos">104</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-105"><a href="#LoadInputAndRegister-105"><span class="linenos">105</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister-106"><a href="#LoadInputAndRegister-106"><span class="linenos">106</span></a>            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">):</span>
</span><span id="LoadInputAndRegister-107"><a href="#LoadInputAndRegister-107"><span class="linenos">107</span></a>                <span class="c1"># unpack the old archive</span>
</span><span id="LoadInputAndRegister-108"><a href="#LoadInputAndRegister-108"><span class="linenos">108</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-109"><a href="#LoadInputAndRegister-109"><span class="linenos">109</span></a>                    <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-110"><a href="#LoadInputAndRegister-110"><span class="linenos">110</span></a>                    <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">),</span>
</span><span id="LoadInputAndRegister-111"><a href="#LoadInputAndRegister-111"><span class="linenos">111</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister-112"><a href="#LoadInputAndRegister-112"><span class="linenos">112</span></a>                <span class="c1"># copy the old directory to the new one</span>
</span><span id="LoadInputAndRegister-113"><a href="#LoadInputAndRegister-113"><span class="linenos">113</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-114"><a href="#LoadInputAndRegister-114"><span class="linenos">114</span></a>                    <span class="n">src</span><span class="o">=</span><span class="n">previous_directory</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-115"><a href="#LoadInputAndRegister-115"><span class="linenos">115</span></a>                    <span class="n">dst</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-116"><a href="#LoadInputAndRegister-116"><span class="linenos">116</span></a>                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;simmate_*&quot;</span><span class="p">),</span>
</span><span id="LoadInputAndRegister-117"><a href="#LoadInputAndRegister-117"><span class="linenos">117</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-118"><a href="#LoadInputAndRegister-118"><span class="linenos">118</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister-119"><a href="#LoadInputAndRegister-119"><span class="linenos">119</span></a>                <span class="c1"># Then remove the unpacked archive now that we copied it.</span>
</span><span id="LoadInputAndRegister-120"><a href="#LoadInputAndRegister-120"><span class="linenos">120</span></a>                <span class="c1"># This leaves the original archive behind and unaltered too.</span>
</span><span id="LoadInputAndRegister-121"><a href="#LoadInputAndRegister-121"><span class="linenos">121</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">)</span>
</span><span id="LoadInputAndRegister-122"><a href="#LoadInputAndRegister-122"><span class="linenos">122</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-123"><a href="#LoadInputAndRegister-123"><span class="linenos">123</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-124"><a href="#LoadInputAndRegister-124"><span class="linenos">124</span></a>                    <span class="s2">&quot;Unable to locate the previous calculation to copy. Make sure the &quot;</span>
</span><span id="LoadInputAndRegister-125"><a href="#LoadInputAndRegister-125"><span class="linenos">125</span></a>                    <span class="s2">&quot;past directory is located on the same file system. Directory that &quot;</span>
</span><span id="LoadInputAndRegister-126"><a href="#LoadInputAndRegister-126"><span class="linenos">126</span></a>                    <span class="sa">f</span><span class="s2">&quot;couldn&#39;t be found was... </span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LoadInputAndRegister-127"><a href="#LoadInputAndRegister-127"><span class="linenos">127</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister-128"><a href="#LoadInputAndRegister-128"><span class="linenos">128</span></a>            <span class="c1"># TODO: for possibility 3, I could implement automatic copying with</span>
</span><span id="LoadInputAndRegister-129"><a href="#LoadInputAndRegister-129"><span class="linenos">129</span></a>            <span class="c1"># the &quot;fabric&quot; python package (uses ssh). I&#39;d also need to store</span>
</span><span id="LoadInputAndRegister-130"><a href="#LoadInputAndRegister-130"><span class="linenos">130</span></a>            <span class="c1"># filesystem names (e.g. &quot;WarWulf&quot;) to know where to connect.</span>
</span><span id="LoadInputAndRegister-131"><a href="#LoadInputAndRegister-131"><span class="linenos">131</span></a>
</span><span id="LoadInputAndRegister-132"><a href="#LoadInputAndRegister-132"><span class="linenos">132</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister-133"><a href="#LoadInputAndRegister-133"><span class="linenos">133</span></a>
</span><span id="LoadInputAndRegister-134"><a href="#LoadInputAndRegister-134"><span class="linenos">134</span></a>        <span class="c1"># Load the source of the input object</span>
</span><span id="LoadInputAndRegister-135"><a href="#LoadInputAndRegister-135"><span class="linenos">135</span></a>
</span><span id="LoadInputAndRegister-136"><a href="#LoadInputAndRegister-136"><span class="linenos">136</span></a>        <span class="c1"># If we were given a input from a previous calculation, the source should</span>
</span><span id="LoadInputAndRegister-137"><a href="#LoadInputAndRegister-137"><span class="linenos">137</span></a>        <span class="c1"># point directory to that same input. Otherwise we are incorrectly trying</span>
</span><span id="LoadInputAndRegister-138"><a href="#LoadInputAndRegister-138"><span class="linenos">138</span></a>        <span class="c1"># to change what the source is.</span>
</span><span id="LoadInputAndRegister-139"><a href="#LoadInputAndRegister-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">source</span> <span class="ow">and</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-140"><a href="#LoadInputAndRegister-140"><span class="linenos">140</span></a>            <span class="c1"># note input_obj here is a dictionary</span>
</span><span id="LoadInputAndRegister-141"><a href="#LoadInputAndRegister-141"><span class="linenos">141</span></a>            <span class="k">assert</span> <span class="n">source</span> <span class="o">==</span> <span class="n">input_obj</span>
</span><span id="LoadInputAndRegister-142"><a href="#LoadInputAndRegister-142"><span class="linenos">142</span></a>        <span class="k">elif</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-143"><a href="#LoadInputAndRegister-143"><span class="linenos">143</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="n">input_obj</span>
</span><span id="LoadInputAndRegister-144"><a href="#LoadInputAndRegister-144"><span class="linenos">144</span></a>        <span class="k">elif</span> <span class="n">source</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-145"><a href="#LoadInputAndRegister-145"><span class="linenos">145</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="LoadInputAndRegister-146"><a href="#LoadInputAndRegister-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-147"><a href="#LoadInputAndRegister-147"><span class="linenos">147</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LoadInputAndRegister-148"><a href="#LoadInputAndRegister-148"><span class="linenos">148</span></a>
</span><span id="LoadInputAndRegister-149"><a href="#LoadInputAndRegister-149"><span class="linenos">149</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister-150"><a href="#LoadInputAndRegister-150"><span class="linenos">150</span></a>
</span><span id="LoadInputAndRegister-151"><a href="#LoadInputAndRegister-151"><span class="linenos">151</span></a>        <span class="c1"># Register the calculation so the user can follow along in the UI.</span>
</span><span id="LoadInputAndRegister-152"><a href="#LoadInputAndRegister-152"><span class="linenos">152</span></a>
</span><span id="LoadInputAndRegister-153"><a href="#LoadInputAndRegister-153"><span class="linenos">153</span></a>        <span class="c1"># This is only done if a table is provided. Some special-case workflows</span>
</span><span id="LoadInputAndRegister-154"><a href="#LoadInputAndRegister-154"><span class="linenos">154</span></a>        <span class="c1"># don&#39;t store calculation information bc the flow is just a quick python</span>
</span><span id="LoadInputAndRegister-155"><a href="#LoadInputAndRegister-155"><span class="linenos">155</span></a>        <span class="c1"># analysis.</span>
</span><span id="LoadInputAndRegister-156"><a href="#LoadInputAndRegister-156"><span class="linenos">156</span></a>        <span class="n">prefect_flow_run_id</span> <span class="o">=</span> <span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">flow_run_id</span>
</span><span id="LoadInputAndRegister-157"><a href="#LoadInputAndRegister-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-158"><a href="#LoadInputAndRegister-158"><span class="linenos">158</span></a>            <span class="c1"># load/create the calculation for this workflow run</span>
</span><span id="LoadInputAndRegister-159"><a href="#LoadInputAndRegister-159"><span class="linenos">159</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-160"><a href="#LoadInputAndRegister-160"><span class="linenos">160</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-161"><a href="#LoadInputAndRegister-161"><span class="linenos">161</span></a>                <span class="c1"># We pass the initial input_obj in case the calculation wasn&#39;t created</span>
</span><span id="LoadInputAndRegister-162"><a href="#LoadInputAndRegister-162"><span class="linenos">162</span></a>                <span class="c1"># yet (and creation requires the structure)</span>
</span><span id="LoadInputAndRegister-163"><a href="#LoadInputAndRegister-163"><span class="linenos">163</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">input_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-164"><a href="#LoadInputAndRegister-164"><span class="linenos">164</span></a>                <span class="c1"># BUG: what if the initial structure changed? An example of this happening</span>
</span><span id="LoadInputAndRegister-165"><a href="#LoadInputAndRegister-165"><span class="linenos">165</span></a>                <span class="c1"># is with a relaxation where a correction was applied and the calc</span>
</span><span id="LoadInputAndRegister-166"><a href="#LoadInputAndRegister-166"><span class="linenos">166</span></a>                <span class="c1"># was not fully restarted. This issue also will not matter when</span>
</span><span id="LoadInputAndRegister-167"><a href="#LoadInputAndRegister-167"><span class="linenos">167</span></a>                <span class="c1"># workflows are ran through cloud -- as the structure is already</span>
</span><span id="LoadInputAndRegister-168"><a href="#LoadInputAndRegister-168"><span class="linenos">168</span></a>                <span class="c1"># saved and won&#39;t be overwritten here.</span>
</span><span id="LoadInputAndRegister-169"><a href="#LoadInputAndRegister-169"><span class="linenos">169</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-170"><a href="#LoadInputAndRegister-170"><span class="linenos">170</span></a>            <span class="p">)</span>
</span><span id="LoadInputAndRegister-171"><a href="#LoadInputAndRegister-171"><span class="linenos">171</span></a>
</span><span id="LoadInputAndRegister-172"><a href="#LoadInputAndRegister-172"><span class="linenos">172</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister-173"><a href="#LoadInputAndRegister-173"><span class="linenos">173</span></a>
</span><span id="LoadInputAndRegister-174"><a href="#LoadInputAndRegister-174"><span class="linenos">174</span></a>        <span class="c1"># Lastly, we want to write a file summarizing the inputs used for this</span>
</span><span id="LoadInputAndRegister-175"><a href="#LoadInputAndRegister-175"><span class="linenos">175</span></a>        <span class="c1"># workflow run. This allows future users to reproduce the results if</span>
</span><span id="LoadInputAndRegister-176"><a href="#LoadInputAndRegister-176"><span class="linenos">176</span></a>        <span class="c1"># desired -- and it also allows us to load old results into a database.</span>
</span><span id="LoadInputAndRegister-177"><a href="#LoadInputAndRegister-177"><span class="linenos">177</span></a>        <span class="n">input_summary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-178"><a href="#LoadInputAndRegister-178"><span class="linenos">178</span></a>            <span class="n">workflow_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_name</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-179"><a href="#LoadInputAndRegister-179"><span class="linenos">179</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-180"><a href="#LoadInputAndRegister-180"><span class="linenos">180</span></a>            <span class="n">directory</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-181"><a href="#LoadInputAndRegister-181"><span class="linenos">181</span></a>            <span class="c1"># this ID is ingored as an input but needed for loading past data</span>
</span><span id="LoadInputAndRegister-182"><a href="#LoadInputAndRegister-182"><span class="linenos">182</span></a>            <span class="n">prefect_flow_run_id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-183"><a href="#LoadInputAndRegister-183"><span class="linenos">183</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LoadInputAndRegister-184"><a href="#LoadInputAndRegister-184"><span class="linenos">184</span></a>        <span class="p">)</span>
</span><span id="LoadInputAndRegister-185"><a href="#LoadInputAndRegister-185"><span class="linenos">185</span></a>        <span class="c1"># As a final thing to add, we want the input_obj, but we want to save</span>
</span><span id="LoadInputAndRegister-186"><a href="#LoadInputAndRegister-186"><span class="linenos">186</span></a>        <span class="c1"># this to the proper input name. Also, this input should either be a</span>
</span><span id="LoadInputAndRegister-187"><a href="#LoadInputAndRegister-187"><span class="linenos">187</span></a>        <span class="c1"># dictionary or a python object, where we convert to a dictionary in</span>
</span><span id="LoadInputAndRegister-188"><a href="#LoadInputAndRegister-188"><span class="linenos">188</span></a>        <span class="c1"># order to write to file.</span>
</span><span id="LoadInputAndRegister-189"><a href="#LoadInputAndRegister-189"><span class="linenos">189</span></a>        <span class="n">input_dict</span> <span class="o">=</span> <span class="n">input_obj</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">input_obj</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="LoadInputAndRegister-190"><a href="#LoadInputAndRegister-190"><span class="linenos">190</span></a>        <span class="n">input_summary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_obj_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_dict</span>
</span><span id="LoadInputAndRegister-191"><a href="#LoadInputAndRegister-191"><span class="linenos">191</span></a>
</span><span id="LoadInputAndRegister-192"><a href="#LoadInputAndRegister-192"><span class="linenos">192</span></a>        <span class="c1"># now write the summary to file in the same directory as the calc.</span>
</span><span id="LoadInputAndRegister-193"><a href="#LoadInputAndRegister-193"><span class="linenos">193</span></a>        <span class="n">input_summary_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="LoadInputAndRegister-194"><a href="#LoadInputAndRegister-194"><span class="linenos">194</span></a>            <span class="n">directory_cleaned</span><span class="p">,</span> <span class="s2">&quot;simmate_metadata.yaml&quot;</span>
</span><span id="LoadInputAndRegister-195"><a href="#LoadInputAndRegister-195"><span class="linenos">195</span></a>        <span class="p">)</span>
</span><span id="LoadInputAndRegister-196"><a href="#LoadInputAndRegister-196"><span class="linenos">196</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_summary_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LoadInputAndRegister-197"><a href="#LoadInputAndRegister-197"><span class="linenos">197</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">input_summary</span><span class="p">)</span>
</span><span id="LoadInputAndRegister-198"><a href="#LoadInputAndRegister-198"><span class="linenos">198</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="LoadInputAndRegister-199"><a href="#LoadInputAndRegister-199"><span class="linenos">199</span></a>
</span><span id="LoadInputAndRegister-200"><a href="#LoadInputAndRegister-200"><span class="linenos">200</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister-201"><a href="#LoadInputAndRegister-201"><span class="linenos">201</span></a>
</span><span id="LoadInputAndRegister-202"><a href="#LoadInputAndRegister-202"><span class="linenos">202</span></a>        <span class="c1"># the rest of the calculation doesn&#39;t need the source (that was only for</span>
</span><span id="LoadInputAndRegister-203"><a href="#LoadInputAndRegister-203"><span class="linenos">203</span></a>        <span class="c1"># registering the calc), so we just return the pymatgen structure and dir</span>
</span><span id="LoadInputAndRegister-204"><a href="#LoadInputAndRegister-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">input_cleaned</span><span class="p">,</span> <span class="n">directory_cleaned</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The Task class which is used as the full representation of a unit of work.</p>

<p>This Task class can be used directly as a first class object where it must
be inherited from by a class that implements the <code><a href="#LoadInputAndRegister.run">run</a></code> method.  For a more
functional way of generating Tasks, see <a href="../utilities/tasks.html">the task decorator</a>.</p>

<p>Inheritance example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AddTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre></div>

<p><em>Note:</em> The implemented <code><a href="#LoadInputAndRegister.run">run</a></code> method cannot have <code>*args</code> in its signature. In addition,
the following keywords are reserved: <code>upstream_tasks</code>, <code>task_args</code> and <code>mapped</code>.</p>

<p>An instance of a <code>Task</code> can be used functionally to generate other task instances
with the same attributes but with different values bound to their <code><a href="#LoadInputAndRegister.run">run</a></code> methods.</p>

<p>Example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AddTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">AddTask</span><span class="p">()</span>

<span class="k">with</span> <span class="n">Flow</span><span class="p">(</span><span class="s2">&quot;My Flow&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># t1 != a</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="c1"># t2 != a</span>
</code></pre></div>

<p>To bind values to a Task's run method imperatively (and without making a copy), see <code>Task.bind</code>.</p>

<p>Args:
    - name (str, optional): The name of this task
    - slug (str, optional): The slug for this task. Slugs provide a stable ID for tasks so
        that the Prefect API can identify task run states. If a slug is not provided, one
        will be generated automatically once the task is added to a Flow.
    - tags ([str], optional): A list of tags for this task
    - max_retries (int, optional): The maximum amount of times this task can be retried
    - retry_delay (timedelta, optional): The amount of time to wait until task is retried
    - retry_on (Union[Exception, Iterable[Type[Exception]]], optional): Exception types that will
        allow retry behavior to occur. If not set, all exceptions will allow retries. If set,
        retries will only occur if the exception is a subtype of the exception types provided.
    - timeout (Union[int, timedelta], optional): The amount of time (in seconds) to wait while
        running this task before a timeout occurs; note that sub-second
        resolution is not supported, even when passing in a timedelta.
    - trigger (callable, optional): a function that determines whether the
        task should run, based on the states of any upstream tasks.
    - skip_on_upstream_skip (bool, optional): if <code>True</code>, if any immediately
        upstream tasks are skipped, this task will automatically be skipped as
        well, regardless of trigger. By default, this prevents tasks from
        attempting to use either state or data from tasks that didn't run. If
        <code>False</code>, the task's trigger will be called as normal, with skips
        considered successes. Defaults to <code>True</code>.
    - cache_for (timedelta, optional): The amount of time to maintain a cache
        of the outputs of this task.  Useful for situations where the containing Flow
        will be rerun multiple times, but this task doesn't need to be.
    - cache_validator (Callable, optional): Validator that will determine
        whether the cache for this task is still valid (only required if <code>cache_for</code>
        is provided; defaults to <code>prefect.engine.cache_validators.duration_only</code>)
    - cache_key (str, optional): if provided, a <code>cache_key</code>
        serves as a unique identifier for this Task's cache, and can be shared
        across both Tasks _and_ Flows; if not provided, the Task's _name_ will
        be used if running locally, or the Task's database ID if running in
        Cloud
    - checkpoint (bool, optional): if this Task is successful, whether to
        store its result using the configured result available during the run;
        Also note that checkpointing will only occur locally if
        <code>prefect.config.flows.checkpointing</code> is set to <code>True</code>
    - result (Result, optional): the result instance used to retrieve and
        store task results during execution
    - target (Union[str, Callable], optional): location to check for task Result. If a result
        exists at that location then the task run will enter a cached state.
        <code>target</code> strings can be templated formatting strings which will be
        formatted at runtime with values from <code>prefect.context</code>. If a callable function
        is provided, it should have signature <code>callable(**kwargs) -&gt; str</code> and at write
        time all formatting kwargs will be passed and a fully formatted location is
        expected as the return value. The callable can be used for string formatting logic that
        <code>.format(**kwargs)</code> doesn't support.
    - state_handlers (Iterable[Callable], optional): A list of state change handlers
        that will be called whenever the task changes state, providing an
        opportunity to inspect or modify the new state. The handler
        will be passed the task instance, the old (prior) state, and the new
        (current) state, with the following signature:
            <code>state_handler(task: Task, old_state: State, new_state: State) -&gt; Optional[State]</code>
        If multiple functions are passed, then the <code>new_state</code> argument will be the
        result of the previous handler.
    - on_failure (Callable, optional): A function with signature
        <code>fn(task: Task, state: State) -&gt; None</code> that will be called anytime this
        Task enters a failure state
    - log_stdout (bool, optional): Toggle whether or not to send stdout messages to
        the Prefect logger. Defaults to <code>False</code>.
    - task_run_name (Union[str, Callable], optional): a name to set for this task at runtime.
        <code>task_run_name</code> strings can be templated formatting strings which will be
        formatted at runtime with values from task arguments, <code>prefect.context</code>, and flow
        parameters (in the case of a name conflict between these, earlier values take precedence).
        If a callable function is provided, it should have signature <code>callable(**kwargs) -&gt; str</code>
        and at write time all formatting kwargs will be passed and a fully formatted location is
        expected as the return value. The callable can be used for string formatting logic that
        <code>.format(**kwargs)</code> doesn't support. <strong>Note</strong>: this only works for tasks running against a
        backend API.
    - nout (int, optional): for tasks that return multiple results, the number of outputs
        to expect. If not provided, will be inferred from the task return annotation, if
        possible.  Note that <code>nout=1</code> implies the task returns a tuple of
        one value (leave as <code>None</code> for non-tuple return types).</p>

<p>Raises:
    - TypeError: if <code>tags</code> is of type <code>str</code>
    - TypeError: if <code>timeout</code> is not of type <code>int</code></p>
</div>


                            <div id="LoadInputAndRegister.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#LoadInputAndRegister.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">LoadInputAndRegister</span><span class="signature">(
    workflow_name: str = None,
    input_obj_name: str = None,
    calculation_table: <a href="../../database/base_data_types/base.html#DatabaseTable">simmate.database.base_data_types.base.DatabaseTable</a> = None,
    **kwargs
)</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LoadInputAndRegister.__init__-21"><a href="#LoadInputAndRegister.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.__init__-22"><a href="#LoadInputAndRegister.__init__-22"><span class="linenos">22</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.__init__-23"><a href="#LoadInputAndRegister.__init__-23"><span class="linenos">23</span></a>        <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.__init__-24"><a href="#LoadInputAndRegister.__init__-24"><span class="linenos">24</span></a>        <span class="n">input_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.__init__-25"><a href="#LoadInputAndRegister.__init__-25"><span class="linenos">25</span></a>        <span class="n">calculation_table</span><span class="p">:</span> <span class="n">DatabaseTable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.__init__-26"><a href="#LoadInputAndRegister.__init__-26"><span class="linenos">26</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.__init__-27"><a href="#LoadInputAndRegister.__init__-27"><span class="linenos">27</span></a>    <span class="p">):</span>
</span><span id="LoadInputAndRegister.__init__-28"><a href="#LoadInputAndRegister.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_name</span> <span class="o">=</span> <span class="n">workflow_name</span>
</span><span id="LoadInputAndRegister.__init__-29"><a href="#LoadInputAndRegister.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_obj_name</span> <span class="o">=</span> <span class="n">input_obj_name</span>
</span><span id="LoadInputAndRegister.__init__-30"><a href="#LoadInputAndRegister.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span> <span class="o">=</span> <span class="n">calculation_table</span>  <span class="c1"># If None, registration is skipped</span>
</span><span id="LoadInputAndRegister.__init__-31"><a href="#LoadInputAndRegister.__init__-31"><span class="linenos">31</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="LoadInputAndRegister.run" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#LoadInputAndRegister.run">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">run</span><span class="signature">(
    self,
    input_obj: Any,
    input_class: Any = &lt;class &#39;<a href="../../toolkit/base_data_types/structure.html#Structure">simmate.toolkit.base_data_types.structure.Structure</a>&#39;&gt;,
    source: dict = None,
    directory: str = None,
    copy_previous_directory: bool = False,
    **kwargs: Any
) -&gt; Tuple[<a href="../../toolkit/base_data_types/structure.html#Structure">simmate.toolkit.base_data_types.structure.Structure</a>, str]</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LoadInputAndRegister.run-33"><a href="#LoadInputAndRegister.run-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-34"><a href="#LoadInputAndRegister.run-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-35"><a href="#LoadInputAndRegister.run-35"><span class="linenos"> 35</span></a>        <span class="n">input_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-36"><a href="#LoadInputAndRegister.run-36"><span class="linenos"> 36</span></a>        <span class="n">input_class</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-37"><a href="#LoadInputAndRegister.run-37"><span class="linenos"> 37</span></a>        <span class="n">source</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-38"><a href="#LoadInputAndRegister.run-38"><span class="linenos"> 38</span></a>        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-39"><a href="#LoadInputAndRegister.run-39"><span class="linenos"> 39</span></a>        <span class="n">copy_previous_directory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-40"><a href="#LoadInputAndRegister.run-40"><span class="linenos"> 40</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-41"><a href="#LoadInputAndRegister.run-41"><span class="linenos"> 41</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="LoadInputAndRegister.run-42"><a href="#LoadInputAndRegister.run-42"><span class="linenos"> 42</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="LoadInputAndRegister.run-43"><a href="#LoadInputAndRegister.run-43"><span class="linenos"> 43</span></a><span class="sd">        How the input was submitted as a parameter depends on if we are submitting</span>
</span><span id="LoadInputAndRegister.run-44"><a href="#LoadInputAndRegister.run-44"><span class="linenos"> 44</span></a><span class="sd">        to Prefect Cloud, running the flow locally, or even continuing from a</span>
</span><span id="LoadInputAndRegister.run-45"><a href="#LoadInputAndRegister.run-45"><span class="linenos"> 45</span></a><span class="sd">        previous calculation.  Here, we use a task to convert the input to a toolkit</span>
</span><span id="LoadInputAndRegister.run-46"><a href="#LoadInputAndRegister.run-46"><span class="linenos"> 46</span></a><span class="sd">        object and (if requested) provide the directory as well.</span>
</span><span id="LoadInputAndRegister.run-47"><a href="#LoadInputAndRegister.run-47"><span class="linenos"> 47</span></a>
</span><span id="LoadInputAndRegister.run-48"><a href="#LoadInputAndRegister.run-48"><span class="linenos"> 48</span></a><span class="sd">        input_class is any class that has a from_dynamic method accepts the</span>
</span><span id="LoadInputAndRegister.run-49"><a href="#LoadInputAndRegister.run-49"><span class="linenos"> 49</span></a><span class="sd">        input_obj format. In the large majority of cases, this is just</span>
</span><span id="LoadInputAndRegister.run-50"><a href="#LoadInputAndRegister.run-50"><span class="linenos"> 50</span></a><span class="sd">        a Structure object so we use that as the default.</span>
</span><span id="LoadInputAndRegister.run-51"><a href="#LoadInputAndRegister.run-51"><span class="linenos"> 51</span></a>
</span><span id="LoadInputAndRegister.run-52"><a href="#LoadInputAndRegister.run-52"><span class="linenos"> 52</span></a><span class="sd">        directory is optional</span>
</span><span id="LoadInputAndRegister.run-53"><a href="#LoadInputAndRegister.run-53"><span class="linenos"> 53</span></a>
</span><span id="LoadInputAndRegister.run-54"><a href="#LoadInputAndRegister.run-54"><span class="linenos"> 54</span></a><span class="sd">        copy_previous_directory is only used when we are pulling a structure from a</span>
</span><span id="LoadInputAndRegister.run-55"><a href="#LoadInputAndRegister.run-55"><span class="linenos"> 55</span></a><span class="sd">        previous calculation. If copy_previous_directory=True, then the directory</span>
</span><span id="LoadInputAndRegister.run-56"><a href="#LoadInputAndRegister.run-56"><span class="linenos"> 56</span></a><span class="sd">        parameter is ignored.</span>
</span><span id="LoadInputAndRegister.run-57"><a href="#LoadInputAndRegister.run-57"><span class="linenos"> 57</span></a>
</span><span id="LoadInputAndRegister.run-58"><a href="#LoadInputAndRegister.run-58"><span class="linenos"> 58</span></a><span class="sd">        **kwargs is anything extra that you want saved to simmate_metadata.yaml</span>
</span><span id="LoadInputAndRegister.run-59"><a href="#LoadInputAndRegister.run-59"><span class="linenos"> 59</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LoadInputAndRegister.run-60"><a href="#LoadInputAndRegister.run-60"><span class="linenos"> 60</span></a>
</span><span id="LoadInputAndRegister.run-61"><a href="#LoadInputAndRegister.run-61"><span class="linenos"> 61</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister.run-62"><a href="#LoadInputAndRegister.run-62"><span class="linenos"> 62</span></a>
</span><span id="LoadInputAndRegister.run-63"><a href="#LoadInputAndRegister.run-63"><span class="linenos"> 63</span></a>        <span class="c1"># First we load the structure to a toolkit structure object</span>
</span><span id="LoadInputAndRegister.run-64"><a href="#LoadInputAndRegister.run-64"><span class="linenos"> 64</span></a>
</span><span id="LoadInputAndRegister.run-65"><a href="#LoadInputAndRegister.run-65"><span class="linenos"> 65</span></a>        <span class="n">input_cleaned</span> <span class="o">=</span> <span class="n">input_class</span><span class="o">.</span><span class="n">from_dynamic</span><span class="p">(</span><span class="n">input_obj</span><span class="p">)</span>
</span><span id="LoadInputAndRegister.run-66"><a href="#LoadInputAndRegister.run-66"><span class="linenos"> 66</span></a>
</span><span id="LoadInputAndRegister.run-67"><a href="#LoadInputAndRegister.run-67"><span class="linenos"> 67</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister.run-68"><a href="#LoadInputAndRegister.run-68"><span class="linenos"> 68</span></a>
</span><span id="LoadInputAndRegister.run-69"><a href="#LoadInputAndRegister.run-69"><span class="linenos"> 69</span></a>        <span class="c1"># Now let&#39;s load the directory</span>
</span><span id="LoadInputAndRegister.run-70"><a href="#LoadInputAndRegister.run-70"><span class="linenos"> 70</span></a>
</span><span id="LoadInputAndRegister.run-71"><a href="#LoadInputAndRegister.run-71"><span class="linenos"> 71</span></a>        <span class="c1"># Start by creating a new directory or grabbing the one given. We create</span>
</span><span id="LoadInputAndRegister.run-72"><a href="#LoadInputAndRegister.run-72"><span class="linenos"> 72</span></a>        <span class="c1"># this directly immediately (rather than just passing the name to the</span>
</span><span id="LoadInputAndRegister.run-73"><a href="#LoadInputAndRegister.run-73"><span class="linenos"> 73</span></a>        <span class="c1"># S3Task). We do this because NestedWorkflows often use a parent directory</span>
</span><span id="LoadInputAndRegister.run-74"><a href="#LoadInputAndRegister.run-74"><span class="linenos"> 74</span></a>        <span class="c1"># to organize results.</span>
</span><span id="LoadInputAndRegister.run-75"><a href="#LoadInputAndRegister.run-75"><span class="linenos"> 75</span></a>        <span class="n">directory_cleaned</span> <span class="o">=</span> <span class="n">get_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="LoadInputAndRegister.run-76"><a href="#LoadInputAndRegister.run-76"><span class="linenos"> 76</span></a>
</span><span id="LoadInputAndRegister.run-77"><a href="#LoadInputAndRegister.run-77"><span class="linenos"> 77</span></a>        <span class="c1"># if the user requested, we grab the previous directory as well</span>
</span><span id="LoadInputAndRegister.run-78"><a href="#LoadInputAndRegister.run-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="n">copy_previous_directory</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-79"><a href="#LoadInputAndRegister.run-79"><span class="linenos"> 79</span></a>
</span><span id="LoadInputAndRegister.run-80"><a href="#LoadInputAndRegister.run-80"><span class="linenos"> 80</span></a>            <span class="c1"># catch incorrect use of this function</span>
</span><span id="LoadInputAndRegister.run-81"><a href="#LoadInputAndRegister.run-81"><span class="linenos"> 81</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-82"><a href="#LoadInputAndRegister.run-82"><span class="linenos"> 82</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-83"><a href="#LoadInputAndRegister.run-83"><span class="linenos"> 83</span></a>                    <span class="s2">&quot;There isn&#39;t a previous directory available! Your source &quot;</span>
</span><span id="LoadInputAndRegister.run-84"><a href="#LoadInputAndRegister.run-84"><span class="linenos"> 84</span></a>                    <span class="s2">&quot;structure must point to a past calculation to use this feature.&quot;</span>
</span><span id="LoadInputAndRegister.run-85"><a href="#LoadInputAndRegister.run-85"><span class="linenos"> 85</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-86"><a href="#LoadInputAndRegister.run-86"><span class="linenos"> 86</span></a>
</span><span id="LoadInputAndRegister.run-87"><a href="#LoadInputAndRegister.run-87"><span class="linenos"> 87</span></a>            <span class="c1"># the past directory should be stored on the input object</span>
</span><span id="LoadInputAndRegister.run-88"><a href="#LoadInputAndRegister.run-88"><span class="linenos"> 88</span></a>            <span class="n">previous_directory</span> <span class="o">=</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">calculation</span><span class="o">.</span><span class="n">directory</span>
</span><span id="LoadInputAndRegister.run-89"><a href="#LoadInputAndRegister.run-89"><span class="linenos"> 89</span></a>
</span><span id="LoadInputAndRegister.run-90"><a href="#LoadInputAndRegister.run-90"><span class="linenos"> 90</span></a>            <span class="c1"># First check if the previous directory exists. There are several</span>
</span><span id="LoadInputAndRegister.run-91"><a href="#LoadInputAndRegister.run-91"><span class="linenos"> 91</span></a>            <span class="c1"># possibilities that we need to check for:</span>
</span><span id="LoadInputAndRegister.run-92"><a href="#LoadInputAndRegister.run-92"><span class="linenos"> 92</span></a>            <span class="c1">#   1. directory exists on the same file system and can be found</span>
</span><span id="LoadInputAndRegister.run-93"><a href="#LoadInputAndRegister.run-93"><span class="linenos"> 93</span></a>            <span class="c1">#   2. directory exists on the same file system but is now an archive</span>
</span><span id="LoadInputAndRegister.run-94"><a href="#LoadInputAndRegister.run-94"><span class="linenos"> 94</span></a>            <span class="c1">#   3. directory/archive is on another file system (requires ssh to access)</span>
</span><span id="LoadInputAndRegister.run-95"><a href="#LoadInputAndRegister.run-95"><span class="linenos"> 95</span></a>            <span class="c1">#   4. directory was deleted and unavailable</span>
</span><span id="LoadInputAndRegister.run-96"><a href="#LoadInputAndRegister.run-96"><span class="linenos"> 96</span></a>            <span class="c1"># When copying over the directory, we ignore any `simmate_` files</span>
</span><span id="LoadInputAndRegister.run-97"><a href="#LoadInputAndRegister.run-97"><span class="linenos"> 97</span></a>            <span class="c1"># that correspond to metadata/results/corrections/etc.</span>
</span><span id="LoadInputAndRegister.run-98"><a href="#LoadInputAndRegister.run-98"><span class="linenos"> 98</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">):</span>
</span><span id="LoadInputAndRegister.run-99"><a href="#LoadInputAndRegister.run-99"><span class="linenos"> 99</span></a>                <span class="c1"># copy the old directory to the new one</span>
</span><span id="LoadInputAndRegister.run-100"><a href="#LoadInputAndRegister.run-100"><span class="linenos">100</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-101"><a href="#LoadInputAndRegister.run-101"><span class="linenos">101</span></a>                    <span class="n">src</span><span class="o">=</span><span class="n">previous_directory</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-102"><a href="#LoadInputAndRegister.run-102"><span class="linenos">102</span></a>                    <span class="n">dst</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-103"><a href="#LoadInputAndRegister.run-103"><span class="linenos">103</span></a>                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;simmate_*&quot;</span><span class="p">),</span>
</span><span id="LoadInputAndRegister.run-104"><a href="#LoadInputAndRegister.run-104"><span class="linenos">104</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-105"><a href="#LoadInputAndRegister.run-105"><span class="linenos">105</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-106"><a href="#LoadInputAndRegister.run-106"><span class="linenos">106</span></a>            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">):</span>
</span><span id="LoadInputAndRegister.run-107"><a href="#LoadInputAndRegister.run-107"><span class="linenos">107</span></a>                <span class="c1"># unpack the old archive</span>
</span><span id="LoadInputAndRegister.run-108"><a href="#LoadInputAndRegister.run-108"><span class="linenos">108</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-109"><a href="#LoadInputAndRegister.run-109"><span class="linenos">109</span></a>                    <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-110"><a href="#LoadInputAndRegister.run-110"><span class="linenos">110</span></a>                    <span class="n">extract_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">),</span>
</span><span id="LoadInputAndRegister.run-111"><a href="#LoadInputAndRegister.run-111"><span class="linenos">111</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-112"><a href="#LoadInputAndRegister.run-112"><span class="linenos">112</span></a>                <span class="c1"># copy the old directory to the new one</span>
</span><span id="LoadInputAndRegister.run-113"><a href="#LoadInputAndRegister.run-113"><span class="linenos">113</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-114"><a href="#LoadInputAndRegister.run-114"><span class="linenos">114</span></a>                    <span class="n">src</span><span class="o">=</span><span class="n">previous_directory</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-115"><a href="#LoadInputAndRegister.run-115"><span class="linenos">115</span></a>                    <span class="n">dst</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-116"><a href="#LoadInputAndRegister.run-116"><span class="linenos">116</span></a>                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;simmate_*&quot;</span><span class="p">),</span>
</span><span id="LoadInputAndRegister.run-117"><a href="#LoadInputAndRegister.run-117"><span class="linenos">117</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-118"><a href="#LoadInputAndRegister.run-118"><span class="linenos">118</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-119"><a href="#LoadInputAndRegister.run-119"><span class="linenos">119</span></a>                <span class="c1"># Then remove the unpacked archive now that we copied it.</span>
</span><span id="LoadInputAndRegister.run-120"><a href="#LoadInputAndRegister.run-120"><span class="linenos">120</span></a>                <span class="c1"># This leaves the original archive behind and unaltered too.</span>
</span><span id="LoadInputAndRegister.run-121"><a href="#LoadInputAndRegister.run-121"><span class="linenos">121</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">previous_directory</span><span class="p">)</span>
</span><span id="LoadInputAndRegister.run-122"><a href="#LoadInputAndRegister.run-122"><span class="linenos">122</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-123"><a href="#LoadInputAndRegister.run-123"><span class="linenos">123</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-124"><a href="#LoadInputAndRegister.run-124"><span class="linenos">124</span></a>                    <span class="s2">&quot;Unable to locate the previous calculation to copy. Make sure the &quot;</span>
</span><span id="LoadInputAndRegister.run-125"><a href="#LoadInputAndRegister.run-125"><span class="linenos">125</span></a>                    <span class="s2">&quot;past directory is located on the same file system. Directory that &quot;</span>
</span><span id="LoadInputAndRegister.run-126"><a href="#LoadInputAndRegister.run-126"><span class="linenos">126</span></a>                    <span class="sa">f</span><span class="s2">&quot;couldn&#39;t be found was... </span><span class="si">{</span><span class="n">previous_directory</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LoadInputAndRegister.run-127"><a href="#LoadInputAndRegister.run-127"><span class="linenos">127</span></a>                <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-128"><a href="#LoadInputAndRegister.run-128"><span class="linenos">128</span></a>            <span class="c1"># TODO: for possibility 3, I could implement automatic copying with</span>
</span><span id="LoadInputAndRegister.run-129"><a href="#LoadInputAndRegister.run-129"><span class="linenos">129</span></a>            <span class="c1"># the &quot;fabric&quot; python package (uses ssh). I&#39;d also need to store</span>
</span><span id="LoadInputAndRegister.run-130"><a href="#LoadInputAndRegister.run-130"><span class="linenos">130</span></a>            <span class="c1"># filesystem names (e.g. &quot;WarWulf&quot;) to know where to connect.</span>
</span><span id="LoadInputAndRegister.run-131"><a href="#LoadInputAndRegister.run-131"><span class="linenos">131</span></a>
</span><span id="LoadInputAndRegister.run-132"><a href="#LoadInputAndRegister.run-132"><span class="linenos">132</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister.run-133"><a href="#LoadInputAndRegister.run-133"><span class="linenos">133</span></a>
</span><span id="LoadInputAndRegister.run-134"><a href="#LoadInputAndRegister.run-134"><span class="linenos">134</span></a>        <span class="c1"># Load the source of the input object</span>
</span><span id="LoadInputAndRegister.run-135"><a href="#LoadInputAndRegister.run-135"><span class="linenos">135</span></a>
</span><span id="LoadInputAndRegister.run-136"><a href="#LoadInputAndRegister.run-136"><span class="linenos">136</span></a>        <span class="c1"># If we were given a input from a previous calculation, the source should</span>
</span><span id="LoadInputAndRegister.run-137"><a href="#LoadInputAndRegister.run-137"><span class="linenos">137</span></a>        <span class="c1"># point directory to that same input. Otherwise we are incorrectly trying</span>
</span><span id="LoadInputAndRegister.run-138"><a href="#LoadInputAndRegister.run-138"><span class="linenos">138</span></a>        <span class="c1"># to change what the source is.</span>
</span><span id="LoadInputAndRegister.run-139"><a href="#LoadInputAndRegister.run-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">source</span> <span class="ow">and</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-140"><a href="#LoadInputAndRegister.run-140"><span class="linenos">140</span></a>            <span class="c1"># note input_obj here is a dictionary</span>
</span><span id="LoadInputAndRegister.run-141"><a href="#LoadInputAndRegister.run-141"><span class="linenos">141</span></a>            <span class="k">assert</span> <span class="n">source</span> <span class="o">==</span> <span class="n">input_obj</span>
</span><span id="LoadInputAndRegister.run-142"><a href="#LoadInputAndRegister.run-142"><span class="linenos">142</span></a>        <span class="k">elif</span> <span class="n">input_cleaned</span><span class="o">.</span><span class="n">is_from_past_calc</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-143"><a href="#LoadInputAndRegister.run-143"><span class="linenos">143</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="n">input_obj</span>
</span><span id="LoadInputAndRegister.run-144"><a href="#LoadInputAndRegister.run-144"><span class="linenos">144</span></a>        <span class="k">elif</span> <span class="n">source</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-145"><a href="#LoadInputAndRegister.run-145"><span class="linenos">145</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="LoadInputAndRegister.run-146"><a href="#LoadInputAndRegister.run-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-147"><a href="#LoadInputAndRegister.run-147"><span class="linenos">147</span></a>            <span class="n">source_cleaned</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LoadInputAndRegister.run-148"><a href="#LoadInputAndRegister.run-148"><span class="linenos">148</span></a>
</span><span id="LoadInputAndRegister.run-149"><a href="#LoadInputAndRegister.run-149"><span class="linenos">149</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister.run-150"><a href="#LoadInputAndRegister.run-150"><span class="linenos">150</span></a>
</span><span id="LoadInputAndRegister.run-151"><a href="#LoadInputAndRegister.run-151"><span class="linenos">151</span></a>        <span class="c1"># Register the calculation so the user can follow along in the UI.</span>
</span><span id="LoadInputAndRegister.run-152"><a href="#LoadInputAndRegister.run-152"><span class="linenos">152</span></a>
</span><span id="LoadInputAndRegister.run-153"><a href="#LoadInputAndRegister.run-153"><span class="linenos">153</span></a>        <span class="c1"># This is only done if a table is provided. Some special-case workflows</span>
</span><span id="LoadInputAndRegister.run-154"><a href="#LoadInputAndRegister.run-154"><span class="linenos">154</span></a>        <span class="c1"># don&#39;t store calculation information bc the flow is just a quick python</span>
</span><span id="LoadInputAndRegister.run-155"><a href="#LoadInputAndRegister.run-155"><span class="linenos">155</span></a>        <span class="c1"># analysis.</span>
</span><span id="LoadInputAndRegister.run-156"><a href="#LoadInputAndRegister.run-156"><span class="linenos">156</span></a>        <span class="n">prefect_flow_run_id</span> <span class="o">=</span> <span class="n">prefect</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">flow_run_id</span>
</span><span id="LoadInputAndRegister.run-157"><a href="#LoadInputAndRegister.run-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-158"><a href="#LoadInputAndRegister.run-158"><span class="linenos">158</span></a>            <span class="c1"># load/create the calculation for this workflow run</span>
</span><span id="LoadInputAndRegister.run-159"><a href="#LoadInputAndRegister.run-159"><span class="linenos">159</span></a>            <span class="n">calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_table</span><span class="o">.</span><span class="n">from_prefect_id</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-160"><a href="#LoadInputAndRegister.run-160"><span class="linenos">160</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-161"><a href="#LoadInputAndRegister.run-161"><span class="linenos">161</span></a>                <span class="c1"># We pass the initial input_obj in case the calculation wasn&#39;t created</span>
</span><span id="LoadInputAndRegister.run-162"><a href="#LoadInputAndRegister.run-162"><span class="linenos">162</span></a>                <span class="c1"># yet (and creation requires the structure)</span>
</span><span id="LoadInputAndRegister.run-163"><a href="#LoadInputAndRegister.run-163"><span class="linenos">163</span></a>                <span class="n">structure</span><span class="o">=</span><span class="n">input_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-164"><a href="#LoadInputAndRegister.run-164"><span class="linenos">164</span></a>                <span class="c1"># BUG: what if the initial structure changed? An example of this happening</span>
</span><span id="LoadInputAndRegister.run-165"><a href="#LoadInputAndRegister.run-165"><span class="linenos">165</span></a>                <span class="c1"># is with a relaxation where a correction was applied and the calc</span>
</span><span id="LoadInputAndRegister.run-166"><a href="#LoadInputAndRegister.run-166"><span class="linenos">166</span></a>                <span class="c1"># was not fully restarted. This issue also will not matter when</span>
</span><span id="LoadInputAndRegister.run-167"><a href="#LoadInputAndRegister.run-167"><span class="linenos">167</span></a>                <span class="c1"># workflows are ran through cloud -- as the structure is already</span>
</span><span id="LoadInputAndRegister.run-168"><a href="#LoadInputAndRegister.run-168"><span class="linenos">168</span></a>                <span class="c1"># saved and won&#39;t be overwritten here.</span>
</span><span id="LoadInputAndRegister.run-169"><a href="#LoadInputAndRegister.run-169"><span class="linenos">169</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-170"><a href="#LoadInputAndRegister.run-170"><span class="linenos">170</span></a>            <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-171"><a href="#LoadInputAndRegister.run-171"><span class="linenos">171</span></a>
</span><span id="LoadInputAndRegister.run-172"><a href="#LoadInputAndRegister.run-172"><span class="linenos">172</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister.run-173"><a href="#LoadInputAndRegister.run-173"><span class="linenos">173</span></a>
</span><span id="LoadInputAndRegister.run-174"><a href="#LoadInputAndRegister.run-174"><span class="linenos">174</span></a>        <span class="c1"># Lastly, we want to write a file summarizing the inputs used for this</span>
</span><span id="LoadInputAndRegister.run-175"><a href="#LoadInputAndRegister.run-175"><span class="linenos">175</span></a>        <span class="c1"># workflow run. This allows future users to reproduce the results if</span>
</span><span id="LoadInputAndRegister.run-176"><a href="#LoadInputAndRegister.run-176"><span class="linenos">176</span></a>        <span class="c1"># desired -- and it also allows us to load old results into a database.</span>
</span><span id="LoadInputAndRegister.run-177"><a href="#LoadInputAndRegister.run-177"><span class="linenos">177</span></a>        <span class="n">input_summary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-178"><a href="#LoadInputAndRegister.run-178"><span class="linenos">178</span></a>            <span class="n">workflow_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_name</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-179"><a href="#LoadInputAndRegister.run-179"><span class="linenos">179</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-180"><a href="#LoadInputAndRegister.run-180"><span class="linenos">180</span></a>            <span class="n">directory</span><span class="o">=</span><span class="n">directory_cleaned</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-181"><a href="#LoadInputAndRegister.run-181"><span class="linenos">181</span></a>            <span class="c1"># this ID is ingored as an input but needed for loading past data</span>
</span><span id="LoadInputAndRegister.run-182"><a href="#LoadInputAndRegister.run-182"><span class="linenos">182</span></a>            <span class="n">prefect_flow_run_id</span><span class="o">=</span><span class="n">prefect_flow_run_id</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-183"><a href="#LoadInputAndRegister.run-183"><span class="linenos">183</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LoadInputAndRegister.run-184"><a href="#LoadInputAndRegister.run-184"><span class="linenos">184</span></a>        <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-185"><a href="#LoadInputAndRegister.run-185"><span class="linenos">185</span></a>        <span class="c1"># As a final thing to add, we want the input_obj, but we want to save</span>
</span><span id="LoadInputAndRegister.run-186"><a href="#LoadInputAndRegister.run-186"><span class="linenos">186</span></a>        <span class="c1"># this to the proper input name. Also, this input should either be a</span>
</span><span id="LoadInputAndRegister.run-187"><a href="#LoadInputAndRegister.run-187"><span class="linenos">187</span></a>        <span class="c1"># dictionary or a python object, where we convert to a dictionary in</span>
</span><span id="LoadInputAndRegister.run-188"><a href="#LoadInputAndRegister.run-188"><span class="linenos">188</span></a>        <span class="c1"># order to write to file.</span>
</span><span id="LoadInputAndRegister.run-189"><a href="#LoadInputAndRegister.run-189"><span class="linenos">189</span></a>        <span class="n">input_dict</span> <span class="o">=</span> <span class="n">input_obj</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">input_obj</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="LoadInputAndRegister.run-190"><a href="#LoadInputAndRegister.run-190"><span class="linenos">190</span></a>        <span class="n">input_summary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_obj_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_dict</span>
</span><span id="LoadInputAndRegister.run-191"><a href="#LoadInputAndRegister.run-191"><span class="linenos">191</span></a>
</span><span id="LoadInputAndRegister.run-192"><a href="#LoadInputAndRegister.run-192"><span class="linenos">192</span></a>        <span class="c1"># now write the summary to file in the same directory as the calc.</span>
</span><span id="LoadInputAndRegister.run-193"><a href="#LoadInputAndRegister.run-193"><span class="linenos">193</span></a>        <span class="n">input_summary_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="LoadInputAndRegister.run-194"><a href="#LoadInputAndRegister.run-194"><span class="linenos">194</span></a>            <span class="n">directory_cleaned</span><span class="p">,</span> <span class="s2">&quot;simmate_metadata.yaml&quot;</span>
</span><span id="LoadInputAndRegister.run-195"><a href="#LoadInputAndRegister.run-195"><span class="linenos">195</span></a>        <span class="p">)</span>
</span><span id="LoadInputAndRegister.run-196"><a href="#LoadInputAndRegister.run-196"><span class="linenos">196</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_summary_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LoadInputAndRegister.run-197"><a href="#LoadInputAndRegister.run-197"><span class="linenos">197</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">input_summary</span><span class="p">)</span>
</span><span id="LoadInputAndRegister.run-198"><a href="#LoadInputAndRegister.run-198"><span class="linenos">198</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="LoadInputAndRegister.run-199"><a href="#LoadInputAndRegister.run-199"><span class="linenos">199</span></a>
</span><span id="LoadInputAndRegister.run-200"><a href="#LoadInputAndRegister.run-200"><span class="linenos">200</span></a>        <span class="c1"># -------------------------------------------------------------------------</span>
</span><span id="LoadInputAndRegister.run-201"><a href="#LoadInputAndRegister.run-201"><span class="linenos">201</span></a>
</span><span id="LoadInputAndRegister.run-202"><a href="#LoadInputAndRegister.run-202"><span class="linenos">202</span></a>        <span class="c1"># the rest of the calculation doesn&#39;t need the source (that was only for</span>
</span><span id="LoadInputAndRegister.run-203"><a href="#LoadInputAndRegister.run-203"><span class="linenos">203</span></a>        <span class="c1"># registering the calc), so we just return the pymatgen structure and dir</span>
</span><span id="LoadInputAndRegister.run-204"><a href="#LoadInputAndRegister.run-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">input_cleaned</span><span class="p">,</span> <span class="n">directory_cleaned</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>How the input was submitted as a parameter depends on if we are submitting
to Prefect Cloud, running the flow locally, or even continuing from a
previous calculation.  Here, we use a task to convert the input to a toolkit
object and (if requested) provide the directory as well.</p>

<p>input_class is any class that has a from_dynamic method accepts the
input_obj format. In the large majority of cases, this is just
a Structure object so we use that as the default.</p>

<p>directory is optional</p>

<p>copy_previous_directory is only used when we are pulling a structure from a
previous calculation. If copy_previous_directory=True, then the directory
parameter is ignored.</p>

<p>**kwargs is anything extra that you want saved to simmate_metadata.yaml</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.core.task.Task</dt>
                                <dd id="LoadInputAndRegister.copy" class="function">copy</dd>
                <dd id="LoadInputAndRegister.bind" class="function">bind</dd>
                <dd id="LoadInputAndRegister.map" class="function">map</dd>
                <dd id="LoadInputAndRegister.set_dependencies" class="function">set_dependencies</dd>
                <dd id="LoadInputAndRegister.set_upstream" class="function">set_upstream</dd>
                <dd id="LoadInputAndRegister.set_downstream" class="function">set_downstream</dd>
                <dd id="LoadInputAndRegister.inputs" class="function">inputs</dd>
                <dd id="LoadInputAndRegister.outputs" class="function">outputs</dd>
                <dd id="LoadInputAndRegister.pipe" class="function">pipe</dd>
                <dd id="LoadInputAndRegister.serialize" class="function">serialize</dd>
                <dd id="LoadInputAndRegister.is_equal" class="function">is_equal</dd>
                <dd id="LoadInputAndRegister.is_not_equal" class="function">is_not_equal</dd>
                <dd id="LoadInputAndRegister.not_" class="function">not_</dd>
                <dd id="LoadInputAndRegister.or_" class="function">or_</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>