<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.1.0"/>
    <title>simmate.calculators.vasp.inputs.incar API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../inputs.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simmate.calculators.vasp.inputs</a>

<a href="https://github.com/jacksund/simmate">            <img src="https://github.com/jacksund/simmate/blob/main/src/simmate/website/static_files/images/simmate-logo.svg?raw=true" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Incar">Incar</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Incar.__init__">Incar</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.to_evaluated_str">to_evaluated_str</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.to_file">to_file</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.from_file">from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.compare_incars">compare_incars</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_density">keyword_modifier_density</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_density_a">keyword_modifier_density_a</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_density_b">keyword_modifier_density_b</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_density_c">keyword_modifier_density_c</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_per_atom">keyword_modifier_per_atom</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_smart_magmom">keyword_modifier_smart_magmom</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_smart_lmaxmix">keyword_modifier_smart_lmaxmix</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_smart_ldau">keyword_modifier_smart_ldau</a>
                        </li>
                        <li>
                                <a class="function" href="#Incar.keyword_modifier_smart_ismear">keyword_modifier_smart_ismear</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                        <a class="pdoc-button git-button" href="https://github.com/jacksund/simmate/tree/main/src/simmate/calculators/vasp/inputs/incar.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../../../../simmate.html">simmate</a><wbr>.<a href="./../../../calculators.html">calculators</a><wbr>.<a href="./../../vasp.html">vasp</a><wbr>.<a href="./../inputs.html">inputs</a><wbr>.incar    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="L-0"><a href="#L-0"><span class="linenos">  0</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="k">class</span> <span class="nc">Incar</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">    INCAR object for reading and writing INCAR files. This behaves exactly like</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">    a python dictionary, but has a few extra checks and methods attached to it.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">    You can pass it a dictionary or initialize it just like you would dict(kwargs).</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">    You can consider the dict(kwargs) as equivalent to Incar(parameters).</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">    If you want a given setting to be dependent on the structure or dynamically</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    determined, then we implement these modifiers. This would enable us to</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    do things like ENCUT__per_atom or NGZF__density. We can even have more complex</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    modifiers like multiple_keywords__smart_ldau which signals that our</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    &quot;smart_ldau&quot; modifier introduces more than one new setting to the INCAR, such</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    as LDAUJ, LDAUU, LDAUL, LDAUTYPE, and LDAUPRINT.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    TODO: In the future, I want to allow modifiers like __relative_to_previous</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    and __use_previous to string settings accross tasks.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>        <span class="c1"># The kwargs are a dictionary of parameters (e.g. {&quot;PREC&quot;: &quot;accurate&quot;})</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="c1"># Establish the dictionary with the given input</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="c1"># This is the same as doing dict(**kwargs)</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="c1"># Based on the kwargs, go through and make sure each parameter is in</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="c1"># it&#39;s expected datatype. Thus users can supply strings in the typical</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="c1"># VASP format that will be convert to python types here.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="c1"># OPTIMIZE -- would it be faster if I only did this on from_file init?</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="c1"># and therefore assumed the user to initialize this with proper python</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="c1"># datatypes and formatting? Also will this behave properly if the value</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="c1"># is already in the correct format?</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>            <span class="c1"># parameters may have tags like &quot;__density&quot; added onto them. We don&#39;t</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>            <span class="c1"># convert to the datatype yet, but instead wait until a structure</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="c1"># is provided (when the to_file or str methods are called below).</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>            <span class="c1"># These are defined in python and should already be in the correct</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>            <span class="c1"># data format.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>            <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">parameter</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="c1"># Otherwise, we need to convert values to the proper python datatype</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>            <span class="c1"># because we might be reading from a file where everything is a string</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>                <span class="n">formatted_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_to_datatype</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">parameter</span><span class="p">:</span> <span class="n">formatted_value</span><span class="p">})</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="c1"># SPECIAL CASE</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="c1"># If you have LSORBIT=True or LNONCOLLINEAR=True, the MAGMOM class needs</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="c1"># to take on a different form. Instead of a single MAGMOM being set as</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="c1"># a float, it&#39;s now a vector (x,y,z). For example:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="c1">#   MAGMOM = x1 y1 z1    x2 y2 z2    x3 y3 z3 ...</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="c1">#       [...instead of...]</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="c1">#   MAGMOM = value1 value2 value3 ...</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="c1"># Check if MAGMOM is set along with LSORBIT or LNONCOLLINEAR being True</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;MAGMOM&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LSORBIT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>            <span class="c1"># convert the MAGMOM value from...</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>            <span class="c1">#   [x1,y1,z1,x2,y2,z2,x3,y3,z3] (this can be a string too)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="c1">#   to...</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>            <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="n">old_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">]</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>            <span class="n">new_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">old_format</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_format</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>            <span class="c1"># Or If I wanted to do the same thing with numpy:</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>            <span class="c1">#   new_format = numpy.array_split(old_format, len(old_format) // 3)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="c1"># now update the dictionary with this value</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">:</span> <span class="n">new_format</span><span class="p">})</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">to_evaluated_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="c1"># Let&#39;s start with an empty string and build from there</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">final_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="c1"># First we need to iterate through all parameters and check if we have</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="c1"># ones that are structure-specific. For example, we would need to</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="c1"># evaluate &quot;ENCUT__per_atom&quot;. We go through all these and collect the</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="c1"># paramters into a final settings list.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="n">final_settings</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="c1"># if there is no modifier attached to the parameter, we just keep it as-is</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                <span class="n">final_settings</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>            <span class="c1"># Otherwise we have a modifier like &quot;__density&quot; and need to evaluate it</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>                <span class="c1"># make sure we have a structure supplied because all modifiers</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                <span class="c1"># require one.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                        <span class="s2">&quot;It looks like you used a keyword modifier but didn&#39;t &quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                        <span class="sa">f</span><span class="s2">&quot;supply a structure! If you want to use </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                        <span class="s2">&quot;then you need to make sure you provide a structure so &quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                        <span class="s2">&quot;that the modifier can be evaluated.&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                    <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="c1"># separate the input into the base parameter and modifier.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                <span class="c1"># This also overwrites what our paramter value is.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="n">parameter</span><span class="p">,</span> <span class="n">modifier_tag</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                <span class="c1"># check that this class has this modifier supported. It should</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>                <span class="c1"># be a method named &quot;keyword_modifier_mymodifer&quot;.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                <span class="c1"># If everything looks good, we grab the modifier function</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>                <span class="n">modifier_fxn_name</span> <span class="o">=</span> <span class="s2">&quot;keyword_modifier_&quot;</span> <span class="o">+</span> <span class="n">modifier_tag</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier_fxn_name</span><span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                    <span class="n">modifier_fxn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier_fxn_name</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">                        It looks like you used a keyword modifier that hasn&#39;t</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">                        been defined yet! If you want something like ENCUT__smart_encut,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">                        then you need to make sure there is a keyword_modifier_smart_encut</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">                        method available.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">                        &quot;&quot;&quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                    <span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                <span class="c1"># now that we have the modifier function, let&#39;s use it to update</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="c1"># our value for this keyword.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">modifier_fxn</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                <span class="c1"># if the &quot;parameter&quot; is actually &quot;multiple_keywords&quot;, then we</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                <span class="c1"># have our actually parameters as a dictionary. We need to</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                <span class="c1"># pull these out of the &quot;value&quot; we have.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="s2">&quot;multiple_keywords&quot;</span><span class="p">:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                    <span class="k">for</span> <span class="n">subparameter</span><span class="p">,</span> <span class="n">subvalue</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                        <span class="n">final_settings</span><span class="p">[</span><span class="n">subparameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">subvalue</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                <span class="c1"># otherwise we were just given back an update value</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                    <span class="n">final_settings</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="c1"># Now that we have all of our parameters evaluated for the structure, we</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="c1"># iterate through each parameter and its set value. Each one will be</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="c1"># put on a separate line.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">final_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="c1"># let&#39;s start by adding the parameter key to our output</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="c1"># It will be followed by an equal sign to separate it&#39;s value</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">final_str</span> <span class="o">+=</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="c1"># If we have a value that is a list (or list of lists)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="c1"># check if we have a list of lists</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="c1"># Take MAGMOM with LSORBIT=True as an example, where we convert...</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                <span class="c1"># to...</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="c1"># &quot;x1 y1 z1 x2 y2 z2 x3 y3 z3&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                    <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="c1"># otherwise we just have a list of items</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                <span class="c1"># converts [1, 2, 3] to &quot;1 2 3&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                    <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="c1"># if it&#39;s not a list, we can just save the string of the value</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                <span class="n">final_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>            <span class="c1"># we want to start each parameter on a new line, so we need to</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="c1"># add this at the end of each. There will be an extra new line at</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="c1"># the end of the file, but that&#39;s alright</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>            <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="c1"># we now have our final string and can return it!</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="n">final_str</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        Write Incar to a file.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            filename (str): filename to write to.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="c1"># we just take the string format and put it in a file</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_evaluated_str</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">))</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        Reads an Incar object from a file.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        Args:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">            filename (str): Filename for file</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        Returns:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">            Incar object</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="c1"># open the file, grab the lines, and then close it</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="c1"># store parameters in this dictionary</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="c1"># go through line by line</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="c1"># If the line starts with a # then its a comment and we should skip.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="c1"># It also could be an empty line that we should skip,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="k">continue</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="c1"># multiple parameters on a single line are separated by a semicolon</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="k">for</span> <span class="n">sub_line</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="c1"># the PARAMETER and VALUE are separated by equal sign</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sub_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                <span class="c1"># we can use the parameter/value to update our dictionary. The</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="c1"># last thing we do is remove leading/trailing whitespace with strip()</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="c1"># return the final dictionary as an Incar object</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">_str_to_datatype</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        When given a vasp parameter and it&#39;s value as a string, this helper</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        function will use the key (parameter) to determine how to convert the</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        val string to the proper python datatype (int, float, bool, list...).</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        I have the most common keys mapped out, but if a parameter is given that</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        isn&#39;t mapped, I simply leave it as a string.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="c1"># I outline the most common keys to what their expected data types are.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="c1"># OPTIMIZE -- I should set these elsewhere so that these lists are not</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="c1"># initialized every time I call this function. Maybe have a dictionary</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="c1"># of {Parameter: Value_datatype} in the main enviornment for use.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">vector_list_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="c1"># &quot;MAGMOM&quot;,  # depends on other args -- see notes in init</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="s2">&quot;DIPOL&quot;</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="n">float_list_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="s2">&quot;LDAUU&quot;</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="s2">&quot;MAGMOM&quot;</span><span class="p">,</span>  <span class="c1"># depends on other args -- see notes in init</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="s2">&quot;LANGEVIN_GAMMA&quot;</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="s2">&quot;QUAD_EFG&quot;</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="s2">&quot;EINT&quot;</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="n">int_list_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="s2">&quot;EINT&quot;</span><span class="p">,</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">bool_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="s2">&quot;LDAU&quot;</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="s2">&quot;LWAVE&quot;</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="s2">&quot;LSCALU&quot;</span><span class="p">,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="s2">&quot;LCHARG&quot;</span><span class="p">,</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="s2">&quot;LPLANE&quot;</span><span class="p">,</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="s2">&quot;LUSE_VDW&quot;</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="s2">&quot;LHFCALC&quot;</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="s2">&quot;ADDGRID&quot;</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="s2">&quot;LSORBIT&quot;</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="s2">&quot;KGAMMA&quot;</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="n">float_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="s2">&quot;EDIFF&quot;</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="s2">&quot;SIGMA&quot;</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="s2">&quot;ENCUTFOCK&quot;</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="s2">&quot;HFSCREEN&quot;</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="s2">&quot;POTIM&quot;</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="s2">&quot;EDIFFG&quot;</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="s2">&quot;AGGAC&quot;</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="s2">&quot;PARAM1&quot;</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="s2">&quot;PARAM2&quot;</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="s2">&quot;KSPACING&quot;</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="s2">&quot;SYMPREC&quot;</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="s2">&quot;AMIX&quot;</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="s2">&quot;BMIX&quot;</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="s2">&quot;AMIN&quot;</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="s2">&quot;SMASS&quot;</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="s2">&quot;AMIX_MAG&quot;</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="s2">&quot;BMIX_MAG&quot;</span><span class="p">,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">int_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="s2">&quot;NSW&quot;</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="s2">&quot;NBANDS&quot;</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="s2">&quot;NELMIN&quot;</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="s2">&quot;ISIF&quot;</span><span class="p">,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="s2">&quot;IBRION&quot;</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="s2">&quot;ISPIN&quot;</span><span class="p">,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="s2">&quot;ICHARG&quot;</span><span class="p">,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>            <span class="s2">&quot;NELM&quot;</span><span class="p">,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="s2">&quot;ISMEAR&quot;</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="s2">&quot;NPAR&quot;</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">,</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="s2">&quot;LMAXMIX&quot;</span><span class="p">,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="s2">&quot;ENCUT&quot;</span><span class="p">,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="s2">&quot;NSIM&quot;</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="s2">&quot;NKRED&quot;</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="s2">&quot;NUPDOWN&quot;</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>            <span class="s2">&quot;ISPIND&quot;</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>            <span class="s2">&quot;IVDW&quot;</span><span class="p">,</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="s2">&quot;ISTART&quot;</span><span class="p">,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>            <span class="s2">&quot;NELMDL&quot;</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="s2">&quot;IMIX&quot;</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="s2">&quot;ISYM&quot;</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="c1"># If the value is not a string, then assume we are already in the</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="c1"># correct format. Note, an incorrect format will throw an error</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="c1"># somewhere below, which may be tricky for beginners to traceback.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="c1"># if the parameter is in int_keys</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">int_keys</span><span class="p">:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="c1"># sometimes &quot;1.&quot; was written to indicate an integer so check for</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="c1"># this and remove it if needed.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="c1"># return the value integer</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="c1"># if the parameter is in float_keys, we convert value to a float</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">float_keys</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="c1"># return the value float</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="c1"># if the parameter is in bool_keys</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">bool_keys</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="c1"># Python is weird where bool(&quot;FALSE&quot;) will return True... So I need</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="c1"># to convert the string to lowercase and read it to know what to</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="c1"># return here.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="c1"># if the parameter is in vector_list_keys</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="c1"># These vectors are always floats</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">vector_list_keys</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="c1"># convert a string of...</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="c1">#   &quot;x1 y1 z1 x2 y2 z2 x3 y3 z3&quot;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="c1"># to...</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="c1">#   [x1,y1,z1,x2,y2,z2,x3,y3,z3] (list of floats)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="c1"># and then to...</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="c1"># if the parameter is in float_list_keys</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">float_list_keys</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="c1"># if the parameter is in int_list_keys</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">int_list_keys</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="c1"># If it is not in the common keys listed, just leave it as a string.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">compare_incars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_incar</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        Compares two Incars and indicates which parameters are the same and</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        which are not. Useful for checking whether two runs were done using</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        the same parameters.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        Args:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">            other (Incar): The other Incar object to compare to.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        Returns:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">            Dict of the following format:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            {&quot;Same&quot; : parameters_that_are_the_same,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">            &quot;Different&quot;: parameters_that_are_different}</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">            The value of the other_incar is returned for the paramters that</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">            are different are returned as {Parameter: (incar_value, other_incar_value)}</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">            where None is used as a placeholder. For the same parameters, the</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            dictionary is returned as {Parameter: shared_value}</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">same_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">different_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="c1"># make a collection of all unique keys used by the two dictionaries</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="c1"># I convert to list() so I can use set() below.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="c1"># OPTIMIZE -- is there a better way to do this?</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">parameters1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">parameters2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other_incar</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="c1"># iterate through each unique parameter</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">parameters1</span> <span class="o">+</span> <span class="n">parameters2</span><span class="p">):</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="c1"># try to grab the value from both Incar objects</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="c1"># If it doesn&#39;t have the value, None will be provided</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">value2</span> <span class="o">=</span> <span class="n">other_incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>            <span class="c1"># compare the two and store</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="k">if</span> <span class="n">value1</span> <span class="o">==</span> <span class="n">value2</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                <span class="c1"># it doesn&#39;t matter which value I grab so I just use value1</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="n">same_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value1</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="c1"># if they are different...</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                <span class="n">different_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Same&quot;</span><span class="p">:</span> <span class="n">same_parameters</span><span class="p">,</span> <span class="s2">&quot;Different&quot;</span><span class="p">:</span> <span class="n">different_parameters</span><span class="p">}</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        Add all the values of another INCAR object to this object.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        Facilitates the use of &quot;standard&quot; INCARs.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="c1"># start by copying this incar&#39;s settings</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="n">new_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="c1"># now iterate through the other incar parameters to incorporate them</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="c1"># If both have a given parameter, make sure they are the same values</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">[</span><span class="n">parameter</span><span class="p">]:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="c1"># If not, we shouldn&#39;t allow combining these Incars as it can</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                <span class="c1"># lead to undesired results.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                    <span class="sa">f</span><span class="s2">&quot;Incars have conflicting values! One conflict is with </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                    <span class="sa">f</span><span class="s2">&quot;where one incar has </span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span><span class="si">}</span><span class="s2"> and the other has </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                <span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="c1"># otherwise just set the value</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                <span class="n">new_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="c1"># now return the new Incar</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="n">new_parameters</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="c1"># All methods below are modifiers that users can apply. I may move these to</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="c1"># a separate class (e.g. KeywordModifier).</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        The __density modifier means the user wants a specific density. They</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        provide this density in per-angstrom^3 units and we return the</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        structure-specific count that gives this density.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        For example, density=10 and a structure lattice that volume of 5,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        then this returns value=10*5=50.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_a</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        The __density_a modifier means the user wants a specific density along</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        the A lattice vector. They provide this density in per-angstrom units</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        and we return the structure-specific count that gives this density.</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        For example, density=10 and a structure lattice that A vector of 5,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        then this returns value=10*5=50.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_b</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_c</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_per_atom</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">per_atom_value</span><span class="p">):</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        The __per_atom modifier means the user wants a specific value per atom</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        in the unit cell. For example, EDIFF__per_atom=1e-5 and a structure</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        with 50 sites in it would return a value of 1e-5*50=50.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="n">per_atom_value</span> <span class="o">*</span> <span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_magmom</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">override_values</span><span class="p">):</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        The __smart_magmom modifier goes through a series of checks to decide</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        what to set the MAGMOM as for VASP. In order of priority they are...</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">            (1) the magmom property attached to each site in the structure object</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">            (2) the spin property attached to the site&#39;s specie</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">            (3) a value provided explicitly (e.g. {&quot;Co&quot;: 0.5})</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">            (4) a value of 0.6</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="c1"># grab the default MAGMOM supplied, or use VASP&#39;s default of 1 otherwise</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">default_value</span> <span class="o">=</span> <span class="n">override_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="c1"># we go through each site in the structure and decide what to set the</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="c1"># MAGMOM for each. This allows even different sites of the same</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="c1"># element to have their own MAGMOM</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">magnetic_moments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>            <span class="c1"># if the structure object has magmom-decorated sites, we use that</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="c1"># as our first priority</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="s2">&quot;magmom&quot;</span><span class="p">):</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="c1"># next we check if the site&#39;s specie has a spin</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">):</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="c1"># we then look at the override dictionary if there was one provided.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="c1"># If note, we use 0.6 as a default.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>                <span class="n">magnetic_moment</span> <span class="o">=</span> <span class="n">override_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magnetic_moment</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="c1"># This feature is in pymatgen, but I haven&#39;t added it here yet.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="c1"># if self.constrain_total_magmom:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="c1">#     nupdown = sum([mag if abs(mag) &gt; 0.6 else 0 for mag in incar[&quot;MAGMOM&quot;]])</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="c1">#     incar[&quot;NUPDOWN&quot;] = nupdown</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="k">return</span> <span class="n">magnetic_moments</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_lmaxmix</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">lmaxmix_config</span><span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        This modifier sets LMAXMIX if there are any d or f electrons present</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">        in the structure.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="c1"># COMMENT (from pymatgen team):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="c1"># Note that if the user explicitly sets LMAXMIX in settings it will</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="c1"># override this logic.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="c1"># Previously, this was only set if Hubbard U was enabled as per the</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="c1"># VASP manual but following an investigation it was determined that</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="c1"># this would lead to a significant difference between SCF -&gt; NonSCF</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="c1"># even without Hubbard U enabled. Thanks to Andrew Rosen for</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="c1"># investigating and reporting.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="c1"># first iterate through all elements and check for f-electrons</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">56</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="k">return</span> <span class="mi">6</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="c1"># now check for elements that contain d-electrons</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>            <span class="k">return</span> <span class="mi">4</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="c1"># otherwise use the default for VASP</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="k">return</span> <span class="mi">2</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_ldau</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ldau_config</span><span class="p">):</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">        This modifier handles a series of keyword arguments that are associated</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">        with LDAU, including LDAUJ, LDAUL, LDAUTYPE, LDAUU, LDAUPRINT, and LMAXMIX.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">        Therefore, a complex dictionary is passed to this. The format looks like this...</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">            LDAU__multiple_keywords__smart_ldau = dict(</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">                LDAU__auto=True,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">                LDAUTYPE=2,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">                LDAUPRINT=1,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">                LDAUJ={...},</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">                LDAUL={...},</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">                LDAUU={...},</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">                LMAXMIX__auto=True,</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">                )</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">        The LDAUJ, LDAUL, and LDAUU values can be a dictionary of elements to</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">        value, or (most commonly) a nested dictionary. For example...</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">            LDAUJ = {&quot;F&quot;:{&quot;Co&quot;:0}}</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        This would mean if the structure is a fluoride, set the LDAUJ for Co to 0.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">        If there are multiple options here (e.g. for fluorides and oxides), then</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">        priority is placed on the most electronegative element. This would mean</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">        some thing like yttrium oxide fluoride would be treated as a fluoride over</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">        an oxide.</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="c1"># first we need to go through the LDAUJ, LDAUL, and LDAUU keywords and</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="c1"># see what their values are. If all of these end up be 0 for all elements</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>        <span class="c1"># then we actually don&#39;t need LDAU at all! Therefore, we&#39;ll go through</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="c1"># all of these keywords and build a dictionary of settings to return</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="c1"># at the end of this function</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="n">ldau_settings</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="c1"># To help decide how we set these values, let&#39;s check what the most</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="c1"># electronegative element is, which will be last in the sorted composition</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="n">most_electroneg</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="c1"># As we go through these settings, we want see if we are even using LDAU.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>        <span class="c1"># For example if we ran a calculation on NaCl, we&#39;d probably see that</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="c1"># all LDAUJ/LDAUL/LDAUU values are just 0. In that case, we can just</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="c1"># throw away (i.e. turn off) all LDAU settings. Therefore, we have a term</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="c1"># &quot;using_ldau&quot; that is false until proven otherwise.</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>        <span class="n">using_ldau</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="k">for</span> <span class="n">ldau_keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUU&quot;</span><span class="p">]:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>            <span class="c1"># grab the sub-dictionary that maps elements to this keyword.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="c1"># If it&#39;s not there, just use an empty dictionary.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>            <span class="n">keyword_config</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ldau_keyword</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>            <span class="c1"># check if the most electronegative element is in the override_values</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>            <span class="c1"># and if so, see if it has a subdictionary in it. We use this</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>            <span class="c1"># dictionary as our base one to pull values from.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>            <span class="k">if</span> <span class="n">most_electroneg</span> <span class="ow">in</span> <span class="n">keyword_config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>                <span class="n">keyword_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">],</span> <span class="nb">dict</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>            <span class="p">):</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>                <span class="n">keyword_config</span> <span class="o">=</span> <span class="n">keyword_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">]</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>            <span class="c1"># now iterate through all the sites and grab the assigned value. If nothing</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>            <span class="c1"># is set then the default is 0.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                <span class="n">keyword_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="p">]</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="c1"># now that we have this keyword all set, we add it to our results</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="n">ldau_keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>            <span class="c1"># check to see if we are using ldau here (i.e. any value is not 0)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>                <span class="n">using_ldau</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="c1"># now check if we actaully need LDAU here. If not, we can throw out all</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="c1"># settings and just return an empty dictionary</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="k">if</span> <span class="n">using_ldau</span> <span class="ow">and</span> <span class="s2">&quot;LDAU__auto&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="c1"># The remaining LDAU keywords are LDAUPRINT and LDAUTYPE, which we just</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="c1"># leave at what is set in the input</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="k">if</span> <span class="s2">&quot;LDAUPRINT&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="k">if</span> <span class="s2">&quot;LDAUTYPE&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="n">ldau_settings</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_ismear</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ismear_config</span><span class="p">):</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">        The smearing value used here depends on if we have a semiconductor,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">        insulator, or metal. This modifier makes a &quot;best-guess&quot; on what the</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">        material is and uses the proper smearing type. Note that if this</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">        guess is wrong, it is useful to have the IncorrectSmearing error</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">        handler to fix this as VASP runs.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">        Read more about the VASP recommended ISMEAR settings here:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">            https://www.vasp.at/wiki/index.php/ISMEAR</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="c1"># for now we just go through the structure and if all elements are</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="c1"># metals, then we say it&#39;s a metal. Otherwise, we treat the structure</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>        <span class="c1"># as a semiconductor or insulator.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">is_metal</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>            <span class="n">ismear_settings</span> <span class="o">=</span> <span class="n">ismear_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metal&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="n">ismear_settings</span> <span class="o">=</span> <span class="n">ismear_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;non-metal&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>        <span class="k">return</span> <span class="n">ismear_settings</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="c1"># To introduce other modifiers that pymatgen uses...</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="c1"># https://github.com/materialsproject/pymatgen/blob/b789d74639aa851d7e5ee427a765d9fd5a8d1079/pymatgen/io/vasp/sets.py#L500</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="c1"># if self.use_structure_charge:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="c1">#     incar[&quot;NELECT&quot;] = self.nelect</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a><span class="c1"># Ensure adequate number of KPOINTS are present for the tetrahedron</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="c1"># method (ISMEAR=-5). If KSPACING is in the INCAR file the number</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="c1"># of kpoints is not known before calling VASP, but a warning is raised</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="c1"># when the KSPACING value is &gt; 0.5 (2 reciprocal Angstrom).</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a><span class="c1"># An error handler in Custodian is available to</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a><span class="c1"># correct overly large KSPACING values (small number of kpoints)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a><span class="c1"># if necessary.</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a><span class="c1"># if &quot;KSPACING&quot; not in self.user_incar_settings.keys():</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a><span class="c1"># if self.kpoints is not None:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="c1">#     if np.product(self.kpoints.kpts) &lt; 4 and incar.get(&quot;ISMEAR&quot;, 0) == -5:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="c1">#         incar[&quot;ISMEAR&quot;] = 0</span>
</span></pre></div>

        </details>

            </section>
                <section id="Incar">
                                <div class="attr class">
        <a class="headerlink" href="#Incar">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Incar</span><wbr>(<span class="base">builtins.dict</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar-6"><a href="#Incar-6"><span class="linenos">  6</span></a><span class="k">class</span> <span class="nc">Incar</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="Incar-7"><a href="#Incar-7"><span class="linenos">  7</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-8"><a href="#Incar-8"><span class="linenos">  8</span></a><span class="sd">    INCAR object for reading and writing INCAR files. This behaves exactly like</span>
</span><span id="Incar-9"><a href="#Incar-9"><span class="linenos">  9</span></a><span class="sd">    a python dictionary, but has a few extra checks and methods attached to it.</span>
</span><span id="Incar-10"><a href="#Incar-10"><span class="linenos"> 10</span></a><span class="sd">    You can pass it a dictionary or initialize it just like you would dict(kwargs).</span>
</span><span id="Incar-11"><a href="#Incar-11"><span class="linenos"> 11</span></a><span class="sd">    You can consider the dict(kwargs) as equivalent to Incar(parameters).</span>
</span><span id="Incar-12"><a href="#Incar-12"><span class="linenos"> 12</span></a>
</span><span id="Incar-13"><a href="#Incar-13"><span class="linenos"> 13</span></a><span class="sd">    If you want a given setting to be dependent on the structure or dynamically</span>
</span><span id="Incar-14"><a href="#Incar-14"><span class="linenos"> 14</span></a><span class="sd">    determined, then we implement these modifiers. This would enable us to</span>
</span><span id="Incar-15"><a href="#Incar-15"><span class="linenos"> 15</span></a><span class="sd">    do things like ENCUT__per_atom or NGZF__density. We can even have more complex</span>
</span><span id="Incar-16"><a href="#Incar-16"><span class="linenos"> 16</span></a><span class="sd">    modifiers like multiple_keywords__smart_ldau which signals that our</span>
</span><span id="Incar-17"><a href="#Incar-17"><span class="linenos"> 17</span></a><span class="sd">    &quot;smart_ldau&quot; modifier introduces more than one new setting to the INCAR, such</span>
</span><span id="Incar-18"><a href="#Incar-18"><span class="linenos"> 18</span></a><span class="sd">    as LDAUJ, LDAUU, LDAUL, LDAUTYPE, and LDAUPRINT.</span>
</span><span id="Incar-19"><a href="#Incar-19"><span class="linenos"> 19</span></a>
</span><span id="Incar-20"><a href="#Incar-20"><span class="linenos"> 20</span></a><span class="sd">    TODO: In the future, I want to allow modifiers like __relative_to_previous</span>
</span><span id="Incar-21"><a href="#Incar-21"><span class="linenos"> 21</span></a><span class="sd">    and __use_previous to string settings accross tasks.</span>
</span><span id="Incar-22"><a href="#Incar-22"><span class="linenos"> 22</span></a>
</span><span id="Incar-23"><a href="#Incar-23"><span class="linenos"> 23</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Incar-24"><a href="#Incar-24"><span class="linenos"> 24</span></a>
</span><span id="Incar-25"><a href="#Incar-25"><span class="linenos"> 25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Incar-26"><a href="#Incar-26"><span class="linenos"> 26</span></a>
</span><span id="Incar-27"><a href="#Incar-27"><span class="linenos"> 27</span></a>        <span class="c1"># The kwargs are a dictionary of parameters (e.g. {&quot;PREC&quot;: &quot;accurate&quot;})</span>
</span><span id="Incar-28"><a href="#Incar-28"><span class="linenos"> 28</span></a>
</span><span id="Incar-29"><a href="#Incar-29"><span class="linenos"> 29</span></a>        <span class="c1"># Establish the dictionary with the given input</span>
</span><span id="Incar-30"><a href="#Incar-30"><span class="linenos"> 30</span></a>        <span class="c1"># This is the same as doing dict(**kwargs)</span>
</span><span id="Incar-31"><a href="#Incar-31"><span class="linenos"> 31</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Incar-32"><a href="#Incar-32"><span class="linenos"> 32</span></a>
</span><span id="Incar-33"><a href="#Incar-33"><span class="linenos"> 33</span></a>        <span class="c1"># Based on the kwargs, go through and make sure each parameter is in</span>
</span><span id="Incar-34"><a href="#Incar-34"><span class="linenos"> 34</span></a>        <span class="c1"># it&#39;s expected datatype. Thus users can supply strings in the typical</span>
</span><span id="Incar-35"><a href="#Incar-35"><span class="linenos"> 35</span></a>        <span class="c1"># VASP format that will be convert to python types here.</span>
</span><span id="Incar-36"><a href="#Incar-36"><span class="linenos"> 36</span></a>        <span class="c1"># OPTIMIZE -- would it be faster if I only did this on from_file init?</span>
</span><span id="Incar-37"><a href="#Incar-37"><span class="linenos"> 37</span></a>        <span class="c1"># and therefore assumed the user to initialize this with proper python</span>
</span><span id="Incar-38"><a href="#Incar-38"><span class="linenos"> 38</span></a>        <span class="c1"># datatypes and formatting? Also will this behave properly if the value</span>
</span><span id="Incar-39"><a href="#Incar-39"><span class="linenos"> 39</span></a>        <span class="c1"># is already in the correct format?</span>
</span><span id="Incar-40"><a href="#Incar-40"><span class="linenos"> 40</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar-41"><a href="#Incar-41"><span class="linenos"> 41</span></a>
</span><span id="Incar-42"><a href="#Incar-42"><span class="linenos"> 42</span></a>            <span class="c1"># parameters may have tags like &quot;__density&quot; added onto them. We don&#39;t</span>
</span><span id="Incar-43"><a href="#Incar-43"><span class="linenos"> 43</span></a>            <span class="c1"># convert to the datatype yet, but instead wait until a structure</span>
</span><span id="Incar-44"><a href="#Incar-44"><span class="linenos"> 44</span></a>            <span class="c1"># is provided (when the to_file or str methods are called below).</span>
</span><span id="Incar-45"><a href="#Incar-45"><span class="linenos"> 45</span></a>            <span class="c1"># These are defined in python and should already be in the correct</span>
</span><span id="Incar-46"><a href="#Incar-46"><span class="linenos"> 46</span></a>            <span class="c1"># data format.</span>
</span><span id="Incar-47"><a href="#Incar-47"><span class="linenos"> 47</span></a>            <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="Incar-48"><a href="#Incar-48"><span class="linenos"> 48</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">parameter</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
</span><span id="Incar-49"><a href="#Incar-49"><span class="linenos"> 49</span></a>
</span><span id="Incar-50"><a href="#Incar-50"><span class="linenos"> 50</span></a>            <span class="c1"># Otherwise, we need to convert values to the proper python datatype</span>
</span><span id="Incar-51"><a href="#Incar-51"><span class="linenos"> 51</span></a>            <span class="c1"># because we might be reading from a file where everything is a string</span>
</span><span id="Incar-52"><a href="#Incar-52"><span class="linenos"> 52</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-53"><a href="#Incar-53"><span class="linenos"> 53</span></a>                <span class="n">formatted_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_to_datatype</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Incar-54"><a href="#Incar-54"><span class="linenos"> 54</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">parameter</span><span class="p">:</span> <span class="n">formatted_value</span><span class="p">})</span>
</span><span id="Incar-55"><a href="#Incar-55"><span class="linenos"> 55</span></a>
</span><span id="Incar-56"><a href="#Incar-56"><span class="linenos"> 56</span></a>        <span class="c1"># SPECIAL CASE</span>
</span><span id="Incar-57"><a href="#Incar-57"><span class="linenos"> 57</span></a>        <span class="c1"># If you have LSORBIT=True or LNONCOLLINEAR=True, the MAGMOM class needs</span>
</span><span id="Incar-58"><a href="#Incar-58"><span class="linenos"> 58</span></a>        <span class="c1"># to take on a different form. Instead of a single MAGMOM being set as</span>
</span><span id="Incar-59"><a href="#Incar-59"><span class="linenos"> 59</span></a>        <span class="c1"># a float, it&#39;s now a vector (x,y,z). For example:</span>
</span><span id="Incar-60"><a href="#Incar-60"><span class="linenos"> 60</span></a>        <span class="c1">#   MAGMOM = x1 y1 z1    x2 y2 z2    x3 y3 z3 ...</span>
</span><span id="Incar-61"><a href="#Incar-61"><span class="linenos"> 61</span></a>        <span class="c1">#       [...instead of...]</span>
</span><span id="Incar-62"><a href="#Incar-62"><span class="linenos"> 62</span></a>        <span class="c1">#   MAGMOM = value1 value2 value3 ...</span>
</span><span id="Incar-63"><a href="#Incar-63"><span class="linenos"> 63</span></a>        <span class="c1"># Check if MAGMOM is set along with LSORBIT or LNONCOLLINEAR being True</span>
</span><span id="Incar-64"><a href="#Incar-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;MAGMOM&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Incar-65"><a href="#Incar-65"><span class="linenos"> 65</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LSORBIT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">)</span>
</span><span id="Incar-66"><a href="#Incar-66"><span class="linenos"> 66</span></a>        <span class="p">):</span>
</span><span id="Incar-67"><a href="#Incar-67"><span class="linenos"> 67</span></a>            <span class="c1"># convert the MAGMOM value from...</span>
</span><span id="Incar-68"><a href="#Incar-68"><span class="linenos"> 68</span></a>            <span class="c1">#   [x1,y1,z1,x2,y2,z2,x3,y3,z3] (this can be a string too)</span>
</span><span id="Incar-69"><a href="#Incar-69"><span class="linenos"> 69</span></a>            <span class="c1">#   to...</span>
</span><span id="Incar-70"><a href="#Incar-70"><span class="linenos"> 70</span></a>            <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="Incar-71"><a href="#Incar-71"><span class="linenos"> 71</span></a>            <span class="n">old_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">]</span>
</span><span id="Incar-72"><a href="#Incar-72"><span class="linenos"> 72</span></a>            <span class="n">new_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">old_format</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_format</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
</span><span id="Incar-73"><a href="#Incar-73"><span class="linenos"> 73</span></a>            <span class="c1"># Or If I wanted to do the same thing with numpy:</span>
</span><span id="Incar-74"><a href="#Incar-74"><span class="linenos"> 74</span></a>            <span class="c1">#   new_format = numpy.array_split(old_format, len(old_format) // 3)</span>
</span><span id="Incar-75"><a href="#Incar-75"><span class="linenos"> 75</span></a>            <span class="c1"># now update the dictionary with this value</span>
</span><span id="Incar-76"><a href="#Incar-76"><span class="linenos"> 76</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">:</span> <span class="n">new_format</span><span class="p">})</span>
</span><span id="Incar-77"><a href="#Incar-77"><span class="linenos"> 77</span></a>
</span><span id="Incar-78"><a href="#Incar-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">to_evaluated_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Incar-79"><a href="#Incar-79"><span class="linenos"> 79</span></a>
</span><span id="Incar-80"><a href="#Incar-80"><span class="linenos"> 80</span></a>        <span class="c1"># Let&#39;s start with an empty string and build from there</span>
</span><span id="Incar-81"><a href="#Incar-81"><span class="linenos"> 81</span></a>        <span class="n">final_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Incar-82"><a href="#Incar-82"><span class="linenos"> 82</span></a>
</span><span id="Incar-83"><a href="#Incar-83"><span class="linenos"> 83</span></a>        <span class="c1"># First we need to iterate through all parameters and check if we have</span>
</span><span id="Incar-84"><a href="#Incar-84"><span class="linenos"> 84</span></a>        <span class="c1"># ones that are structure-specific. For example, we would need to</span>
</span><span id="Incar-85"><a href="#Incar-85"><span class="linenos"> 85</span></a>        <span class="c1"># evaluate &quot;ENCUT__per_atom&quot;. We go through all these and collect the</span>
</span><span id="Incar-86"><a href="#Incar-86"><span class="linenos"> 86</span></a>        <span class="c1"># paramters into a final settings list.</span>
</span><span id="Incar-87"><a href="#Incar-87"><span class="linenos"> 87</span></a>        <span class="n">final_settings</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar-88"><a href="#Incar-88"><span class="linenos"> 88</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar-89"><a href="#Incar-89"><span class="linenos"> 89</span></a>
</span><span id="Incar-90"><a href="#Incar-90"><span class="linenos"> 90</span></a>            <span class="c1"># if there is no modifier attached to the parameter, we just keep it as-is</span>
</span><span id="Incar-91"><a href="#Incar-91"><span class="linenos"> 91</span></a>            <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="Incar-92"><a href="#Incar-92"><span class="linenos"> 92</span></a>                <span class="n">final_settings</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Incar-93"><a href="#Incar-93"><span class="linenos"> 93</span></a>
</span><span id="Incar-94"><a href="#Incar-94"><span class="linenos"> 94</span></a>            <span class="c1"># Otherwise we have a modifier like &quot;__density&quot; and need to evaluate it</span>
</span><span id="Incar-95"><a href="#Incar-95"><span class="linenos"> 95</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-96"><a href="#Incar-96"><span class="linenos"> 96</span></a>
</span><span id="Incar-97"><a href="#Incar-97"><span class="linenos"> 97</span></a>                <span class="c1"># make sure we have a structure supplied because all modifiers</span>
</span><span id="Incar-98"><a href="#Incar-98"><span class="linenos"> 98</span></a>                <span class="c1"># require one.</span>
</span><span id="Incar-99"><a href="#Incar-99"><span class="linenos"> 99</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="Incar-100"><a href="#Incar-100"><span class="linenos">100</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="Incar-101"><a href="#Incar-101"><span class="linenos">101</span></a>                        <span class="s2">&quot;It looks like you used a keyword modifier but didn&#39;t &quot;</span>
</span><span id="Incar-102"><a href="#Incar-102"><span class="linenos">102</span></a>                        <span class="sa">f</span><span class="s2">&quot;supply a structure! If you want to use </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Incar-103"><a href="#Incar-103"><span class="linenos">103</span></a>                        <span class="s2">&quot;then you need to make sure you provide a structure so &quot;</span>
</span><span id="Incar-104"><a href="#Incar-104"><span class="linenos">104</span></a>                        <span class="s2">&quot;that the modifier can be evaluated.&quot;</span>
</span><span id="Incar-105"><a href="#Incar-105"><span class="linenos">105</span></a>                    <span class="p">)</span>
</span><span id="Incar-106"><a href="#Incar-106"><span class="linenos">106</span></a>
</span><span id="Incar-107"><a href="#Incar-107"><span class="linenos">107</span></a>                <span class="c1"># separate the input into the base parameter and modifier.</span>
</span><span id="Incar-108"><a href="#Incar-108"><span class="linenos">108</span></a>                <span class="c1"># This also overwrites what our paramter value is.</span>
</span><span id="Incar-109"><a href="#Incar-109"><span class="linenos">109</span></a>                <span class="n">parameter</span><span class="p">,</span> <span class="n">modifier_tag</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
</span><span id="Incar-110"><a href="#Incar-110"><span class="linenos">110</span></a>
</span><span id="Incar-111"><a href="#Incar-111"><span class="linenos">111</span></a>                <span class="c1"># check that this class has this modifier supported. It should</span>
</span><span id="Incar-112"><a href="#Incar-112"><span class="linenos">112</span></a>                <span class="c1"># be a method named &quot;keyword_modifier_mymodifer&quot;.</span>
</span><span id="Incar-113"><a href="#Incar-113"><span class="linenos">113</span></a>                <span class="c1"># If everything looks good, we grab the modifier function</span>
</span><span id="Incar-114"><a href="#Incar-114"><span class="linenos">114</span></a>                <span class="n">modifier_fxn_name</span> <span class="o">=</span> <span class="s2">&quot;keyword_modifier_&quot;</span> <span class="o">+</span> <span class="n">modifier_tag</span>
</span><span id="Incar-115"><a href="#Incar-115"><span class="linenos">115</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier_fxn_name</span><span class="p">):</span>
</span><span id="Incar-116"><a href="#Incar-116"><span class="linenos">116</span></a>                    <span class="n">modifier_fxn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier_fxn_name</span><span class="p">)</span>
</span><span id="Incar-117"><a href="#Incar-117"><span class="linenos">117</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-118"><a href="#Incar-118"><span class="linenos">118</span></a>                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="Incar-119"><a href="#Incar-119"><span class="linenos">119</span></a>                        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-120"><a href="#Incar-120"><span class="linenos">120</span></a><span class="sd">                        It looks like you used a keyword modifier that hasn&#39;t</span>
</span><span id="Incar-121"><a href="#Incar-121"><span class="linenos">121</span></a><span class="sd">                        been defined yet! If you want something like ENCUT__smart_encut,</span>
</span><span id="Incar-122"><a href="#Incar-122"><span class="linenos">122</span></a><span class="sd">                        then you need to make sure there is a keyword_modifier_smart_encut</span>
</span><span id="Incar-123"><a href="#Incar-123"><span class="linenos">123</span></a><span class="sd">                        method available.</span>
</span><span id="Incar-124"><a href="#Incar-124"><span class="linenos">124</span></a><span class="sd">                        &quot;&quot;&quot;</span>
</span><span id="Incar-125"><a href="#Incar-125"><span class="linenos">125</span></a>                    <span class="p">)</span>
</span><span id="Incar-126"><a href="#Incar-126"><span class="linenos">126</span></a>
</span><span id="Incar-127"><a href="#Incar-127"><span class="linenos">127</span></a>                <span class="c1"># now that we have the modifier function, let&#39;s use it to update</span>
</span><span id="Incar-128"><a href="#Incar-128"><span class="linenos">128</span></a>                <span class="c1"># our value for this keyword.</span>
</span><span id="Incar-129"><a href="#Incar-129"><span class="linenos">129</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">modifier_fxn</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Incar-130"><a href="#Incar-130"><span class="linenos">130</span></a>
</span><span id="Incar-131"><a href="#Incar-131"><span class="linenos">131</span></a>                <span class="c1"># if the &quot;parameter&quot; is actually &quot;multiple_keywords&quot;, then we</span>
</span><span id="Incar-132"><a href="#Incar-132"><span class="linenos">132</span></a>                <span class="c1"># have our actually parameters as a dictionary. We need to</span>
</span><span id="Incar-133"><a href="#Incar-133"><span class="linenos">133</span></a>                <span class="c1"># pull these out of the &quot;value&quot; we have.</span>
</span><span id="Incar-134"><a href="#Incar-134"><span class="linenos">134</span></a>                <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="s2">&quot;multiple_keywords&quot;</span><span class="p">:</span>
</span><span id="Incar-135"><a href="#Incar-135"><span class="linenos">135</span></a>                    <span class="k">for</span> <span class="n">subparameter</span><span class="p">,</span> <span class="n">subvalue</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar-136"><a href="#Incar-136"><span class="linenos">136</span></a>                        <span class="n">final_settings</span><span class="p">[</span><span class="n">subparameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">subvalue</span>
</span><span id="Incar-137"><a href="#Incar-137"><span class="linenos">137</span></a>
</span><span id="Incar-138"><a href="#Incar-138"><span class="linenos">138</span></a>                <span class="c1"># otherwise we were just given back an update value</span>
</span><span id="Incar-139"><a href="#Incar-139"><span class="linenos">139</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-140"><a href="#Incar-140"><span class="linenos">140</span></a>                    <span class="n">final_settings</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Incar-141"><a href="#Incar-141"><span class="linenos">141</span></a>
</span><span id="Incar-142"><a href="#Incar-142"><span class="linenos">142</span></a>        <span class="c1"># Now that we have all of our parameters evaluated for the structure, we</span>
</span><span id="Incar-143"><a href="#Incar-143"><span class="linenos">143</span></a>        <span class="c1"># iterate through each parameter and its set value. Each one will be</span>
</span><span id="Incar-144"><a href="#Incar-144"><span class="linenos">144</span></a>        <span class="c1"># put on a separate line.</span>
</span><span id="Incar-145"><a href="#Incar-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">final_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar-146"><a href="#Incar-146"><span class="linenos">146</span></a>
</span><span id="Incar-147"><a href="#Incar-147"><span class="linenos">147</span></a>            <span class="c1"># let&#39;s start by adding the parameter key to our output</span>
</span><span id="Incar-148"><a href="#Incar-148"><span class="linenos">148</span></a>            <span class="c1"># It will be followed by an equal sign to separate it&#39;s value</span>
</span><span id="Incar-149"><a href="#Incar-149"><span class="linenos">149</span></a>            <span class="n">final_str</span> <span class="o">+=</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span>
</span><span id="Incar-150"><a href="#Incar-150"><span class="linenos">150</span></a>
</span><span id="Incar-151"><a href="#Incar-151"><span class="linenos">151</span></a>            <span class="c1"># If we have a value that is a list (or list of lists)</span>
</span><span id="Incar-152"><a href="#Incar-152"><span class="linenos">152</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Incar-153"><a href="#Incar-153"><span class="linenos">153</span></a>
</span><span id="Incar-154"><a href="#Incar-154"><span class="linenos">154</span></a>                <span class="c1"># check if we have a list of lists</span>
</span><span id="Incar-155"><a href="#Incar-155"><span class="linenos">155</span></a>                <span class="c1"># Take MAGMOM with LSORBIT=True as an example, where we convert...</span>
</span><span id="Incar-156"><a href="#Incar-156"><span class="linenos">156</span></a>                <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="Incar-157"><a href="#Incar-157"><span class="linenos">157</span></a>                <span class="c1"># to...</span>
</span><span id="Incar-158"><a href="#Incar-158"><span class="linenos">158</span></a>                <span class="c1"># &quot;x1 y1 z1 x2 y2 z2 x3 y3 z3&quot;</span>
</span><span id="Incar-159"><a href="#Incar-159"><span class="linenos">159</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Incar-160"><a href="#Incar-160"><span class="linenos">160</span></a>                    <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">)</span>
</span><span id="Incar-161"><a href="#Incar-161"><span class="linenos">161</span></a>
</span><span id="Incar-162"><a href="#Incar-162"><span class="linenos">162</span></a>                <span class="c1"># otherwise we just have a list of items</span>
</span><span id="Incar-163"><a href="#Incar-163"><span class="linenos">163</span></a>                <span class="c1"># converts [1, 2, 3] to &quot;1 2 3&quot;</span>
</span><span id="Incar-164"><a href="#Incar-164"><span class="linenos">164</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-165"><a href="#Incar-165"><span class="linenos">165</span></a>                    <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Incar-166"><a href="#Incar-166"><span class="linenos">166</span></a>
</span><span id="Incar-167"><a href="#Incar-167"><span class="linenos">167</span></a>            <span class="c1"># if it&#39;s not a list, we can just save the string of the value</span>
</span><span id="Incar-168"><a href="#Incar-168"><span class="linenos">168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-169"><a href="#Incar-169"><span class="linenos">169</span></a>                <span class="n">final_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Incar-170"><a href="#Incar-170"><span class="linenos">170</span></a>
</span><span id="Incar-171"><a href="#Incar-171"><span class="linenos">171</span></a>            <span class="c1"># we want to start each parameter on a new line, so we need to</span>
</span><span id="Incar-172"><a href="#Incar-172"><span class="linenos">172</span></a>            <span class="c1"># add this at the end of each. There will be an extra new line at</span>
</span><span id="Incar-173"><a href="#Incar-173"><span class="linenos">173</span></a>            <span class="c1"># the end of the file, but that&#39;s alright</span>
</span><span id="Incar-174"><a href="#Incar-174"><span class="linenos">174</span></a>            <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Incar-175"><a href="#Incar-175"><span class="linenos">175</span></a>
</span><span id="Incar-176"><a href="#Incar-176"><span class="linenos">176</span></a>        <span class="c1"># we now have our final string and can return it!</span>
</span><span id="Incar-177"><a href="#Incar-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="n">final_str</span>
</span><span id="Incar-178"><a href="#Incar-178"><span class="linenos">178</span></a>
</span><span id="Incar-179"><a href="#Incar-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Incar-180"><a href="#Incar-180"><span class="linenos">180</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-181"><a href="#Incar-181"><span class="linenos">181</span></a><span class="sd">        Write Incar to a file.</span>
</span><span id="Incar-182"><a href="#Incar-182"><span class="linenos">182</span></a><span class="sd">        Args:</span>
</span><span id="Incar-183"><a href="#Incar-183"><span class="linenos">183</span></a><span class="sd">            filename (str): filename to write to.</span>
</span><span id="Incar-184"><a href="#Incar-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-185"><a href="#Incar-185"><span class="linenos">185</span></a>        <span class="c1"># we just take the string format and put it in a file</span>
</span><span id="Incar-186"><a href="#Incar-186"><span class="linenos">186</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Incar-187"><a href="#Incar-187"><span class="linenos">187</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_evaluated_str</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">))</span>
</span><span id="Incar-188"><a href="#Incar-188"><span class="linenos">188</span></a>
</span><span id="Incar-189"><a href="#Incar-189"><span class="linenos">189</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-190"><a href="#Incar-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">):</span>
</span><span id="Incar-191"><a href="#Incar-191"><span class="linenos">191</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-192"><a href="#Incar-192"><span class="linenos">192</span></a><span class="sd">        Reads an Incar object from a file.</span>
</span><span id="Incar-193"><a href="#Incar-193"><span class="linenos">193</span></a><span class="sd">        Args:</span>
</span><span id="Incar-194"><a href="#Incar-194"><span class="linenos">194</span></a><span class="sd">            filename (str): Filename for file</span>
</span><span id="Incar-195"><a href="#Incar-195"><span class="linenos">195</span></a><span class="sd">        Returns:</span>
</span><span id="Incar-196"><a href="#Incar-196"><span class="linenos">196</span></a><span class="sd">            Incar object</span>
</span><span id="Incar-197"><a href="#Incar-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-198"><a href="#Incar-198"><span class="linenos">198</span></a>        <span class="c1"># open the file, grab the lines, and then close it</span>
</span><span id="Incar-199"><a href="#Incar-199"><span class="linenos">199</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Incar-200"><a href="#Incar-200"><span class="linenos">200</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="Incar-201"><a href="#Incar-201"><span class="linenos">201</span></a>
</span><span id="Incar-202"><a href="#Incar-202"><span class="linenos">202</span></a>        <span class="c1"># store parameters in this dictionary</span>
</span><span id="Incar-203"><a href="#Incar-203"><span class="linenos">203</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar-204"><a href="#Incar-204"><span class="linenos">204</span></a>        <span class="c1"># go through line by line</span>
</span><span id="Incar-205"><a href="#Incar-205"><span class="linenos">205</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="Incar-206"><a href="#Incar-206"><span class="linenos">206</span></a>            <span class="c1"># If the line starts with a # then its a comment and we should skip.</span>
</span><span id="Incar-207"><a href="#Incar-207"><span class="linenos">207</span></a>            <span class="c1"># It also could be an empty line that we should skip,</span>
</span><span id="Incar-208"><a href="#Incar-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="Incar-209"><a href="#Incar-209"><span class="linenos">209</span></a>                <span class="k">continue</span>
</span><span id="Incar-210"><a href="#Incar-210"><span class="linenos">210</span></a>            <span class="c1"># multiple parameters on a single line are separated by a semicolon</span>
</span><span id="Incar-211"><a href="#Incar-211"><span class="linenos">211</span></a>            <span class="k">for</span> <span class="n">sub_line</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
</span><span id="Incar-212"><a href="#Incar-212"><span class="linenos">212</span></a>                <span class="c1"># the PARAMETER and VALUE are separated by equal sign</span>
</span><span id="Incar-213"><a href="#Incar-213"><span class="linenos">213</span></a>                <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sub_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
</span><span id="Incar-214"><a href="#Incar-214"><span class="linenos">214</span></a>                <span class="c1"># we can use the parameter/value to update our dictionary. The</span>
</span><span id="Incar-215"><a href="#Incar-215"><span class="linenos">215</span></a>                <span class="c1"># last thing we do is remove leading/trailing whitespace with strip()</span>
</span><span id="Incar-216"><a href="#Incar-216"><span class="linenos">216</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="Incar-217"><a href="#Incar-217"><span class="linenos">217</span></a>
</span><span id="Incar-218"><a href="#Incar-218"><span class="linenos">218</span></a>        <span class="c1"># return the final dictionary as an Incar object</span>
</span><span id="Incar-219"><a href="#Incar-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Incar-220"><a href="#Incar-220"><span class="linenos">220</span></a>
</span><span id="Incar-221"><a href="#Incar-221"><span class="linenos">221</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-222"><a href="#Incar-222"><span class="linenos">222</span></a>    <span class="k">def</span> <span class="nf">_str_to_datatype</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Incar-223"><a href="#Incar-223"><span class="linenos">223</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-224"><a href="#Incar-224"><span class="linenos">224</span></a><span class="sd">        When given a vasp parameter and it&#39;s value as a string, this helper</span>
</span><span id="Incar-225"><a href="#Incar-225"><span class="linenos">225</span></a><span class="sd">        function will use the key (parameter) to determine how to convert the</span>
</span><span id="Incar-226"><a href="#Incar-226"><span class="linenos">226</span></a><span class="sd">        val string to the proper python datatype (int, float, bool, list...).</span>
</span><span id="Incar-227"><a href="#Incar-227"><span class="linenos">227</span></a><span class="sd">        I have the most common keys mapped out, but if a parameter is given that</span>
</span><span id="Incar-228"><a href="#Incar-228"><span class="linenos">228</span></a><span class="sd">        isn&#39;t mapped, I simply leave it as a string.</span>
</span><span id="Incar-229"><a href="#Incar-229"><span class="linenos">229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-230"><a href="#Incar-230"><span class="linenos">230</span></a>
</span><span id="Incar-231"><a href="#Incar-231"><span class="linenos">231</span></a>        <span class="c1"># I outline the most common keys to what their expected data types are.</span>
</span><span id="Incar-232"><a href="#Incar-232"><span class="linenos">232</span></a>
</span><span id="Incar-233"><a href="#Incar-233"><span class="linenos">233</span></a>        <span class="c1"># OPTIMIZE -- I should set these elsewhere so that these lists are not</span>
</span><span id="Incar-234"><a href="#Incar-234"><span class="linenos">234</span></a>        <span class="c1"># initialized every time I call this function. Maybe have a dictionary</span>
</span><span id="Incar-235"><a href="#Incar-235"><span class="linenos">235</span></a>        <span class="c1"># of {Parameter: Value_datatype} in the main enviornment for use.</span>
</span><span id="Incar-236"><a href="#Incar-236"><span class="linenos">236</span></a>
</span><span id="Incar-237"><a href="#Incar-237"><span class="linenos">237</span></a>        <span class="n">vector_list_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Incar-238"><a href="#Incar-238"><span class="linenos">238</span></a>            <span class="c1"># &quot;MAGMOM&quot;,  # depends on other args -- see notes in init</span>
</span><span id="Incar-239"><a href="#Incar-239"><span class="linenos">239</span></a>            <span class="s2">&quot;DIPOL&quot;</span><span class="p">,</span>
</span><span id="Incar-240"><a href="#Incar-240"><span class="linenos">240</span></a>        <span class="p">)</span>
</span><span id="Incar-241"><a href="#Incar-241"><span class="linenos">241</span></a>
</span><span id="Incar-242"><a href="#Incar-242"><span class="linenos">242</span></a>        <span class="n">float_list_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Incar-243"><a href="#Incar-243"><span class="linenos">243</span></a>            <span class="s2">&quot;LDAUU&quot;</span><span class="p">,</span>
</span><span id="Incar-244"><a href="#Incar-244"><span class="linenos">244</span></a>            <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span>
</span><span id="Incar-245"><a href="#Incar-245"><span class="linenos">245</span></a>            <span class="s2">&quot;MAGMOM&quot;</span><span class="p">,</span>  <span class="c1"># depends on other args -- see notes in init</span>
</span><span id="Incar-246"><a href="#Incar-246"><span class="linenos">246</span></a>            <span class="s2">&quot;LANGEVIN_GAMMA&quot;</span><span class="p">,</span>
</span><span id="Incar-247"><a href="#Incar-247"><span class="linenos">247</span></a>            <span class="s2">&quot;QUAD_EFG&quot;</span><span class="p">,</span>
</span><span id="Incar-248"><a href="#Incar-248"><span class="linenos">248</span></a>            <span class="s2">&quot;EINT&quot;</span><span class="p">,</span>
</span><span id="Incar-249"><a href="#Incar-249"><span class="linenos">249</span></a>        <span class="p">)</span>
</span><span id="Incar-250"><a href="#Incar-250"><span class="linenos">250</span></a>        <span class="n">int_list_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Incar-251"><a href="#Incar-251"><span class="linenos">251</span></a>            <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span>
</span><span id="Incar-252"><a href="#Incar-252"><span class="linenos">252</span></a>            <span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span>
</span><span id="Incar-253"><a href="#Incar-253"><span class="linenos">253</span></a>            <span class="s2">&quot;EINT&quot;</span><span class="p">,</span>
</span><span id="Incar-254"><a href="#Incar-254"><span class="linenos">254</span></a>        <span class="p">)</span>
</span><span id="Incar-255"><a href="#Incar-255"><span class="linenos">255</span></a>
</span><span id="Incar-256"><a href="#Incar-256"><span class="linenos">256</span></a>        <span class="n">bool_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Incar-257"><a href="#Incar-257"><span class="linenos">257</span></a>            <span class="s2">&quot;LDAU&quot;</span><span class="p">,</span>
</span><span id="Incar-258"><a href="#Incar-258"><span class="linenos">258</span></a>            <span class="s2">&quot;LWAVE&quot;</span><span class="p">,</span>
</span><span id="Incar-259"><a href="#Incar-259"><span class="linenos">259</span></a>            <span class="s2">&quot;LSCALU&quot;</span><span class="p">,</span>
</span><span id="Incar-260"><a href="#Incar-260"><span class="linenos">260</span></a>            <span class="s2">&quot;LCHARG&quot;</span><span class="p">,</span>
</span><span id="Incar-261"><a href="#Incar-261"><span class="linenos">261</span></a>            <span class="s2">&quot;LPLANE&quot;</span><span class="p">,</span>
</span><span id="Incar-262"><a href="#Incar-262"><span class="linenos">262</span></a>            <span class="s2">&quot;LUSE_VDW&quot;</span><span class="p">,</span>
</span><span id="Incar-263"><a href="#Incar-263"><span class="linenos">263</span></a>            <span class="s2">&quot;LHFCALC&quot;</span><span class="p">,</span>
</span><span id="Incar-264"><a href="#Incar-264"><span class="linenos">264</span></a>            <span class="s2">&quot;ADDGRID&quot;</span><span class="p">,</span>
</span><span id="Incar-265"><a href="#Incar-265"><span class="linenos">265</span></a>            <span class="s2">&quot;LSORBIT&quot;</span><span class="p">,</span>
</span><span id="Incar-266"><a href="#Incar-266"><span class="linenos">266</span></a>            <span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">,</span>
</span><span id="Incar-267"><a href="#Incar-267"><span class="linenos">267</span></a>            <span class="s2">&quot;KGAMMA&quot;</span><span class="p">,</span>
</span><span id="Incar-268"><a href="#Incar-268"><span class="linenos">268</span></a>        <span class="p">)</span>
</span><span id="Incar-269"><a href="#Incar-269"><span class="linenos">269</span></a>        <span class="n">float_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Incar-270"><a href="#Incar-270"><span class="linenos">270</span></a>            <span class="s2">&quot;EDIFF&quot;</span><span class="p">,</span>
</span><span id="Incar-271"><a href="#Incar-271"><span class="linenos">271</span></a>            <span class="s2">&quot;SIGMA&quot;</span><span class="p">,</span>
</span><span id="Incar-272"><a href="#Incar-272"><span class="linenos">272</span></a>            <span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
</span><span id="Incar-273"><a href="#Incar-273"><span class="linenos">273</span></a>            <span class="s2">&quot;ENCUTFOCK&quot;</span><span class="p">,</span>
</span><span id="Incar-274"><a href="#Incar-274"><span class="linenos">274</span></a>            <span class="s2">&quot;HFSCREEN&quot;</span><span class="p">,</span>
</span><span id="Incar-275"><a href="#Incar-275"><span class="linenos">275</span></a>            <span class="s2">&quot;POTIM&quot;</span><span class="p">,</span>
</span><span id="Incar-276"><a href="#Incar-276"><span class="linenos">276</span></a>            <span class="s2">&quot;EDIFFG&quot;</span><span class="p">,</span>
</span><span id="Incar-277"><a href="#Incar-277"><span class="linenos">277</span></a>            <span class="s2">&quot;AGGAC&quot;</span><span class="p">,</span>
</span><span id="Incar-278"><a href="#Incar-278"><span class="linenos">278</span></a>            <span class="s2">&quot;PARAM1&quot;</span><span class="p">,</span>
</span><span id="Incar-279"><a href="#Incar-279"><span class="linenos">279</span></a>            <span class="s2">&quot;PARAM2&quot;</span><span class="p">,</span>
</span><span id="Incar-280"><a href="#Incar-280"><span class="linenos">280</span></a>            <span class="s2">&quot;KSPACING&quot;</span><span class="p">,</span>
</span><span id="Incar-281"><a href="#Incar-281"><span class="linenos">281</span></a>            <span class="s2">&quot;SYMPREC&quot;</span><span class="p">,</span>
</span><span id="Incar-282"><a href="#Incar-282"><span class="linenos">282</span></a>            <span class="s2">&quot;AMIX&quot;</span><span class="p">,</span>
</span><span id="Incar-283"><a href="#Incar-283"><span class="linenos">283</span></a>            <span class="s2">&quot;BMIX&quot;</span><span class="p">,</span>
</span><span id="Incar-284"><a href="#Incar-284"><span class="linenos">284</span></a>            <span class="s2">&quot;AMIN&quot;</span><span class="p">,</span>
</span><span id="Incar-285"><a href="#Incar-285"><span class="linenos">285</span></a>            <span class="s2">&quot;SMASS&quot;</span><span class="p">,</span>
</span><span id="Incar-286"><a href="#Incar-286"><span class="linenos">286</span></a>            <span class="s2">&quot;AMIX_MAG&quot;</span><span class="p">,</span>
</span><span id="Incar-287"><a href="#Incar-287"><span class="linenos">287</span></a>            <span class="s2">&quot;BMIX_MAG&quot;</span><span class="p">,</span>
</span><span id="Incar-288"><a href="#Incar-288"><span class="linenos">288</span></a>        <span class="p">)</span>
</span><span id="Incar-289"><a href="#Incar-289"><span class="linenos">289</span></a>        <span class="n">int_keys</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Incar-290"><a href="#Incar-290"><span class="linenos">290</span></a>            <span class="s2">&quot;NSW&quot;</span><span class="p">,</span>
</span><span id="Incar-291"><a href="#Incar-291"><span class="linenos">291</span></a>            <span class="s2">&quot;NBANDS&quot;</span><span class="p">,</span>
</span><span id="Incar-292"><a href="#Incar-292"><span class="linenos">292</span></a>            <span class="s2">&quot;NELMIN&quot;</span><span class="p">,</span>
</span><span id="Incar-293"><a href="#Incar-293"><span class="linenos">293</span></a>            <span class="s2">&quot;ISIF&quot;</span><span class="p">,</span>
</span><span id="Incar-294"><a href="#Incar-294"><span class="linenos">294</span></a>            <span class="s2">&quot;IBRION&quot;</span><span class="p">,</span>
</span><span id="Incar-295"><a href="#Incar-295"><span class="linenos">295</span></a>            <span class="s2">&quot;ISPIN&quot;</span><span class="p">,</span>
</span><span id="Incar-296"><a href="#Incar-296"><span class="linenos">296</span></a>            <span class="s2">&quot;ICHARG&quot;</span><span class="p">,</span>
</span><span id="Incar-297"><a href="#Incar-297"><span class="linenos">297</span></a>            <span class="s2">&quot;NELM&quot;</span><span class="p">,</span>
</span><span id="Incar-298"><a href="#Incar-298"><span class="linenos">298</span></a>            <span class="s2">&quot;ISMEAR&quot;</span><span class="p">,</span>
</span><span id="Incar-299"><a href="#Incar-299"><span class="linenos">299</span></a>            <span class="s2">&quot;NPAR&quot;</span><span class="p">,</span>
</span><span id="Incar-300"><a href="#Incar-300"><span class="linenos">300</span></a>            <span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">,</span>
</span><span id="Incar-301"><a href="#Incar-301"><span class="linenos">301</span></a>            <span class="s2">&quot;LMAXMIX&quot;</span><span class="p">,</span>
</span><span id="Incar-302"><a href="#Incar-302"><span class="linenos">302</span></a>            <span class="s2">&quot;ENCUT&quot;</span><span class="p">,</span>
</span><span id="Incar-303"><a href="#Incar-303"><span class="linenos">303</span></a>            <span class="s2">&quot;NSIM&quot;</span><span class="p">,</span>
</span><span id="Incar-304"><a href="#Incar-304"><span class="linenos">304</span></a>            <span class="s2">&quot;NKRED&quot;</span><span class="p">,</span>
</span><span id="Incar-305"><a href="#Incar-305"><span class="linenos">305</span></a>            <span class="s2">&quot;NUPDOWN&quot;</span><span class="p">,</span>
</span><span id="Incar-306"><a href="#Incar-306"><span class="linenos">306</span></a>            <span class="s2">&quot;ISPIND&quot;</span><span class="p">,</span>
</span><span id="Incar-307"><a href="#Incar-307"><span class="linenos">307</span></a>            <span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">,</span>
</span><span id="Incar-308"><a href="#Incar-308"><span class="linenos">308</span></a>            <span class="s2">&quot;IVDW&quot;</span><span class="p">,</span>
</span><span id="Incar-309"><a href="#Incar-309"><span class="linenos">309</span></a>            <span class="s2">&quot;ISTART&quot;</span><span class="p">,</span>
</span><span id="Incar-310"><a href="#Incar-310"><span class="linenos">310</span></a>            <span class="s2">&quot;NELMDL&quot;</span><span class="p">,</span>
</span><span id="Incar-311"><a href="#Incar-311"><span class="linenos">311</span></a>            <span class="s2">&quot;IMIX&quot;</span><span class="p">,</span>
</span><span id="Incar-312"><a href="#Incar-312"><span class="linenos">312</span></a>            <span class="s2">&quot;ISYM&quot;</span><span class="p">,</span>
</span><span id="Incar-313"><a href="#Incar-313"><span class="linenos">313</span></a>        <span class="p">)</span>
</span><span id="Incar-314"><a href="#Incar-314"><span class="linenos">314</span></a>
</span><span id="Incar-315"><a href="#Incar-315"><span class="linenos">315</span></a>        <span class="c1"># If the value is not a string, then assume we are already in the</span>
</span><span id="Incar-316"><a href="#Incar-316"><span class="linenos">316</span></a>        <span class="c1"># correct format. Note, an incorrect format will throw an error</span>
</span><span id="Incar-317"><a href="#Incar-317"><span class="linenos">317</span></a>        <span class="c1"># somewhere below, which may be tricky for beginners to traceback.</span>
</span><span id="Incar-318"><a href="#Incar-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Incar-319"><a href="#Incar-319"><span class="linenos">319</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="Incar-320"><a href="#Incar-320"><span class="linenos">320</span></a>
</span><span id="Incar-321"><a href="#Incar-321"><span class="linenos">321</span></a>        <span class="c1"># if the parameter is in int_keys</span>
</span><span id="Incar-322"><a href="#Incar-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">int_keys</span><span class="p">:</span>
</span><span id="Incar-323"><a href="#Incar-323"><span class="linenos">323</span></a>            <span class="c1"># sometimes &quot;1.&quot; was written to indicate an integer so check for</span>
</span><span id="Incar-324"><a href="#Incar-324"><span class="linenos">324</span></a>            <span class="c1"># this and remove it if needed.</span>
</span><span id="Incar-325"><a href="#Incar-325"><span class="linenos">325</span></a>            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
</span><span id="Incar-326"><a href="#Incar-326"><span class="linenos">326</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Incar-327"><a href="#Incar-327"><span class="linenos">327</span></a>            <span class="c1"># return the value integer</span>
</span><span id="Incar-328"><a href="#Incar-328"><span class="linenos">328</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Incar-329"><a href="#Incar-329"><span class="linenos">329</span></a>
</span><span id="Incar-330"><a href="#Incar-330"><span class="linenos">330</span></a>        <span class="c1"># if the parameter is in float_keys, we convert value to a float</span>
</span><span id="Incar-331"><a href="#Incar-331"><span class="linenos">331</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">float_keys</span><span class="p">:</span>
</span><span id="Incar-332"><a href="#Incar-332"><span class="linenos">332</span></a>            <span class="c1"># return the value float</span>
</span><span id="Incar-333"><a href="#Incar-333"><span class="linenos">333</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Incar-334"><a href="#Incar-334"><span class="linenos">334</span></a>
</span><span id="Incar-335"><a href="#Incar-335"><span class="linenos">335</span></a>        <span class="c1"># if the parameter is in bool_keys</span>
</span><span id="Incar-336"><a href="#Incar-336"><span class="linenos">336</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">bool_keys</span><span class="p">:</span>
</span><span id="Incar-337"><a href="#Incar-337"><span class="linenos">337</span></a>            <span class="c1"># Python is weird where bool(&quot;FALSE&quot;) will return True... So I need</span>
</span><span id="Incar-338"><a href="#Incar-338"><span class="linenos">338</span></a>            <span class="c1"># to convert the string to lowercase and read it to know what to</span>
</span><span id="Incar-339"><a href="#Incar-339"><span class="linenos">339</span></a>            <span class="c1"># return here.</span>
</span><span id="Incar-340"><a href="#Incar-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="Incar-341"><a href="#Incar-341"><span class="linenos">341</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Incar-342"><a href="#Incar-342"><span class="linenos">342</span></a>            <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="Incar-343"><a href="#Incar-343"><span class="linenos">343</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Incar-344"><a href="#Incar-344"><span class="linenos">344</span></a>
</span><span id="Incar-345"><a href="#Incar-345"><span class="linenos">345</span></a>        <span class="c1"># if the parameter is in vector_list_keys</span>
</span><span id="Incar-346"><a href="#Incar-346"><span class="linenos">346</span></a>        <span class="c1"># These vectors are always floats</span>
</span><span id="Incar-347"><a href="#Incar-347"><span class="linenos">347</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">vector_list_keys</span><span class="p">:</span>
</span><span id="Incar-348"><a href="#Incar-348"><span class="linenos">348</span></a>            <span class="c1"># convert a string of...</span>
</span><span id="Incar-349"><a href="#Incar-349"><span class="linenos">349</span></a>            <span class="c1">#   &quot;x1 y1 z1 x2 y2 z2 x3 y3 z3&quot;</span>
</span><span id="Incar-350"><a href="#Incar-350"><span class="linenos">350</span></a>            <span class="c1"># to...</span>
</span><span id="Incar-351"><a href="#Incar-351"><span class="linenos">351</span></a>            <span class="c1">#   [x1,y1,z1,x2,y2,z2,x3,y3,z3] (list of floats)</span>
</span><span id="Incar-352"><a href="#Incar-352"><span class="linenos">352</span></a>            <span class="c1"># and then to...</span>
</span><span id="Incar-353"><a href="#Incar-353"><span class="linenos">353</span></a>            <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="Incar-354"><a href="#Incar-354"><span class="linenos">354</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="Incar-355"><a href="#Incar-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
</span><span id="Incar-356"><a href="#Incar-356"><span class="linenos">356</span></a>
</span><span id="Incar-357"><a href="#Incar-357"><span class="linenos">357</span></a>        <span class="c1"># if the parameter is in float_list_keys</span>
</span><span id="Incar-358"><a href="#Incar-358"><span class="linenos">358</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">float_list_keys</span><span class="p">:</span>
</span><span id="Incar-359"><a href="#Incar-359"><span class="linenos">359</span></a>            <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="Incar-360"><a href="#Incar-360"><span class="linenos">360</span></a>
</span><span id="Incar-361"><a href="#Incar-361"><span class="linenos">361</span></a>        <span class="c1"># if the parameter is in int_list_keys</span>
</span><span id="Incar-362"><a href="#Incar-362"><span class="linenos">362</span></a>        <span class="k">elif</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">int_list_keys</span><span class="p">:</span>
</span><span id="Incar-363"><a href="#Incar-363"><span class="linenos">363</span></a>            <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</span><span id="Incar-364"><a href="#Incar-364"><span class="linenos">364</span></a>
</span><span id="Incar-365"><a href="#Incar-365"><span class="linenos">365</span></a>        <span class="c1"># If it is not in the common keys listed, just leave it as a string.</span>
</span><span id="Incar-366"><a href="#Incar-366"><span class="linenos">366</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-367"><a href="#Incar-367"><span class="linenos">367</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="Incar-368"><a href="#Incar-368"><span class="linenos">368</span></a>
</span><span id="Incar-369"><a href="#Incar-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="nf">compare_incars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_incar</span><span class="p">):</span>
</span><span id="Incar-370"><a href="#Incar-370"><span class="linenos">370</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-371"><a href="#Incar-371"><span class="linenos">371</span></a><span class="sd">        Compares two Incars and indicates which parameters are the same and</span>
</span><span id="Incar-372"><a href="#Incar-372"><span class="linenos">372</span></a><span class="sd">        which are not. Useful for checking whether two runs were done using</span>
</span><span id="Incar-373"><a href="#Incar-373"><span class="linenos">373</span></a><span class="sd">        the same parameters.</span>
</span><span id="Incar-374"><a href="#Incar-374"><span class="linenos">374</span></a><span class="sd">        Args:</span>
</span><span id="Incar-375"><a href="#Incar-375"><span class="linenos">375</span></a><span class="sd">            other (Incar): The other Incar object to compare to.</span>
</span><span id="Incar-376"><a href="#Incar-376"><span class="linenos">376</span></a><span class="sd">        Returns:</span>
</span><span id="Incar-377"><a href="#Incar-377"><span class="linenos">377</span></a><span class="sd">            Dict of the following format:</span>
</span><span id="Incar-378"><a href="#Incar-378"><span class="linenos">378</span></a><span class="sd">            {&quot;Same&quot; : parameters_that_are_the_same,</span>
</span><span id="Incar-379"><a href="#Incar-379"><span class="linenos">379</span></a><span class="sd">            &quot;Different&quot;: parameters_that_are_different}</span>
</span><span id="Incar-380"><a href="#Incar-380"><span class="linenos">380</span></a><span class="sd">            The value of the other_incar is returned for the paramters that</span>
</span><span id="Incar-381"><a href="#Incar-381"><span class="linenos">381</span></a><span class="sd">            are different are returned as {Parameter: (incar_value, other_incar_value)}</span>
</span><span id="Incar-382"><a href="#Incar-382"><span class="linenos">382</span></a><span class="sd">            where None is used as a placeholder. For the same parameters, the</span>
</span><span id="Incar-383"><a href="#Incar-383"><span class="linenos">383</span></a><span class="sd">            dictionary is returned as {Parameter: shared_value}</span>
</span><span id="Incar-384"><a href="#Incar-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-385"><a href="#Incar-385"><span class="linenos">385</span></a>
</span><span id="Incar-386"><a href="#Incar-386"><span class="linenos">386</span></a>        <span class="n">same_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar-387"><a href="#Incar-387"><span class="linenos">387</span></a>        <span class="n">different_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar-388"><a href="#Incar-388"><span class="linenos">388</span></a>
</span><span id="Incar-389"><a href="#Incar-389"><span class="linenos">389</span></a>        <span class="c1"># make a collection of all unique keys used by the two dictionaries</span>
</span><span id="Incar-390"><a href="#Incar-390"><span class="linenos">390</span></a>        <span class="c1"># I convert to list() so I can use set() below.</span>
</span><span id="Incar-391"><a href="#Incar-391"><span class="linenos">391</span></a>        <span class="c1"># OPTIMIZE -- is there a better way to do this?</span>
</span><span id="Incar-392"><a href="#Incar-392"><span class="linenos">392</span></a>        <span class="n">parameters1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Incar-393"><a href="#Incar-393"><span class="linenos">393</span></a>        <span class="n">parameters2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other_incar</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Incar-394"><a href="#Incar-394"><span class="linenos">394</span></a>
</span><span id="Incar-395"><a href="#Incar-395"><span class="linenos">395</span></a>        <span class="c1"># iterate through each unique parameter</span>
</span><span id="Incar-396"><a href="#Incar-396"><span class="linenos">396</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">parameters1</span> <span class="o">+</span> <span class="n">parameters2</span><span class="p">):</span>
</span><span id="Incar-397"><a href="#Incar-397"><span class="linenos">397</span></a>
</span><span id="Incar-398"><a href="#Incar-398"><span class="linenos">398</span></a>            <span class="c1"># try to grab the value from both Incar objects</span>
</span><span id="Incar-399"><a href="#Incar-399"><span class="linenos">399</span></a>            <span class="c1"># If it doesn&#39;t have the value, None will be provided</span>
</span><span id="Incar-400"><a href="#Incar-400"><span class="linenos">400</span></a>            <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
</span><span id="Incar-401"><a href="#Incar-401"><span class="linenos">401</span></a>            <span class="n">value2</span> <span class="o">=</span> <span class="n">other_incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
</span><span id="Incar-402"><a href="#Incar-402"><span class="linenos">402</span></a>
</span><span id="Incar-403"><a href="#Incar-403"><span class="linenos">403</span></a>            <span class="c1"># compare the two and store</span>
</span><span id="Incar-404"><a href="#Incar-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">value1</span> <span class="o">==</span> <span class="n">value2</span><span class="p">:</span>
</span><span id="Incar-405"><a href="#Incar-405"><span class="linenos">405</span></a>                <span class="c1"># it doesn&#39;t matter which value I grab so I just use value1</span>
</span><span id="Incar-406"><a href="#Incar-406"><span class="linenos">406</span></a>                <span class="n">same_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value1</span>
</span><span id="Incar-407"><a href="#Incar-407"><span class="linenos">407</span></a>            <span class="c1"># if they are different...</span>
</span><span id="Incar-408"><a href="#Incar-408"><span class="linenos">408</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-409"><a href="#Incar-409"><span class="linenos">409</span></a>                <span class="n">different_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span>
</span><span id="Incar-410"><a href="#Incar-410"><span class="linenos">410</span></a>
</span><span id="Incar-411"><a href="#Incar-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Same&quot;</span><span class="p">:</span> <span class="n">same_parameters</span><span class="p">,</span> <span class="s2">&quot;Different&quot;</span><span class="p">:</span> <span class="n">different_parameters</span><span class="p">}</span>
</span><span id="Incar-412"><a href="#Incar-412"><span class="linenos">412</span></a>
</span><span id="Incar-413"><a href="#Incar-413"><span class="linenos">413</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Incar-414"><a href="#Incar-414"><span class="linenos">414</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-415"><a href="#Incar-415"><span class="linenos">415</span></a><span class="sd">        Add all the values of another INCAR object to this object.</span>
</span><span id="Incar-416"><a href="#Incar-416"><span class="linenos">416</span></a><span class="sd">        Facilitates the use of &quot;standard&quot; INCARs.</span>
</span><span id="Incar-417"><a href="#Incar-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-418"><a href="#Incar-418"><span class="linenos">418</span></a>        <span class="c1"># start by copying this incar&#39;s settings</span>
</span><span id="Incar-419"><a href="#Incar-419"><span class="linenos">419</span></a>        <span class="n">new_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Incar-420"><a href="#Incar-420"><span class="linenos">420</span></a>
</span><span id="Incar-421"><a href="#Incar-421"><span class="linenos">421</span></a>        <span class="c1"># now iterate through the other incar parameters to incorporate them</span>
</span><span id="Incar-422"><a href="#Incar-422"><span class="linenos">422</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar-423"><a href="#Incar-423"><span class="linenos">423</span></a>
</span><span id="Incar-424"><a href="#Incar-424"><span class="linenos">424</span></a>            <span class="c1"># If both have a given parameter, make sure they are the same values</span>
</span><span id="Incar-425"><a href="#Incar-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">[</span><span class="n">parameter</span><span class="p">]:</span>
</span><span id="Incar-426"><a href="#Incar-426"><span class="linenos">426</span></a>                <span class="c1"># If not, we shouldn&#39;t allow combining these Incars as it can</span>
</span><span id="Incar-427"><a href="#Incar-427"><span class="linenos">427</span></a>                <span class="c1"># lead to undesired results.</span>
</span><span id="Incar-428"><a href="#Incar-428"><span class="linenos">428</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Incar-429"><a href="#Incar-429"><span class="linenos">429</span></a>                    <span class="sa">f</span><span class="s2">&quot;Incars have conflicting values! One conflict is with </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Incar-430"><a href="#Incar-430"><span class="linenos">430</span></a>                    <span class="sa">f</span><span class="s2">&quot;where one incar has </span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span><span class="si">}</span><span class="s2"> and the other has </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Incar-431"><a href="#Incar-431"><span class="linenos">431</span></a>                <span class="p">)</span>
</span><span id="Incar-432"><a href="#Incar-432"><span class="linenos">432</span></a>            <span class="c1"># otherwise just set the value</span>
</span><span id="Incar-433"><a href="#Incar-433"><span class="linenos">433</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-434"><a href="#Incar-434"><span class="linenos">434</span></a>                <span class="n">new_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Incar-435"><a href="#Incar-435"><span class="linenos">435</span></a>
</span><span id="Incar-436"><a href="#Incar-436"><span class="linenos">436</span></a>        <span class="c1"># now return the new Incar</span>
</span><span id="Incar-437"><a href="#Incar-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="n">new_parameters</span><span class="p">)</span>
</span><span id="Incar-438"><a href="#Incar-438"><span class="linenos">438</span></a>
</span><span id="Incar-439"><a href="#Incar-439"><span class="linenos">439</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="Incar-440"><a href="#Incar-440"><span class="linenos">440</span></a>    <span class="c1"># All methods below are modifiers that users can apply. I may move these to</span>
</span><span id="Incar-441"><a href="#Incar-441"><span class="linenos">441</span></a>    <span class="c1"># a separate class (e.g. KeywordModifier).</span>
</span><span id="Incar-442"><a href="#Incar-442"><span class="linenos">442</span></a>
</span><span id="Incar-443"><a href="#Incar-443"><span class="linenos">443</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-444"><a href="#Incar-444"><span class="linenos">444</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar-445"><a href="#Incar-445"><span class="linenos">445</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-446"><a href="#Incar-446"><span class="linenos">446</span></a><span class="sd">        The __density modifier means the user wants a specific density. They</span>
</span><span id="Incar-447"><a href="#Incar-447"><span class="linenos">447</span></a><span class="sd">        provide this density in per-angstrom^3 units and we return the</span>
</span><span id="Incar-448"><a href="#Incar-448"><span class="linenos">448</span></a><span class="sd">        structure-specific count that gives this density.</span>
</span><span id="Incar-449"><a href="#Incar-449"><span class="linenos">449</span></a><span class="sd">        For example, density=10 and a structure lattice that volume of 5,</span>
</span><span id="Incar-450"><a href="#Incar-450"><span class="linenos">450</span></a><span class="sd">        then this returns value=10*5=50.</span>
</span><span id="Incar-451"><a href="#Incar-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-452"><a href="#Incar-452"><span class="linenos">452</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="Incar-453"><a href="#Incar-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="Incar-454"><a href="#Incar-454"><span class="linenos">454</span></a>
</span><span id="Incar-455"><a href="#Incar-455"><span class="linenos">455</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-456"><a href="#Incar-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_a</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar-457"><a href="#Incar-457"><span class="linenos">457</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-458"><a href="#Incar-458"><span class="linenos">458</span></a><span class="sd">        The __density_a modifier means the user wants a specific density along</span>
</span><span id="Incar-459"><a href="#Incar-459"><span class="linenos">459</span></a><span class="sd">        the A lattice vector. They provide this density in per-angstrom units</span>
</span><span id="Incar-460"><a href="#Incar-460"><span class="linenos">460</span></a><span class="sd">        and we return the structure-specific count that gives this density.</span>
</span><span id="Incar-461"><a href="#Incar-461"><span class="linenos">461</span></a><span class="sd">        For example, density=10 and a structure lattice that A vector of 5,</span>
</span><span id="Incar-462"><a href="#Incar-462"><span class="linenos">462</span></a><span class="sd">        then this returns value=10*5=50.</span>
</span><span id="Incar-463"><a href="#Incar-463"><span class="linenos">463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-464"><a href="#Incar-464"><span class="linenos">464</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="Incar-465"><a href="#Incar-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="Incar-466"><a href="#Incar-466"><span class="linenos">466</span></a>
</span><span id="Incar-467"><a href="#Incar-467"><span class="linenos">467</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-468"><a href="#Incar-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_b</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar-469"><a href="#Incar-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="Incar-470"><a href="#Incar-470"><span class="linenos">470</span></a>
</span><span id="Incar-471"><a href="#Incar-471"><span class="linenos">471</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-472"><a href="#Incar-472"><span class="linenos">472</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_c</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar-473"><a href="#Incar-473"><span class="linenos">473</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span><span id="Incar-474"><a href="#Incar-474"><span class="linenos">474</span></a>
</span><span id="Incar-475"><a href="#Incar-475"><span class="linenos">475</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-476"><a href="#Incar-476"><span class="linenos">476</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_per_atom</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">per_atom_value</span><span class="p">):</span>
</span><span id="Incar-477"><a href="#Incar-477"><span class="linenos">477</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-478"><a href="#Incar-478"><span class="linenos">478</span></a><span class="sd">        The __per_atom modifier means the user wants a specific value per atom</span>
</span><span id="Incar-479"><a href="#Incar-479"><span class="linenos">479</span></a><span class="sd">        in the unit cell. For example, EDIFF__per_atom=1e-5 and a structure</span>
</span><span id="Incar-480"><a href="#Incar-480"><span class="linenos">480</span></a><span class="sd">        with 50 sites in it would return a value of 1e-5*50=50.</span>
</span><span id="Incar-481"><a href="#Incar-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-482"><a href="#Incar-482"><span class="linenos">482</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="Incar-483"><a href="#Incar-483"><span class="linenos">483</span></a>        <span class="k">return</span> <span class="n">per_atom_value</span> <span class="o">*</span> <span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span>
</span><span id="Incar-484"><a href="#Incar-484"><span class="linenos">484</span></a>
</span><span id="Incar-485"><a href="#Incar-485"><span class="linenos">485</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-486"><a href="#Incar-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_magmom</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">override_values</span><span class="p">):</span>
</span><span id="Incar-487"><a href="#Incar-487"><span class="linenos">487</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-488"><a href="#Incar-488"><span class="linenos">488</span></a><span class="sd">        The __smart_magmom modifier goes through a series of checks to decide</span>
</span><span id="Incar-489"><a href="#Incar-489"><span class="linenos">489</span></a><span class="sd">        what to set the MAGMOM as for VASP. In order of priority they are...</span>
</span><span id="Incar-490"><a href="#Incar-490"><span class="linenos">490</span></a><span class="sd">            (1) the magmom property attached to each site in the structure object</span>
</span><span id="Incar-491"><a href="#Incar-491"><span class="linenos">491</span></a><span class="sd">            (2) the spin property attached to the site&#39;s specie</span>
</span><span id="Incar-492"><a href="#Incar-492"><span class="linenos">492</span></a><span class="sd">            (3) a value provided explicitly (e.g. {&quot;Co&quot;: 0.5})</span>
</span><span id="Incar-493"><a href="#Incar-493"><span class="linenos">493</span></a><span class="sd">            (4) a value of 0.6</span>
</span><span id="Incar-494"><a href="#Incar-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-495"><a href="#Incar-495"><span class="linenos">495</span></a>
</span><span id="Incar-496"><a href="#Incar-496"><span class="linenos">496</span></a>        <span class="c1"># grab the default MAGMOM supplied, or use VASP&#39;s default of 1 otherwise</span>
</span><span id="Incar-497"><a href="#Incar-497"><span class="linenos">497</span></a>        <span class="n">default_value</span> <span class="o">=</span> <span class="n">override_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Incar-498"><a href="#Incar-498"><span class="linenos">498</span></a>
</span><span id="Incar-499"><a href="#Incar-499"><span class="linenos">499</span></a>        <span class="c1"># we go through each site in the structure and decide what to set the</span>
</span><span id="Incar-500"><a href="#Incar-500"><span class="linenos">500</span></a>        <span class="c1"># MAGMOM for each. This allows even different sites of the same</span>
</span><span id="Incar-501"><a href="#Incar-501"><span class="linenos">501</span></a>        <span class="c1"># element to have their own MAGMOM</span>
</span><span id="Incar-502"><a href="#Incar-502"><span class="linenos">502</span></a>        <span class="n">magnetic_moments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Incar-503"><a href="#Incar-503"><span class="linenos">503</span></a>        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="Incar-504"><a href="#Incar-504"><span class="linenos">504</span></a>            <span class="c1"># if the structure object has magmom-decorated sites, we use that</span>
</span><span id="Incar-505"><a href="#Incar-505"><span class="linenos">505</span></a>            <span class="c1"># as our first priority</span>
</span><span id="Incar-506"><a href="#Incar-506"><span class="linenos">506</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="s2">&quot;magmom&quot;</span><span class="p">):</span>
</span><span id="Incar-507"><a href="#Incar-507"><span class="linenos">507</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span>
</span><span id="Incar-508"><a href="#Incar-508"><span class="linenos">508</span></a>            <span class="c1"># next we check if the site&#39;s specie has a spin</span>
</span><span id="Incar-509"><a href="#Incar-509"><span class="linenos">509</span></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">):</span>
</span><span id="Incar-510"><a href="#Incar-510"><span class="linenos">510</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
</span><span id="Incar-511"><a href="#Incar-511"><span class="linenos">511</span></a>            <span class="c1"># we then look at the override dictionary if there was one provided.</span>
</span><span id="Incar-512"><a href="#Incar-512"><span class="linenos">512</span></a>            <span class="c1"># If note, we use 0.6 as a default.</span>
</span><span id="Incar-513"><a href="#Incar-513"><span class="linenos">513</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-514"><a href="#Incar-514"><span class="linenos">514</span></a>                <span class="n">magnetic_moment</span> <span class="o">=</span> <span class="n">override_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
</span><span id="Incar-515"><a href="#Incar-515"><span class="linenos">515</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magnetic_moment</span><span class="p">)</span>
</span><span id="Incar-516"><a href="#Incar-516"><span class="linenos">516</span></a>
</span><span id="Incar-517"><a href="#Incar-517"><span class="linenos">517</span></a>        <span class="c1"># This feature is in pymatgen, but I haven&#39;t added it here yet.</span>
</span><span id="Incar-518"><a href="#Incar-518"><span class="linenos">518</span></a>        <span class="c1"># if self.constrain_total_magmom:</span>
</span><span id="Incar-519"><a href="#Incar-519"><span class="linenos">519</span></a>        <span class="c1">#     nupdown = sum([mag if abs(mag) &gt; 0.6 else 0 for mag in incar[&quot;MAGMOM&quot;]])</span>
</span><span id="Incar-520"><a href="#Incar-520"><span class="linenos">520</span></a>        <span class="c1">#     incar[&quot;NUPDOWN&quot;] = nupdown</span>
</span><span id="Incar-521"><a href="#Incar-521"><span class="linenos">521</span></a>
</span><span id="Incar-522"><a href="#Incar-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="n">magnetic_moments</span>
</span><span id="Incar-523"><a href="#Incar-523"><span class="linenos">523</span></a>
</span><span id="Incar-524"><a href="#Incar-524"><span class="linenos">524</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-525"><a href="#Incar-525"><span class="linenos">525</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_lmaxmix</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">lmaxmix_config</span><span class="p">):</span>
</span><span id="Incar-526"><a href="#Incar-526"><span class="linenos">526</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-527"><a href="#Incar-527"><span class="linenos">527</span></a><span class="sd">        This modifier sets LMAXMIX if there are any d or f electrons present</span>
</span><span id="Incar-528"><a href="#Incar-528"><span class="linenos">528</span></a><span class="sd">        in the structure.</span>
</span><span id="Incar-529"><a href="#Incar-529"><span class="linenos">529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-530"><a href="#Incar-530"><span class="linenos">530</span></a>
</span><span id="Incar-531"><a href="#Incar-531"><span class="linenos">531</span></a>        <span class="c1"># COMMENT (from pymatgen team):</span>
</span><span id="Incar-532"><a href="#Incar-532"><span class="linenos">532</span></a>        <span class="c1"># Note that if the user explicitly sets LMAXMIX in settings it will</span>
</span><span id="Incar-533"><a href="#Incar-533"><span class="linenos">533</span></a>        <span class="c1"># override this logic.</span>
</span><span id="Incar-534"><a href="#Incar-534"><span class="linenos">534</span></a>        <span class="c1"># Previously, this was only set if Hubbard U was enabled as per the</span>
</span><span id="Incar-535"><a href="#Incar-535"><span class="linenos">535</span></a>        <span class="c1"># VASP manual but following an investigation it was determined that</span>
</span><span id="Incar-536"><a href="#Incar-536"><span class="linenos">536</span></a>        <span class="c1"># this would lead to a significant difference between SCF -&gt; NonSCF</span>
</span><span id="Incar-537"><a href="#Incar-537"><span class="linenos">537</span></a>        <span class="c1"># even without Hubbard U enabled. Thanks to Andrew Rosen for</span>
</span><span id="Incar-538"><a href="#Incar-538"><span class="linenos">538</span></a>        <span class="c1"># investigating and reporting.</span>
</span><span id="Incar-539"><a href="#Incar-539"><span class="linenos">539</span></a>
</span><span id="Incar-540"><a href="#Incar-540"><span class="linenos">540</span></a>        <span class="c1"># first iterate through all elements and check for f-electrons</span>
</span><span id="Incar-541"><a href="#Incar-541"><span class="linenos">541</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">56</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="Incar-542"><a href="#Incar-542"><span class="linenos">542</span></a>            <span class="k">return</span> <span class="mi">6</span>
</span><span id="Incar-543"><a href="#Incar-543"><span class="linenos">543</span></a>        <span class="c1"># now check for elements that contain d-electrons</span>
</span><span id="Incar-544"><a href="#Incar-544"><span class="linenos">544</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="Incar-545"><a href="#Incar-545"><span class="linenos">545</span></a>            <span class="k">return</span> <span class="mi">4</span>
</span><span id="Incar-546"><a href="#Incar-546"><span class="linenos">546</span></a>        <span class="c1"># otherwise use the default for VASP</span>
</span><span id="Incar-547"><a href="#Incar-547"><span class="linenos">547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-548"><a href="#Incar-548"><span class="linenos">548</span></a>            <span class="k">return</span> <span class="mi">2</span>
</span><span id="Incar-549"><a href="#Incar-549"><span class="linenos">549</span></a>
</span><span id="Incar-550"><a href="#Incar-550"><span class="linenos">550</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-551"><a href="#Incar-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_ldau</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ldau_config</span><span class="p">):</span>
</span><span id="Incar-552"><a href="#Incar-552"><span class="linenos">552</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-553"><a href="#Incar-553"><span class="linenos">553</span></a><span class="sd">        This modifier handles a series of keyword arguments that are associated</span>
</span><span id="Incar-554"><a href="#Incar-554"><span class="linenos">554</span></a><span class="sd">        with LDAU, including LDAUJ, LDAUL, LDAUTYPE, LDAUU, LDAUPRINT, and LMAXMIX.</span>
</span><span id="Incar-555"><a href="#Incar-555"><span class="linenos">555</span></a><span class="sd">        Therefore, a complex dictionary is passed to this. The format looks like this...</span>
</span><span id="Incar-556"><a href="#Incar-556"><span class="linenos">556</span></a><span class="sd">            LDAU__multiple_keywords__smart_ldau = dict(</span>
</span><span id="Incar-557"><a href="#Incar-557"><span class="linenos">557</span></a><span class="sd">                LDAU__auto=True,</span>
</span><span id="Incar-558"><a href="#Incar-558"><span class="linenos">558</span></a><span class="sd">                LDAUTYPE=2,</span>
</span><span id="Incar-559"><a href="#Incar-559"><span class="linenos">559</span></a><span class="sd">                LDAUPRINT=1,</span>
</span><span id="Incar-560"><a href="#Incar-560"><span class="linenos">560</span></a><span class="sd">                LDAUJ={...},</span>
</span><span id="Incar-561"><a href="#Incar-561"><span class="linenos">561</span></a><span class="sd">                LDAUL={...},</span>
</span><span id="Incar-562"><a href="#Incar-562"><span class="linenos">562</span></a><span class="sd">                LDAUU={...},</span>
</span><span id="Incar-563"><a href="#Incar-563"><span class="linenos">563</span></a><span class="sd">                LMAXMIX__auto=True,</span>
</span><span id="Incar-564"><a href="#Incar-564"><span class="linenos">564</span></a><span class="sd">                )</span>
</span><span id="Incar-565"><a href="#Incar-565"><span class="linenos">565</span></a><span class="sd">        The LDAUJ, LDAUL, and LDAUU values can be a dictionary of elements to</span>
</span><span id="Incar-566"><a href="#Incar-566"><span class="linenos">566</span></a><span class="sd">        value, or (most commonly) a nested dictionary. For example...</span>
</span><span id="Incar-567"><a href="#Incar-567"><span class="linenos">567</span></a><span class="sd">            LDAUJ = {&quot;F&quot;:{&quot;Co&quot;:0}}</span>
</span><span id="Incar-568"><a href="#Incar-568"><span class="linenos">568</span></a><span class="sd">        This would mean if the structure is a fluoride, set the LDAUJ for Co to 0.</span>
</span><span id="Incar-569"><a href="#Incar-569"><span class="linenos">569</span></a><span class="sd">        If there are multiple options here (e.g. for fluorides and oxides), then</span>
</span><span id="Incar-570"><a href="#Incar-570"><span class="linenos">570</span></a><span class="sd">        priority is placed on the most electronegative element. This would mean</span>
</span><span id="Incar-571"><a href="#Incar-571"><span class="linenos">571</span></a><span class="sd">        some thing like yttrium oxide fluoride would be treated as a fluoride over</span>
</span><span id="Incar-572"><a href="#Incar-572"><span class="linenos">572</span></a><span class="sd">        an oxide.</span>
</span><span id="Incar-573"><a href="#Incar-573"><span class="linenos">573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-574"><a href="#Incar-574"><span class="linenos">574</span></a>
</span><span id="Incar-575"><a href="#Incar-575"><span class="linenos">575</span></a>        <span class="c1"># first we need to go through the LDAUJ, LDAUL, and LDAUU keywords and</span>
</span><span id="Incar-576"><a href="#Incar-576"><span class="linenos">576</span></a>        <span class="c1"># see what their values are. If all of these end up be 0 for all elements</span>
</span><span id="Incar-577"><a href="#Incar-577"><span class="linenos">577</span></a>        <span class="c1"># then we actually don&#39;t need LDAU at all! Therefore, we&#39;ll go through</span>
</span><span id="Incar-578"><a href="#Incar-578"><span class="linenos">578</span></a>        <span class="c1"># all of these keywords and build a dictionary of settings to return</span>
</span><span id="Incar-579"><a href="#Incar-579"><span class="linenos">579</span></a>        <span class="c1"># at the end of this function</span>
</span><span id="Incar-580"><a href="#Incar-580"><span class="linenos">580</span></a>        <span class="n">ldau_settings</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar-581"><a href="#Incar-581"><span class="linenos">581</span></a>
</span><span id="Incar-582"><a href="#Incar-582"><span class="linenos">582</span></a>        <span class="c1"># To help decide how we set these values, let&#39;s check what the most</span>
</span><span id="Incar-583"><a href="#Incar-583"><span class="linenos">583</span></a>        <span class="c1"># electronegative element is, which will be last in the sorted composition</span>
</span><span id="Incar-584"><a href="#Incar-584"><span class="linenos">584</span></a>        <span class="n">most_electroneg</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span>
</span><span id="Incar-585"><a href="#Incar-585"><span class="linenos">585</span></a>
</span><span id="Incar-586"><a href="#Incar-586"><span class="linenos">586</span></a>        <span class="c1"># As we go through these settings, we want see if we are even using LDAU.</span>
</span><span id="Incar-587"><a href="#Incar-587"><span class="linenos">587</span></a>        <span class="c1"># For example if we ran a calculation on NaCl, we&#39;d probably see that</span>
</span><span id="Incar-588"><a href="#Incar-588"><span class="linenos">588</span></a>        <span class="c1"># all LDAUJ/LDAUL/LDAUU values are just 0. In that case, we can just</span>
</span><span id="Incar-589"><a href="#Incar-589"><span class="linenos">589</span></a>        <span class="c1"># throw away (i.e. turn off) all LDAU settings. Therefore, we have a term</span>
</span><span id="Incar-590"><a href="#Incar-590"><span class="linenos">590</span></a>        <span class="c1"># &quot;using_ldau&quot; that is false until proven otherwise.</span>
</span><span id="Incar-591"><a href="#Incar-591"><span class="linenos">591</span></a>        <span class="n">using_ldau</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Incar-592"><a href="#Incar-592"><span class="linenos">592</span></a>
</span><span id="Incar-593"><a href="#Incar-593"><span class="linenos">593</span></a>        <span class="k">for</span> <span class="n">ldau_keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUU&quot;</span><span class="p">]:</span>
</span><span id="Incar-594"><a href="#Incar-594"><span class="linenos">594</span></a>
</span><span id="Incar-595"><a href="#Incar-595"><span class="linenos">595</span></a>            <span class="c1"># grab the sub-dictionary that maps elements to this keyword.</span>
</span><span id="Incar-596"><a href="#Incar-596"><span class="linenos">596</span></a>            <span class="c1"># If it&#39;s not there, just use an empty dictionary.</span>
</span><span id="Incar-597"><a href="#Incar-597"><span class="linenos">597</span></a>            <span class="n">keyword_config</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ldau_keyword</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Incar-598"><a href="#Incar-598"><span class="linenos">598</span></a>
</span><span id="Incar-599"><a href="#Incar-599"><span class="linenos">599</span></a>            <span class="c1"># check if the most electronegative element is in the override_values</span>
</span><span id="Incar-600"><a href="#Incar-600"><span class="linenos">600</span></a>            <span class="c1"># and if so, see if it has a subdictionary in it. We use this</span>
</span><span id="Incar-601"><a href="#Incar-601"><span class="linenos">601</span></a>            <span class="c1"># dictionary as our base one to pull values from.</span>
</span><span id="Incar-602"><a href="#Incar-602"><span class="linenos">602</span></a>            <span class="k">if</span> <span class="n">most_electroneg</span> <span class="ow">in</span> <span class="n">keyword_config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Incar-603"><a href="#Incar-603"><span class="linenos">603</span></a>                <span class="n">keyword_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">],</span> <span class="nb">dict</span>
</span><span id="Incar-604"><a href="#Incar-604"><span class="linenos">604</span></a>            <span class="p">):</span>
</span><span id="Incar-605"><a href="#Incar-605"><span class="linenos">605</span></a>                <span class="n">keyword_config</span> <span class="o">=</span> <span class="n">keyword_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">]</span>
</span><span id="Incar-606"><a href="#Incar-606"><span class="linenos">606</span></a>
</span><span id="Incar-607"><a href="#Incar-607"><span class="linenos">607</span></a>            <span class="c1"># now iterate through all the sites and grab the assigned value. If nothing</span>
</span><span id="Incar-608"><a href="#Incar-608"><span class="linenos">608</span></a>            <span class="c1"># is set then the default is 0.</span>
</span><span id="Incar-609"><a href="#Incar-609"><span class="linenos">609</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Incar-610"><a href="#Incar-610"><span class="linenos">610</span></a>                <span class="n">keyword_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Incar-611"><a href="#Incar-611"><span class="linenos">611</span></a>                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span>
</span><span id="Incar-612"><a href="#Incar-612"><span class="linenos">612</span></a>            <span class="p">]</span>
</span><span id="Incar-613"><a href="#Incar-613"><span class="linenos">613</span></a>
</span><span id="Incar-614"><a href="#Incar-614"><span class="linenos">614</span></a>            <span class="c1"># now that we have this keyword all set, we add it to our results</span>
</span><span id="Incar-615"><a href="#Incar-615"><span class="linenos">615</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="n">ldau_keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
</span><span id="Incar-616"><a href="#Incar-616"><span class="linenos">616</span></a>
</span><span id="Incar-617"><a href="#Incar-617"><span class="linenos">617</span></a>            <span class="c1"># check to see if we are using ldau here (i.e. any value is not 0)</span>
</span><span id="Incar-618"><a href="#Incar-618"><span class="linenos">618</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="Incar-619"><a href="#Incar-619"><span class="linenos">619</span></a>                <span class="n">using_ldau</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Incar-620"><a href="#Incar-620"><span class="linenos">620</span></a>
</span><span id="Incar-621"><a href="#Incar-621"><span class="linenos">621</span></a>        <span class="c1"># now check if we actaully need LDAU here. If not, we can throw out all</span>
</span><span id="Incar-622"><a href="#Incar-622"><span class="linenos">622</span></a>        <span class="c1"># settings and just return an empty dictionary</span>
</span><span id="Incar-623"><a href="#Incar-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="n">using_ldau</span> <span class="ow">and</span> <span class="s2">&quot;LDAU__auto&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="Incar-624"><a href="#Incar-624"><span class="linenos">624</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Incar-625"><a href="#Incar-625"><span class="linenos">625</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-626"><a href="#Incar-626"><span class="linenos">626</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="Incar-627"><a href="#Incar-627"><span class="linenos">627</span></a>
</span><span id="Incar-628"><a href="#Incar-628"><span class="linenos">628</span></a>        <span class="c1"># The remaining LDAU keywords are LDAUPRINT and LDAUTYPE, which we just</span>
</span><span id="Incar-629"><a href="#Incar-629"><span class="linenos">629</span></a>        <span class="c1"># leave at what is set in the input</span>
</span><span id="Incar-630"><a href="#Incar-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="s2">&quot;LDAUPRINT&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="Incar-631"><a href="#Incar-631"><span class="linenos">631</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span>
</span><span id="Incar-632"><a href="#Incar-632"><span class="linenos">632</span></a>        <span class="k">if</span> <span class="s2">&quot;LDAUTYPE&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="Incar-633"><a href="#Incar-633"><span class="linenos">633</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span>
</span><span id="Incar-634"><a href="#Incar-634"><span class="linenos">634</span></a>
</span><span id="Incar-635"><a href="#Incar-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="n">ldau_settings</span>
</span><span id="Incar-636"><a href="#Incar-636"><span class="linenos">636</span></a>
</span><span id="Incar-637"><a href="#Incar-637"><span class="linenos">637</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar-638"><a href="#Incar-638"><span class="linenos">638</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_ismear</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ismear_config</span><span class="p">):</span>
</span><span id="Incar-639"><a href="#Incar-639"><span class="linenos">639</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar-640"><a href="#Incar-640"><span class="linenos">640</span></a><span class="sd">        The smearing value used here depends on if we have a semiconductor,</span>
</span><span id="Incar-641"><a href="#Incar-641"><span class="linenos">641</span></a><span class="sd">        insulator, or metal. This modifier makes a &quot;best-guess&quot; on what the</span>
</span><span id="Incar-642"><a href="#Incar-642"><span class="linenos">642</span></a><span class="sd">        material is and uses the proper smearing type. Note that if this</span>
</span><span id="Incar-643"><a href="#Incar-643"><span class="linenos">643</span></a><span class="sd">        guess is wrong, it is useful to have the IncorrectSmearing error</span>
</span><span id="Incar-644"><a href="#Incar-644"><span class="linenos">644</span></a><span class="sd">        handler to fix this as VASP runs.</span>
</span><span id="Incar-645"><a href="#Incar-645"><span class="linenos">645</span></a>
</span><span id="Incar-646"><a href="#Incar-646"><span class="linenos">646</span></a><span class="sd">        Read more about the VASP recommended ISMEAR settings here:</span>
</span><span id="Incar-647"><a href="#Incar-647"><span class="linenos">647</span></a><span class="sd">            https://www.vasp.at/wiki/index.php/ISMEAR</span>
</span><span id="Incar-648"><a href="#Incar-648"><span class="linenos">648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar-649"><a href="#Incar-649"><span class="linenos">649</span></a>
</span><span id="Incar-650"><a href="#Incar-650"><span class="linenos">650</span></a>        <span class="c1"># for now we just go through the structure and if all elements are</span>
</span><span id="Incar-651"><a href="#Incar-651"><span class="linenos">651</span></a>        <span class="c1"># metals, then we say it&#39;s a metal. Otherwise, we treat the structure</span>
</span><span id="Incar-652"><a href="#Incar-652"><span class="linenos">652</span></a>        <span class="c1"># as a semiconductor or insulator.</span>
</span><span id="Incar-653"><a href="#Incar-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">is_metal</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="Incar-654"><a href="#Incar-654"><span class="linenos">654</span></a>            <span class="n">ismear_settings</span> <span class="o">=</span> <span class="n">ismear_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metal&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Incar-655"><a href="#Incar-655"><span class="linenos">655</span></a>
</span><span id="Incar-656"><a href="#Incar-656"><span class="linenos">656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar-657"><a href="#Incar-657"><span class="linenos">657</span></a>            <span class="n">ismear_settings</span> <span class="o">=</span> <span class="n">ismear_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;non-metal&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Incar-658"><a href="#Incar-658"><span class="linenos">658</span></a>
</span><span id="Incar-659"><a href="#Incar-659"><span class="linenos">659</span></a>        <span class="k">return</span> <span class="n">ismear_settings</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>INCAR object for reading and writing INCAR files. This behaves exactly like
a python dictionary, but has a few extra checks and methods attached to it.
You can pass it a dictionary or initialize it just like you would dict(kwargs).
You can consider the dict(kwargs) as equivalent to Incar(parameters).</p>

<p>If you want a given setting to be dependent on the structure or dynamically
determined, then we implement these modifiers. This would enable us to
do things like ENCUT__per_atom or NGZF__density. We can even have more complex
modifiers like multiple_keywords__smart_ldau which signals that our
"smart_ldau" modifier introduces more than one new setting to the INCAR, such
as LDAUJ, LDAUU, LDAUL, LDAUTYPE, and LDAUPRINT.</p>

<p>TODO: In the future, I want to allow modifiers like __relative_to_previous
and __use_previous to string settings accross tasks.</p>
</div>


                            <div id="Incar.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Incar</span><span class="signature">(**kwargs)</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.__init__-25"><a href="#Incar.__init__-25"><span class="linenos">25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Incar.__init__-26"><a href="#Incar.__init__-26"><span class="linenos">26</span></a>
</span><span id="Incar.__init__-27"><a href="#Incar.__init__-27"><span class="linenos">27</span></a>        <span class="c1"># The kwargs are a dictionary of parameters (e.g. {&quot;PREC&quot;: &quot;accurate&quot;})</span>
</span><span id="Incar.__init__-28"><a href="#Incar.__init__-28"><span class="linenos">28</span></a>
</span><span id="Incar.__init__-29"><a href="#Incar.__init__-29"><span class="linenos">29</span></a>        <span class="c1"># Establish the dictionary with the given input</span>
</span><span id="Incar.__init__-30"><a href="#Incar.__init__-30"><span class="linenos">30</span></a>        <span class="c1"># This is the same as doing dict(**kwargs)</span>
</span><span id="Incar.__init__-31"><a href="#Incar.__init__-31"><span class="linenos">31</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Incar.__init__-32"><a href="#Incar.__init__-32"><span class="linenos">32</span></a>
</span><span id="Incar.__init__-33"><a href="#Incar.__init__-33"><span class="linenos">33</span></a>        <span class="c1"># Based on the kwargs, go through and make sure each parameter is in</span>
</span><span id="Incar.__init__-34"><a href="#Incar.__init__-34"><span class="linenos">34</span></a>        <span class="c1"># it&#39;s expected datatype. Thus users can supply strings in the typical</span>
</span><span id="Incar.__init__-35"><a href="#Incar.__init__-35"><span class="linenos">35</span></a>        <span class="c1"># VASP format that will be convert to python types here.</span>
</span><span id="Incar.__init__-36"><a href="#Incar.__init__-36"><span class="linenos">36</span></a>        <span class="c1"># OPTIMIZE -- would it be faster if I only did this on from_file init?</span>
</span><span id="Incar.__init__-37"><a href="#Incar.__init__-37"><span class="linenos">37</span></a>        <span class="c1"># and therefore assumed the user to initialize this with proper python</span>
</span><span id="Incar.__init__-38"><a href="#Incar.__init__-38"><span class="linenos">38</span></a>        <span class="c1"># datatypes and formatting? Also will this behave properly if the value</span>
</span><span id="Incar.__init__-39"><a href="#Incar.__init__-39"><span class="linenos">39</span></a>        <span class="c1"># is already in the correct format?</span>
</span><span id="Incar.__init__-40"><a href="#Incar.__init__-40"><span class="linenos">40</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar.__init__-41"><a href="#Incar.__init__-41"><span class="linenos">41</span></a>
</span><span id="Incar.__init__-42"><a href="#Incar.__init__-42"><span class="linenos">42</span></a>            <span class="c1"># parameters may have tags like &quot;__density&quot; added onto them. We don&#39;t</span>
</span><span id="Incar.__init__-43"><a href="#Incar.__init__-43"><span class="linenos">43</span></a>            <span class="c1"># convert to the datatype yet, but instead wait until a structure</span>
</span><span id="Incar.__init__-44"><a href="#Incar.__init__-44"><span class="linenos">44</span></a>            <span class="c1"># is provided (when the to_file or str methods are called below).</span>
</span><span id="Incar.__init__-45"><a href="#Incar.__init__-45"><span class="linenos">45</span></a>            <span class="c1"># These are defined in python and should already be in the correct</span>
</span><span id="Incar.__init__-46"><a href="#Incar.__init__-46"><span class="linenos">46</span></a>            <span class="c1"># data format.</span>
</span><span id="Incar.__init__-47"><a href="#Incar.__init__-47"><span class="linenos">47</span></a>            <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="Incar.__init__-48"><a href="#Incar.__init__-48"><span class="linenos">48</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">parameter</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
</span><span id="Incar.__init__-49"><a href="#Incar.__init__-49"><span class="linenos">49</span></a>
</span><span id="Incar.__init__-50"><a href="#Incar.__init__-50"><span class="linenos">50</span></a>            <span class="c1"># Otherwise, we need to convert values to the proper python datatype</span>
</span><span id="Incar.__init__-51"><a href="#Incar.__init__-51"><span class="linenos">51</span></a>            <span class="c1"># because we might be reading from a file where everything is a string</span>
</span><span id="Incar.__init__-52"><a href="#Incar.__init__-52"><span class="linenos">52</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.__init__-53"><a href="#Incar.__init__-53"><span class="linenos">53</span></a>                <span class="n">formatted_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_to_datatype</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Incar.__init__-54"><a href="#Incar.__init__-54"><span class="linenos">54</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">parameter</span><span class="p">:</span> <span class="n">formatted_value</span><span class="p">})</span>
</span><span id="Incar.__init__-55"><a href="#Incar.__init__-55"><span class="linenos">55</span></a>
</span><span id="Incar.__init__-56"><a href="#Incar.__init__-56"><span class="linenos">56</span></a>        <span class="c1"># SPECIAL CASE</span>
</span><span id="Incar.__init__-57"><a href="#Incar.__init__-57"><span class="linenos">57</span></a>        <span class="c1"># If you have LSORBIT=True or LNONCOLLINEAR=True, the MAGMOM class needs</span>
</span><span id="Incar.__init__-58"><a href="#Incar.__init__-58"><span class="linenos">58</span></a>        <span class="c1"># to take on a different form. Instead of a single MAGMOM being set as</span>
</span><span id="Incar.__init__-59"><a href="#Incar.__init__-59"><span class="linenos">59</span></a>        <span class="c1"># a float, it&#39;s now a vector (x,y,z). For example:</span>
</span><span id="Incar.__init__-60"><a href="#Incar.__init__-60"><span class="linenos">60</span></a>        <span class="c1">#   MAGMOM = x1 y1 z1    x2 y2 z2    x3 y3 z3 ...</span>
</span><span id="Incar.__init__-61"><a href="#Incar.__init__-61"><span class="linenos">61</span></a>        <span class="c1">#       [...instead of...]</span>
</span><span id="Incar.__init__-62"><a href="#Incar.__init__-62"><span class="linenos">62</span></a>        <span class="c1">#   MAGMOM = value1 value2 value3 ...</span>
</span><span id="Incar.__init__-63"><a href="#Incar.__init__-63"><span class="linenos">63</span></a>        <span class="c1"># Check if MAGMOM is set along with LSORBIT or LNONCOLLINEAR being True</span>
</span><span id="Incar.__init__-64"><a href="#Incar.__init__-64"><span class="linenos">64</span></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;MAGMOM&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Incar.__init__-65"><a href="#Incar.__init__-65"><span class="linenos">65</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LSORBIT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">)</span>
</span><span id="Incar.__init__-66"><a href="#Incar.__init__-66"><span class="linenos">66</span></a>        <span class="p">):</span>
</span><span id="Incar.__init__-67"><a href="#Incar.__init__-67"><span class="linenos">67</span></a>            <span class="c1"># convert the MAGMOM value from...</span>
</span><span id="Incar.__init__-68"><a href="#Incar.__init__-68"><span class="linenos">68</span></a>            <span class="c1">#   [x1,y1,z1,x2,y2,z2,x3,y3,z3] (this can be a string too)</span>
</span><span id="Incar.__init__-69"><a href="#Incar.__init__-69"><span class="linenos">69</span></a>            <span class="c1">#   to...</span>
</span><span id="Incar.__init__-70"><a href="#Incar.__init__-70"><span class="linenos">70</span></a>            <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="Incar.__init__-71"><a href="#Incar.__init__-71"><span class="linenos">71</span></a>            <span class="n">old_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">]</span>
</span><span id="Incar.__init__-72"><a href="#Incar.__init__-72"><span class="linenos">72</span></a>            <span class="n">new_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">old_format</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_format</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
</span><span id="Incar.__init__-73"><a href="#Incar.__init__-73"><span class="linenos">73</span></a>            <span class="c1"># Or If I wanted to do the same thing with numpy:</span>
</span><span id="Incar.__init__-74"><a href="#Incar.__init__-74"><span class="linenos">74</span></a>            <span class="c1">#   new_format = numpy.array_split(old_format, len(old_format) // 3)</span>
</span><span id="Incar.__init__-75"><a href="#Incar.__init__-75"><span class="linenos">75</span></a>            <span class="c1"># now update the dictionary with this value</span>
</span><span id="Incar.__init__-76"><a href="#Incar.__init__-76"><span class="linenos">76</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">:</span> <span class="n">new_format</span><span class="p">})</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Incar.to_evaluated_str" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.to_evaluated_str">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_evaluated_str</span><span class="signature">(self, structure=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.to_evaluated_str-78"><a href="#Incar.to_evaluated_str-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">to_evaluated_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Incar.to_evaluated_str-79"><a href="#Incar.to_evaluated_str-79"><span class="linenos"> 79</span></a>
</span><span id="Incar.to_evaluated_str-80"><a href="#Incar.to_evaluated_str-80"><span class="linenos"> 80</span></a>        <span class="c1"># Let&#39;s start with an empty string and build from there</span>
</span><span id="Incar.to_evaluated_str-81"><a href="#Incar.to_evaluated_str-81"><span class="linenos"> 81</span></a>        <span class="n">final_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Incar.to_evaluated_str-82"><a href="#Incar.to_evaluated_str-82"><span class="linenos"> 82</span></a>
</span><span id="Incar.to_evaluated_str-83"><a href="#Incar.to_evaluated_str-83"><span class="linenos"> 83</span></a>        <span class="c1"># First we need to iterate through all parameters and check if we have</span>
</span><span id="Incar.to_evaluated_str-84"><a href="#Incar.to_evaluated_str-84"><span class="linenos"> 84</span></a>        <span class="c1"># ones that are structure-specific. For example, we would need to</span>
</span><span id="Incar.to_evaluated_str-85"><a href="#Incar.to_evaluated_str-85"><span class="linenos"> 85</span></a>        <span class="c1"># evaluate &quot;ENCUT__per_atom&quot;. We go through all these and collect the</span>
</span><span id="Incar.to_evaluated_str-86"><a href="#Incar.to_evaluated_str-86"><span class="linenos"> 86</span></a>        <span class="c1"># paramters into a final settings list.</span>
</span><span id="Incar.to_evaluated_str-87"><a href="#Incar.to_evaluated_str-87"><span class="linenos"> 87</span></a>        <span class="n">final_settings</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar.to_evaluated_str-88"><a href="#Incar.to_evaluated_str-88"><span class="linenos"> 88</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar.to_evaluated_str-89"><a href="#Incar.to_evaluated_str-89"><span class="linenos"> 89</span></a>
</span><span id="Incar.to_evaluated_str-90"><a href="#Incar.to_evaluated_str-90"><span class="linenos"> 90</span></a>            <span class="c1"># if there is no modifier attached to the parameter, we just keep it as-is</span>
</span><span id="Incar.to_evaluated_str-91"><a href="#Incar.to_evaluated_str-91"><span class="linenos"> 91</span></a>            <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-92"><a href="#Incar.to_evaluated_str-92"><span class="linenos"> 92</span></a>                <span class="n">final_settings</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Incar.to_evaluated_str-93"><a href="#Incar.to_evaluated_str-93"><span class="linenos"> 93</span></a>
</span><span id="Incar.to_evaluated_str-94"><a href="#Incar.to_evaluated_str-94"><span class="linenos"> 94</span></a>            <span class="c1"># Otherwise we have a modifier like &quot;__density&quot; and need to evaluate it</span>
</span><span id="Incar.to_evaluated_str-95"><a href="#Incar.to_evaluated_str-95"><span class="linenos"> 95</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-96"><a href="#Incar.to_evaluated_str-96"><span class="linenos"> 96</span></a>
</span><span id="Incar.to_evaluated_str-97"><a href="#Incar.to_evaluated_str-97"><span class="linenos"> 97</span></a>                <span class="c1"># make sure we have a structure supplied because all modifiers</span>
</span><span id="Incar.to_evaluated_str-98"><a href="#Incar.to_evaluated_str-98"><span class="linenos"> 98</span></a>                <span class="c1"># require one.</span>
</span><span id="Incar.to_evaluated_str-99"><a href="#Incar.to_evaluated_str-99"><span class="linenos"> 99</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-100"><a href="#Incar.to_evaluated_str-100"><span class="linenos">100</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="Incar.to_evaluated_str-101"><a href="#Incar.to_evaluated_str-101"><span class="linenos">101</span></a>                        <span class="s2">&quot;It looks like you used a keyword modifier but didn&#39;t &quot;</span>
</span><span id="Incar.to_evaluated_str-102"><a href="#Incar.to_evaluated_str-102"><span class="linenos">102</span></a>                        <span class="sa">f</span><span class="s2">&quot;supply a structure! If you want to use </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Incar.to_evaluated_str-103"><a href="#Incar.to_evaluated_str-103"><span class="linenos">103</span></a>                        <span class="s2">&quot;then you need to make sure you provide a structure so &quot;</span>
</span><span id="Incar.to_evaluated_str-104"><a href="#Incar.to_evaluated_str-104"><span class="linenos">104</span></a>                        <span class="s2">&quot;that the modifier can be evaluated.&quot;</span>
</span><span id="Incar.to_evaluated_str-105"><a href="#Incar.to_evaluated_str-105"><span class="linenos">105</span></a>                    <span class="p">)</span>
</span><span id="Incar.to_evaluated_str-106"><a href="#Incar.to_evaluated_str-106"><span class="linenos">106</span></a>
</span><span id="Incar.to_evaluated_str-107"><a href="#Incar.to_evaluated_str-107"><span class="linenos">107</span></a>                <span class="c1"># separate the input into the base parameter and modifier.</span>
</span><span id="Incar.to_evaluated_str-108"><a href="#Incar.to_evaluated_str-108"><span class="linenos">108</span></a>                <span class="c1"># This also overwrites what our paramter value is.</span>
</span><span id="Incar.to_evaluated_str-109"><a href="#Incar.to_evaluated_str-109"><span class="linenos">109</span></a>                <span class="n">parameter</span><span class="p">,</span> <span class="n">modifier_tag</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
</span><span id="Incar.to_evaluated_str-110"><a href="#Incar.to_evaluated_str-110"><span class="linenos">110</span></a>
</span><span id="Incar.to_evaluated_str-111"><a href="#Incar.to_evaluated_str-111"><span class="linenos">111</span></a>                <span class="c1"># check that this class has this modifier supported. It should</span>
</span><span id="Incar.to_evaluated_str-112"><a href="#Incar.to_evaluated_str-112"><span class="linenos">112</span></a>                <span class="c1"># be a method named &quot;keyword_modifier_mymodifer&quot;.</span>
</span><span id="Incar.to_evaluated_str-113"><a href="#Incar.to_evaluated_str-113"><span class="linenos">113</span></a>                <span class="c1"># If everything looks good, we grab the modifier function</span>
</span><span id="Incar.to_evaluated_str-114"><a href="#Incar.to_evaluated_str-114"><span class="linenos">114</span></a>                <span class="n">modifier_fxn_name</span> <span class="o">=</span> <span class="s2">&quot;keyword_modifier_&quot;</span> <span class="o">+</span> <span class="n">modifier_tag</span>
</span><span id="Incar.to_evaluated_str-115"><a href="#Incar.to_evaluated_str-115"><span class="linenos">115</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier_fxn_name</span><span class="p">):</span>
</span><span id="Incar.to_evaluated_str-116"><a href="#Incar.to_evaluated_str-116"><span class="linenos">116</span></a>                    <span class="n">modifier_fxn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier_fxn_name</span><span class="p">)</span>
</span><span id="Incar.to_evaluated_str-117"><a href="#Incar.to_evaluated_str-117"><span class="linenos">117</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-118"><a href="#Incar.to_evaluated_str-118"><span class="linenos">118</span></a>                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="Incar.to_evaluated_str-119"><a href="#Incar.to_evaluated_str-119"><span class="linenos">119</span></a>                        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.to_evaluated_str-120"><a href="#Incar.to_evaluated_str-120"><span class="linenos">120</span></a><span class="sd">                        It looks like you used a keyword modifier that hasn&#39;t</span>
</span><span id="Incar.to_evaluated_str-121"><a href="#Incar.to_evaluated_str-121"><span class="linenos">121</span></a><span class="sd">                        been defined yet! If you want something like ENCUT__smart_encut,</span>
</span><span id="Incar.to_evaluated_str-122"><a href="#Incar.to_evaluated_str-122"><span class="linenos">122</span></a><span class="sd">                        then you need to make sure there is a keyword_modifier_smart_encut</span>
</span><span id="Incar.to_evaluated_str-123"><a href="#Incar.to_evaluated_str-123"><span class="linenos">123</span></a><span class="sd">                        method available.</span>
</span><span id="Incar.to_evaluated_str-124"><a href="#Incar.to_evaluated_str-124"><span class="linenos">124</span></a><span class="sd">                        &quot;&quot;&quot;</span>
</span><span id="Incar.to_evaluated_str-125"><a href="#Incar.to_evaluated_str-125"><span class="linenos">125</span></a>                    <span class="p">)</span>
</span><span id="Incar.to_evaluated_str-126"><a href="#Incar.to_evaluated_str-126"><span class="linenos">126</span></a>
</span><span id="Incar.to_evaluated_str-127"><a href="#Incar.to_evaluated_str-127"><span class="linenos">127</span></a>                <span class="c1"># now that we have the modifier function, let&#39;s use it to update</span>
</span><span id="Incar.to_evaluated_str-128"><a href="#Incar.to_evaluated_str-128"><span class="linenos">128</span></a>                <span class="c1"># our value for this keyword.</span>
</span><span id="Incar.to_evaluated_str-129"><a href="#Incar.to_evaluated_str-129"><span class="linenos">129</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">modifier_fxn</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Incar.to_evaluated_str-130"><a href="#Incar.to_evaluated_str-130"><span class="linenos">130</span></a>
</span><span id="Incar.to_evaluated_str-131"><a href="#Incar.to_evaluated_str-131"><span class="linenos">131</span></a>                <span class="c1"># if the &quot;parameter&quot; is actually &quot;multiple_keywords&quot;, then we</span>
</span><span id="Incar.to_evaluated_str-132"><a href="#Incar.to_evaluated_str-132"><span class="linenos">132</span></a>                <span class="c1"># have our actually parameters as a dictionary. We need to</span>
</span><span id="Incar.to_evaluated_str-133"><a href="#Incar.to_evaluated_str-133"><span class="linenos">133</span></a>                <span class="c1"># pull these out of the &quot;value&quot; we have.</span>
</span><span id="Incar.to_evaluated_str-134"><a href="#Incar.to_evaluated_str-134"><span class="linenos">134</span></a>                <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="s2">&quot;multiple_keywords&quot;</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-135"><a href="#Incar.to_evaluated_str-135"><span class="linenos">135</span></a>                    <span class="k">for</span> <span class="n">subparameter</span><span class="p">,</span> <span class="n">subvalue</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar.to_evaluated_str-136"><a href="#Incar.to_evaluated_str-136"><span class="linenos">136</span></a>                        <span class="n">final_settings</span><span class="p">[</span><span class="n">subparameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">subvalue</span>
</span><span id="Incar.to_evaluated_str-137"><a href="#Incar.to_evaluated_str-137"><span class="linenos">137</span></a>
</span><span id="Incar.to_evaluated_str-138"><a href="#Incar.to_evaluated_str-138"><span class="linenos">138</span></a>                <span class="c1"># otherwise we were just given back an update value</span>
</span><span id="Incar.to_evaluated_str-139"><a href="#Incar.to_evaluated_str-139"><span class="linenos">139</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-140"><a href="#Incar.to_evaluated_str-140"><span class="linenos">140</span></a>                    <span class="n">final_settings</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Incar.to_evaluated_str-141"><a href="#Incar.to_evaluated_str-141"><span class="linenos">141</span></a>
</span><span id="Incar.to_evaluated_str-142"><a href="#Incar.to_evaluated_str-142"><span class="linenos">142</span></a>        <span class="c1"># Now that we have all of our parameters evaluated for the structure, we</span>
</span><span id="Incar.to_evaluated_str-143"><a href="#Incar.to_evaluated_str-143"><span class="linenos">143</span></a>        <span class="c1"># iterate through each parameter and its set value. Each one will be</span>
</span><span id="Incar.to_evaluated_str-144"><a href="#Incar.to_evaluated_str-144"><span class="linenos">144</span></a>        <span class="c1"># put on a separate line.</span>
</span><span id="Incar.to_evaluated_str-145"><a href="#Incar.to_evaluated_str-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">final_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Incar.to_evaluated_str-146"><a href="#Incar.to_evaluated_str-146"><span class="linenos">146</span></a>
</span><span id="Incar.to_evaluated_str-147"><a href="#Incar.to_evaluated_str-147"><span class="linenos">147</span></a>            <span class="c1"># let&#39;s start by adding the parameter key to our output</span>
</span><span id="Incar.to_evaluated_str-148"><a href="#Incar.to_evaluated_str-148"><span class="linenos">148</span></a>            <span class="c1"># It will be followed by an equal sign to separate it&#39;s value</span>
</span><span id="Incar.to_evaluated_str-149"><a href="#Incar.to_evaluated_str-149"><span class="linenos">149</span></a>            <span class="n">final_str</span> <span class="o">+=</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span>
</span><span id="Incar.to_evaluated_str-150"><a href="#Incar.to_evaluated_str-150"><span class="linenos">150</span></a>
</span><span id="Incar.to_evaluated_str-151"><a href="#Incar.to_evaluated_str-151"><span class="linenos">151</span></a>            <span class="c1"># If we have a value that is a list (or list of lists)</span>
</span><span id="Incar.to_evaluated_str-152"><a href="#Incar.to_evaluated_str-152"><span class="linenos">152</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Incar.to_evaluated_str-153"><a href="#Incar.to_evaluated_str-153"><span class="linenos">153</span></a>
</span><span id="Incar.to_evaluated_str-154"><a href="#Incar.to_evaluated_str-154"><span class="linenos">154</span></a>                <span class="c1"># check if we have a list of lists</span>
</span><span id="Incar.to_evaluated_str-155"><a href="#Incar.to_evaluated_str-155"><span class="linenos">155</span></a>                <span class="c1"># Take MAGMOM with LSORBIT=True as an example, where we convert...</span>
</span><span id="Incar.to_evaluated_str-156"><a href="#Incar.to_evaluated_str-156"><span class="linenos">156</span></a>                <span class="c1">#   [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]</span>
</span><span id="Incar.to_evaluated_str-157"><a href="#Incar.to_evaluated_str-157"><span class="linenos">157</span></a>                <span class="c1"># to...</span>
</span><span id="Incar.to_evaluated_str-158"><a href="#Incar.to_evaluated_str-158"><span class="linenos">158</span></a>                <span class="c1"># &quot;x1 y1 z1 x2 y2 z2 x3 y3 z3&quot;</span>
</span><span id="Incar.to_evaluated_str-159"><a href="#Incar.to_evaluated_str-159"><span class="linenos">159</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Incar.to_evaluated_str-160"><a href="#Incar.to_evaluated_str-160"><span class="linenos">160</span></a>                    <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">)</span>
</span><span id="Incar.to_evaluated_str-161"><a href="#Incar.to_evaluated_str-161"><span class="linenos">161</span></a>
</span><span id="Incar.to_evaluated_str-162"><a href="#Incar.to_evaluated_str-162"><span class="linenos">162</span></a>                <span class="c1"># otherwise we just have a list of items</span>
</span><span id="Incar.to_evaluated_str-163"><a href="#Incar.to_evaluated_str-163"><span class="linenos">163</span></a>                <span class="c1"># converts [1, 2, 3] to &quot;1 2 3&quot;</span>
</span><span id="Incar.to_evaluated_str-164"><a href="#Incar.to_evaluated_str-164"><span class="linenos">164</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-165"><a href="#Incar.to_evaluated_str-165"><span class="linenos">165</span></a>                    <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Incar.to_evaluated_str-166"><a href="#Incar.to_evaluated_str-166"><span class="linenos">166</span></a>
</span><span id="Incar.to_evaluated_str-167"><a href="#Incar.to_evaluated_str-167"><span class="linenos">167</span></a>            <span class="c1"># if it&#39;s not a list, we can just save the string of the value</span>
</span><span id="Incar.to_evaluated_str-168"><a href="#Incar.to_evaluated_str-168"><span class="linenos">168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.to_evaluated_str-169"><a href="#Incar.to_evaluated_str-169"><span class="linenos">169</span></a>                <span class="n">final_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Incar.to_evaluated_str-170"><a href="#Incar.to_evaluated_str-170"><span class="linenos">170</span></a>
</span><span id="Incar.to_evaluated_str-171"><a href="#Incar.to_evaluated_str-171"><span class="linenos">171</span></a>            <span class="c1"># we want to start each parameter on a new line, so we need to</span>
</span><span id="Incar.to_evaluated_str-172"><a href="#Incar.to_evaluated_str-172"><span class="linenos">172</span></a>            <span class="c1"># add this at the end of each. There will be an extra new line at</span>
</span><span id="Incar.to_evaluated_str-173"><a href="#Incar.to_evaluated_str-173"><span class="linenos">173</span></a>            <span class="c1"># the end of the file, but that&#39;s alright</span>
</span><span id="Incar.to_evaluated_str-174"><a href="#Incar.to_evaluated_str-174"><span class="linenos">174</span></a>            <span class="n">final_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Incar.to_evaluated_str-175"><a href="#Incar.to_evaluated_str-175"><span class="linenos">175</span></a>
</span><span id="Incar.to_evaluated_str-176"><a href="#Incar.to_evaluated_str-176"><span class="linenos">176</span></a>        <span class="c1"># we now have our final string and can return it!</span>
</span><span id="Incar.to_evaluated_str-177"><a href="#Incar.to_evaluated_str-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="n">final_str</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Incar.to_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.to_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_file</span><span class="signature">(self, filename=&#39;INCAR&#39;, structure=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.to_file-179"><a href="#Incar.to_file-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Incar.to_file-180"><a href="#Incar.to_file-180"><span class="linenos">180</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.to_file-181"><a href="#Incar.to_file-181"><span class="linenos">181</span></a><span class="sd">        Write Incar to a file.</span>
</span><span id="Incar.to_file-182"><a href="#Incar.to_file-182"><span class="linenos">182</span></a><span class="sd">        Args:</span>
</span><span id="Incar.to_file-183"><a href="#Incar.to_file-183"><span class="linenos">183</span></a><span class="sd">            filename (str): filename to write to.</span>
</span><span id="Incar.to_file-184"><a href="#Incar.to_file-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.to_file-185"><a href="#Incar.to_file-185"><span class="linenos">185</span></a>        <span class="c1"># we just take the string format and put it in a file</span>
</span><span id="Incar.to_file-186"><a href="#Incar.to_file-186"><span class="linenos">186</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Incar.to_file-187"><a href="#Incar.to_file-187"><span class="linenos">187</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_evaluated_str</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">))</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Write Incar to a file.
Args:
    filename (str): filename to write to.</p>
</div>


                            </div>
                            <div id="Incar.from_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.from_file">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">from_file</span><span class="signature">(filename=&#39;INCAR&#39;)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.from_file-189"><a href="#Incar.from_file-189"><span class="linenos">189</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.from_file-190"><a href="#Incar.from_file-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">):</span>
</span><span id="Incar.from_file-191"><a href="#Incar.from_file-191"><span class="linenos">191</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.from_file-192"><a href="#Incar.from_file-192"><span class="linenos">192</span></a><span class="sd">        Reads an Incar object from a file.</span>
</span><span id="Incar.from_file-193"><a href="#Incar.from_file-193"><span class="linenos">193</span></a><span class="sd">        Args:</span>
</span><span id="Incar.from_file-194"><a href="#Incar.from_file-194"><span class="linenos">194</span></a><span class="sd">            filename (str): Filename for file</span>
</span><span id="Incar.from_file-195"><a href="#Incar.from_file-195"><span class="linenos">195</span></a><span class="sd">        Returns:</span>
</span><span id="Incar.from_file-196"><a href="#Incar.from_file-196"><span class="linenos">196</span></a><span class="sd">            Incar object</span>
</span><span id="Incar.from_file-197"><a href="#Incar.from_file-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.from_file-198"><a href="#Incar.from_file-198"><span class="linenos">198</span></a>        <span class="c1"># open the file, grab the lines, and then close it</span>
</span><span id="Incar.from_file-199"><a href="#Incar.from_file-199"><span class="linenos">199</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Incar.from_file-200"><a href="#Incar.from_file-200"><span class="linenos">200</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="Incar.from_file-201"><a href="#Incar.from_file-201"><span class="linenos">201</span></a>
</span><span id="Incar.from_file-202"><a href="#Incar.from_file-202"><span class="linenos">202</span></a>        <span class="c1"># store parameters in this dictionary</span>
</span><span id="Incar.from_file-203"><a href="#Incar.from_file-203"><span class="linenos">203</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar.from_file-204"><a href="#Incar.from_file-204"><span class="linenos">204</span></a>        <span class="c1"># go through line by line</span>
</span><span id="Incar.from_file-205"><a href="#Incar.from_file-205"><span class="linenos">205</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="Incar.from_file-206"><a href="#Incar.from_file-206"><span class="linenos">206</span></a>            <span class="c1"># If the line starts with a # then its a comment and we should skip.</span>
</span><span id="Incar.from_file-207"><a href="#Incar.from_file-207"><span class="linenos">207</span></a>            <span class="c1"># It also could be an empty line that we should skip,</span>
</span><span id="Incar.from_file-208"><a href="#Incar.from_file-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="Incar.from_file-209"><a href="#Incar.from_file-209"><span class="linenos">209</span></a>                <span class="k">continue</span>
</span><span id="Incar.from_file-210"><a href="#Incar.from_file-210"><span class="linenos">210</span></a>            <span class="c1"># multiple parameters on a single line are separated by a semicolon</span>
</span><span id="Incar.from_file-211"><a href="#Incar.from_file-211"><span class="linenos">211</span></a>            <span class="k">for</span> <span class="n">sub_line</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
</span><span id="Incar.from_file-212"><a href="#Incar.from_file-212"><span class="linenos">212</span></a>                <span class="c1"># the PARAMETER and VALUE are separated by equal sign</span>
</span><span id="Incar.from_file-213"><a href="#Incar.from_file-213"><span class="linenos">213</span></a>                <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sub_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
</span><span id="Incar.from_file-214"><a href="#Incar.from_file-214"><span class="linenos">214</span></a>                <span class="c1"># we can use the parameter/value to update our dictionary. The</span>
</span><span id="Incar.from_file-215"><a href="#Incar.from_file-215"><span class="linenos">215</span></a>                <span class="c1"># last thing we do is remove leading/trailing whitespace with strip()</span>
</span><span id="Incar.from_file-216"><a href="#Incar.from_file-216"><span class="linenos">216</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="Incar.from_file-217"><a href="#Incar.from_file-217"><span class="linenos">217</span></a>
</span><span id="Incar.from_file-218"><a href="#Incar.from_file-218"><span class="linenos">218</span></a>        <span class="c1"># return the final dictionary as an Incar object</span>
</span><span id="Incar.from_file-219"><a href="#Incar.from_file-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Reads an Incar object from a file.
Args:
    filename (str): Filename for file
Returns:
    Incar object</p>
</div>


                            </div>
                            <div id="Incar.compare_incars" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.compare_incars">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">compare_incars</span><span class="signature">(self, other_incar)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.compare_incars-369"><a href="#Incar.compare_incars-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="nf">compare_incars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_incar</span><span class="p">):</span>
</span><span id="Incar.compare_incars-370"><a href="#Incar.compare_incars-370"><span class="linenos">370</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.compare_incars-371"><a href="#Incar.compare_incars-371"><span class="linenos">371</span></a><span class="sd">        Compares two Incars and indicates which parameters are the same and</span>
</span><span id="Incar.compare_incars-372"><a href="#Incar.compare_incars-372"><span class="linenos">372</span></a><span class="sd">        which are not. Useful for checking whether two runs were done using</span>
</span><span id="Incar.compare_incars-373"><a href="#Incar.compare_incars-373"><span class="linenos">373</span></a><span class="sd">        the same parameters.</span>
</span><span id="Incar.compare_incars-374"><a href="#Incar.compare_incars-374"><span class="linenos">374</span></a><span class="sd">        Args:</span>
</span><span id="Incar.compare_incars-375"><a href="#Incar.compare_incars-375"><span class="linenos">375</span></a><span class="sd">            other (Incar): The other Incar object to compare to.</span>
</span><span id="Incar.compare_incars-376"><a href="#Incar.compare_incars-376"><span class="linenos">376</span></a><span class="sd">        Returns:</span>
</span><span id="Incar.compare_incars-377"><a href="#Incar.compare_incars-377"><span class="linenos">377</span></a><span class="sd">            Dict of the following format:</span>
</span><span id="Incar.compare_incars-378"><a href="#Incar.compare_incars-378"><span class="linenos">378</span></a><span class="sd">            {&quot;Same&quot; : parameters_that_are_the_same,</span>
</span><span id="Incar.compare_incars-379"><a href="#Incar.compare_incars-379"><span class="linenos">379</span></a><span class="sd">            &quot;Different&quot;: parameters_that_are_different}</span>
</span><span id="Incar.compare_incars-380"><a href="#Incar.compare_incars-380"><span class="linenos">380</span></a><span class="sd">            The value of the other_incar is returned for the paramters that</span>
</span><span id="Incar.compare_incars-381"><a href="#Incar.compare_incars-381"><span class="linenos">381</span></a><span class="sd">            are different are returned as {Parameter: (incar_value, other_incar_value)}</span>
</span><span id="Incar.compare_incars-382"><a href="#Incar.compare_incars-382"><span class="linenos">382</span></a><span class="sd">            where None is used as a placeholder. For the same parameters, the</span>
</span><span id="Incar.compare_incars-383"><a href="#Incar.compare_incars-383"><span class="linenos">383</span></a><span class="sd">            dictionary is returned as {Parameter: shared_value}</span>
</span><span id="Incar.compare_incars-384"><a href="#Incar.compare_incars-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.compare_incars-385"><a href="#Incar.compare_incars-385"><span class="linenos">385</span></a>
</span><span id="Incar.compare_incars-386"><a href="#Incar.compare_incars-386"><span class="linenos">386</span></a>        <span class="n">same_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar.compare_incars-387"><a href="#Incar.compare_incars-387"><span class="linenos">387</span></a>        <span class="n">different_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar.compare_incars-388"><a href="#Incar.compare_incars-388"><span class="linenos">388</span></a>
</span><span id="Incar.compare_incars-389"><a href="#Incar.compare_incars-389"><span class="linenos">389</span></a>        <span class="c1"># make a collection of all unique keys used by the two dictionaries</span>
</span><span id="Incar.compare_incars-390"><a href="#Incar.compare_incars-390"><span class="linenos">390</span></a>        <span class="c1"># I convert to list() so I can use set() below.</span>
</span><span id="Incar.compare_incars-391"><a href="#Incar.compare_incars-391"><span class="linenos">391</span></a>        <span class="c1"># OPTIMIZE -- is there a better way to do this?</span>
</span><span id="Incar.compare_incars-392"><a href="#Incar.compare_incars-392"><span class="linenos">392</span></a>        <span class="n">parameters1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Incar.compare_incars-393"><a href="#Incar.compare_incars-393"><span class="linenos">393</span></a>        <span class="n">parameters2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other_incar</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Incar.compare_incars-394"><a href="#Incar.compare_incars-394"><span class="linenos">394</span></a>
</span><span id="Incar.compare_incars-395"><a href="#Incar.compare_incars-395"><span class="linenos">395</span></a>        <span class="c1"># iterate through each unique parameter</span>
</span><span id="Incar.compare_incars-396"><a href="#Incar.compare_incars-396"><span class="linenos">396</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">parameters1</span> <span class="o">+</span> <span class="n">parameters2</span><span class="p">):</span>
</span><span id="Incar.compare_incars-397"><a href="#Incar.compare_incars-397"><span class="linenos">397</span></a>
</span><span id="Incar.compare_incars-398"><a href="#Incar.compare_incars-398"><span class="linenos">398</span></a>            <span class="c1"># try to grab the value from both Incar objects</span>
</span><span id="Incar.compare_incars-399"><a href="#Incar.compare_incars-399"><span class="linenos">399</span></a>            <span class="c1"># If it doesn&#39;t have the value, None will be provided</span>
</span><span id="Incar.compare_incars-400"><a href="#Incar.compare_incars-400"><span class="linenos">400</span></a>            <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
</span><span id="Incar.compare_incars-401"><a href="#Incar.compare_incars-401"><span class="linenos">401</span></a>            <span class="n">value2</span> <span class="o">=</span> <span class="n">other_incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
</span><span id="Incar.compare_incars-402"><a href="#Incar.compare_incars-402"><span class="linenos">402</span></a>
</span><span id="Incar.compare_incars-403"><a href="#Incar.compare_incars-403"><span class="linenos">403</span></a>            <span class="c1"># compare the two and store</span>
</span><span id="Incar.compare_incars-404"><a href="#Incar.compare_incars-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">value1</span> <span class="o">==</span> <span class="n">value2</span><span class="p">:</span>
</span><span id="Incar.compare_incars-405"><a href="#Incar.compare_incars-405"><span class="linenos">405</span></a>                <span class="c1"># it doesn&#39;t matter which value I grab so I just use value1</span>
</span><span id="Incar.compare_incars-406"><a href="#Incar.compare_incars-406"><span class="linenos">406</span></a>                <span class="n">same_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">value1</span>
</span><span id="Incar.compare_incars-407"><a href="#Incar.compare_incars-407"><span class="linenos">407</span></a>            <span class="c1"># if they are different...</span>
</span><span id="Incar.compare_incars-408"><a href="#Incar.compare_incars-408"><span class="linenos">408</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.compare_incars-409"><a href="#Incar.compare_incars-409"><span class="linenos">409</span></a>                <span class="n">different_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span>
</span><span id="Incar.compare_incars-410"><a href="#Incar.compare_incars-410"><span class="linenos">410</span></a>
</span><span id="Incar.compare_incars-411"><a href="#Incar.compare_incars-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Same&quot;</span><span class="p">:</span> <span class="n">same_parameters</span><span class="p">,</span> <span class="s2">&quot;Different&quot;</span><span class="p">:</span> <span class="n">different_parameters</span><span class="p">}</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Compares two Incars and indicates which parameters are the same and
which are not. Useful for checking whether two runs were done using
the same parameters.
Args:
    other (Incar): The other Incar object to compare to.
Returns:
    Dict of the following format:
    {"Same" : parameters_that_are_the_same,
    "Different": parameters_that_are_different}
    The value of the other_incar is returned for the paramters that
    are different are returned as {Parameter: (incar_value, other_incar_value)}
    where None is used as a placeholder. For the same parameters, the
    dictionary is returned as {Parameter: shared_value}</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_density" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_density">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_density</span><span class="signature">(structure, density)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_density-443"><a href="#Incar.keyword_modifier_density-443"><span class="linenos">443</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_density-444"><a href="#Incar.keyword_modifier_density-444"><span class="linenos">444</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_density-445"><a href="#Incar.keyword_modifier_density-445"><span class="linenos">445</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_density-446"><a href="#Incar.keyword_modifier_density-446"><span class="linenos">446</span></a><span class="sd">        The __density modifier means the user wants a specific density. They</span>
</span><span id="Incar.keyword_modifier_density-447"><a href="#Incar.keyword_modifier_density-447"><span class="linenos">447</span></a><span class="sd">        provide this density in per-angstrom^3 units and we return the</span>
</span><span id="Incar.keyword_modifier_density-448"><a href="#Incar.keyword_modifier_density-448"><span class="linenos">448</span></a><span class="sd">        structure-specific count that gives this density.</span>
</span><span id="Incar.keyword_modifier_density-449"><a href="#Incar.keyword_modifier_density-449"><span class="linenos">449</span></a><span class="sd">        For example, density=10 and a structure lattice that volume of 5,</span>
</span><span id="Incar.keyword_modifier_density-450"><a href="#Incar.keyword_modifier_density-450"><span class="linenos">450</span></a><span class="sd">        then this returns value=10*5=50.</span>
</span><span id="Incar.keyword_modifier_density-451"><a href="#Incar.keyword_modifier_density-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_density-452"><a href="#Incar.keyword_modifier_density-452"><span class="linenos">452</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="Incar.keyword_modifier_density-453"><a href="#Incar.keyword_modifier_density-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">volume</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The __density modifier means the user wants a specific density. They
provide this density in per-angstrom^3 units and we return the
structure-specific count that gives this density.
For example, density=10 and a structure lattice that volume of 5,
then this returns value=10*5=50.</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_density_a" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_density_a">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_density_a</span><span class="signature">(structure, density)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_density_a-455"><a href="#Incar.keyword_modifier_density_a-455"><span class="linenos">455</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_density_a-456"><a href="#Incar.keyword_modifier_density_a-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_a</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_density_a-457"><a href="#Incar.keyword_modifier_density_a-457"><span class="linenos">457</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_density_a-458"><a href="#Incar.keyword_modifier_density_a-458"><span class="linenos">458</span></a><span class="sd">        The __density_a modifier means the user wants a specific density along</span>
</span><span id="Incar.keyword_modifier_density_a-459"><a href="#Incar.keyword_modifier_density_a-459"><span class="linenos">459</span></a><span class="sd">        the A lattice vector. They provide this density in per-angstrom units</span>
</span><span id="Incar.keyword_modifier_density_a-460"><a href="#Incar.keyword_modifier_density_a-460"><span class="linenos">460</span></a><span class="sd">        and we return the structure-specific count that gives this density.</span>
</span><span id="Incar.keyword_modifier_density_a-461"><a href="#Incar.keyword_modifier_density_a-461"><span class="linenos">461</span></a><span class="sd">        For example, density=10 and a structure lattice that A vector of 5,</span>
</span><span id="Incar.keyword_modifier_density_a-462"><a href="#Incar.keyword_modifier_density_a-462"><span class="linenos">462</span></a><span class="sd">        then this returns value=10*5=50.</span>
</span><span id="Incar.keyword_modifier_density_a-463"><a href="#Incar.keyword_modifier_density_a-463"><span class="linenos">463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_density_a-464"><a href="#Incar.keyword_modifier_density_a-464"><span class="linenos">464</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="Incar.keyword_modifier_density_a-465"><a href="#Incar.keyword_modifier_density_a-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The __density_a modifier means the user wants a specific density along
the A lattice vector. They provide this density in per-angstrom units
and we return the structure-specific count that gives this density.
For example, density=10 and a structure lattice that A vector of 5,
then this returns value=10*5=50.</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_density_b" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_density_b">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_density_b</span><span class="signature">(structure, density)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_density_b-467"><a href="#Incar.keyword_modifier_density_b-467"><span class="linenos">467</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_density_b-468"><a href="#Incar.keyword_modifier_density_b-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_b</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_density_b-469"><a href="#Incar.keyword_modifier_density_b-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Incar.keyword_modifier_density_c" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_density_c">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_density_c</span><span class="signature">(structure, density)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_density_c-471"><a href="#Incar.keyword_modifier_density_c-471"><span class="linenos">471</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_density_c-472"><a href="#Incar.keyword_modifier_density_c-472"><span class="linenos">472</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_density_c</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">density</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_density_c-473"><a href="#Incar.keyword_modifier_density_c-473"><span class="linenos">473</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Incar.keyword_modifier_per_atom" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_per_atom">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_per_atom</span><span class="signature">(structure, per_atom_value)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_per_atom-475"><a href="#Incar.keyword_modifier_per_atom-475"><span class="linenos">475</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_per_atom-476"><a href="#Incar.keyword_modifier_per_atom-476"><span class="linenos">476</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_per_atom</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">per_atom_value</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_per_atom-477"><a href="#Incar.keyword_modifier_per_atom-477"><span class="linenos">477</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_per_atom-478"><a href="#Incar.keyword_modifier_per_atom-478"><span class="linenos">478</span></a><span class="sd">        The __per_atom modifier means the user wants a specific value per atom</span>
</span><span id="Incar.keyword_modifier_per_atom-479"><a href="#Incar.keyword_modifier_per_atom-479"><span class="linenos">479</span></a><span class="sd">        in the unit cell. For example, EDIFF__per_atom=1e-5 and a structure</span>
</span><span id="Incar.keyword_modifier_per_atom-480"><a href="#Incar.keyword_modifier_per_atom-480"><span class="linenos">480</span></a><span class="sd">        with 50 sites in it would return a value of 1e-5*50=50.</span>
</span><span id="Incar.keyword_modifier_per_atom-481"><a href="#Incar.keyword_modifier_per_atom-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_per_atom-482"><a href="#Incar.keyword_modifier_per_atom-482"><span class="linenos">482</span></a>        <span class="c1"># VASP expect integers for a lot of these values, so we round up</span>
</span><span id="Incar.keyword_modifier_per_atom-483"><a href="#Incar.keyword_modifier_per_atom-483"><span class="linenos">483</span></a>        <span class="k">return</span> <span class="n">per_atom_value</span> <span class="o">*</span> <span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The __per_atom modifier means the user wants a specific value per atom
in the unit cell. For example, EDIFF__per_atom=1e-5 and a structure
with 50 sites in it would return a value of 1e-5*50=50.</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_smart_magmom" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_smart_magmom">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_smart_magmom</span><span class="signature">(structure, override_values)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_smart_magmom-485"><a href="#Incar.keyword_modifier_smart_magmom-485"><span class="linenos">485</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_smart_magmom-486"><a href="#Incar.keyword_modifier_smart_magmom-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_magmom</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">override_values</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_magmom-487"><a href="#Incar.keyword_modifier_smart_magmom-487"><span class="linenos">487</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_magmom-488"><a href="#Incar.keyword_modifier_smart_magmom-488"><span class="linenos">488</span></a><span class="sd">        The __smart_magmom modifier goes through a series of checks to decide</span>
</span><span id="Incar.keyword_modifier_smart_magmom-489"><a href="#Incar.keyword_modifier_smart_magmom-489"><span class="linenos">489</span></a><span class="sd">        what to set the MAGMOM as for VASP. In order of priority they are...</span>
</span><span id="Incar.keyword_modifier_smart_magmom-490"><a href="#Incar.keyword_modifier_smart_magmom-490"><span class="linenos">490</span></a><span class="sd">            (1) the magmom property attached to each site in the structure object</span>
</span><span id="Incar.keyword_modifier_smart_magmom-491"><a href="#Incar.keyword_modifier_smart_magmom-491"><span class="linenos">491</span></a><span class="sd">            (2) the spin property attached to the site&#39;s specie</span>
</span><span id="Incar.keyword_modifier_smart_magmom-492"><a href="#Incar.keyword_modifier_smart_magmom-492"><span class="linenos">492</span></a><span class="sd">            (3) a value provided explicitly (e.g. {&quot;Co&quot;: 0.5})</span>
</span><span id="Incar.keyword_modifier_smart_magmom-493"><a href="#Incar.keyword_modifier_smart_magmom-493"><span class="linenos">493</span></a><span class="sd">            (4) a value of 0.6</span>
</span><span id="Incar.keyword_modifier_smart_magmom-494"><a href="#Incar.keyword_modifier_smart_magmom-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_magmom-495"><a href="#Incar.keyword_modifier_smart_magmom-495"><span class="linenos">495</span></a>
</span><span id="Incar.keyword_modifier_smart_magmom-496"><a href="#Incar.keyword_modifier_smart_magmom-496"><span class="linenos">496</span></a>        <span class="c1"># grab the default MAGMOM supplied, or use VASP&#39;s default of 1 otherwise</span>
</span><span id="Incar.keyword_modifier_smart_magmom-497"><a href="#Incar.keyword_modifier_smart_magmom-497"><span class="linenos">497</span></a>        <span class="n">default_value</span> <span class="o">=</span> <span class="n">override_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Incar.keyword_modifier_smart_magmom-498"><a href="#Incar.keyword_modifier_smart_magmom-498"><span class="linenos">498</span></a>
</span><span id="Incar.keyword_modifier_smart_magmom-499"><a href="#Incar.keyword_modifier_smart_magmom-499"><span class="linenos">499</span></a>        <span class="c1"># we go through each site in the structure and decide what to set the</span>
</span><span id="Incar.keyword_modifier_smart_magmom-500"><a href="#Incar.keyword_modifier_smart_magmom-500"><span class="linenos">500</span></a>        <span class="c1"># MAGMOM for each. This allows even different sites of the same</span>
</span><span id="Incar.keyword_modifier_smart_magmom-501"><a href="#Incar.keyword_modifier_smart_magmom-501"><span class="linenos">501</span></a>        <span class="c1"># element to have their own MAGMOM</span>
</span><span id="Incar.keyword_modifier_smart_magmom-502"><a href="#Incar.keyword_modifier_smart_magmom-502"><span class="linenos">502</span></a>        <span class="n">magnetic_moments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Incar.keyword_modifier_smart_magmom-503"><a href="#Incar.keyword_modifier_smart_magmom-503"><span class="linenos">503</span></a>        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_magmom-504"><a href="#Incar.keyword_modifier_smart_magmom-504"><span class="linenos">504</span></a>            <span class="c1"># if the structure object has magmom-decorated sites, we use that</span>
</span><span id="Incar.keyword_modifier_smart_magmom-505"><a href="#Incar.keyword_modifier_smart_magmom-505"><span class="linenos">505</span></a>            <span class="c1"># as our first priority</span>
</span><span id="Incar.keyword_modifier_smart_magmom-506"><a href="#Incar.keyword_modifier_smart_magmom-506"><span class="linenos">506</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="s2">&quot;magmom&quot;</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_magmom-507"><a href="#Incar.keyword_modifier_smart_magmom-507"><span class="linenos">507</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span>
</span><span id="Incar.keyword_modifier_smart_magmom-508"><a href="#Incar.keyword_modifier_smart_magmom-508"><span class="linenos">508</span></a>            <span class="c1"># next we check if the site&#39;s specie has a spin</span>
</span><span id="Incar.keyword_modifier_smart_magmom-509"><a href="#Incar.keyword_modifier_smart_magmom-509"><span class="linenos">509</span></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_magmom-510"><a href="#Incar.keyword_modifier_smart_magmom-510"><span class="linenos">510</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
</span><span id="Incar.keyword_modifier_smart_magmom-511"><a href="#Incar.keyword_modifier_smart_magmom-511"><span class="linenos">511</span></a>            <span class="c1"># we then look at the override dictionary if there was one provided.</span>
</span><span id="Incar.keyword_modifier_smart_magmom-512"><a href="#Incar.keyword_modifier_smart_magmom-512"><span class="linenos">512</span></a>            <span class="c1"># If note, we use 0.6 as a default.</span>
</span><span id="Incar.keyword_modifier_smart_magmom-513"><a href="#Incar.keyword_modifier_smart_magmom-513"><span class="linenos">513</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_magmom-514"><a href="#Incar.keyword_modifier_smart_magmom-514"><span class="linenos">514</span></a>                <span class="n">magnetic_moment</span> <span class="o">=</span> <span class="n">override_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
</span><span id="Incar.keyword_modifier_smart_magmom-515"><a href="#Incar.keyword_modifier_smart_magmom-515"><span class="linenos">515</span></a>                <span class="n">magnetic_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magnetic_moment</span><span class="p">)</span>
</span><span id="Incar.keyword_modifier_smart_magmom-516"><a href="#Incar.keyword_modifier_smart_magmom-516"><span class="linenos">516</span></a>
</span><span id="Incar.keyword_modifier_smart_magmom-517"><a href="#Incar.keyword_modifier_smart_magmom-517"><span class="linenos">517</span></a>        <span class="c1"># This feature is in pymatgen, but I haven&#39;t added it here yet.</span>
</span><span id="Incar.keyword_modifier_smart_magmom-518"><a href="#Incar.keyword_modifier_smart_magmom-518"><span class="linenos">518</span></a>        <span class="c1"># if self.constrain_total_magmom:</span>
</span><span id="Incar.keyword_modifier_smart_magmom-519"><a href="#Incar.keyword_modifier_smart_magmom-519"><span class="linenos">519</span></a>        <span class="c1">#     nupdown = sum([mag if abs(mag) &gt; 0.6 else 0 for mag in incar[&quot;MAGMOM&quot;]])</span>
</span><span id="Incar.keyword_modifier_smart_magmom-520"><a href="#Incar.keyword_modifier_smart_magmom-520"><span class="linenos">520</span></a>        <span class="c1">#     incar[&quot;NUPDOWN&quot;] = nupdown</span>
</span><span id="Incar.keyword_modifier_smart_magmom-521"><a href="#Incar.keyword_modifier_smart_magmom-521"><span class="linenos">521</span></a>
</span><span id="Incar.keyword_modifier_smart_magmom-522"><a href="#Incar.keyword_modifier_smart_magmom-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="n">magnetic_moments</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The __smart_magmom modifier goes through a series of checks to decide
what to set the MAGMOM as for VASP. In order of priority they are...
    (1) the magmom property attached to each site in the structure object
    (2) the spin property attached to the site's specie
    (3) a value provided explicitly (e.g. {"Co": 0.5})
    (4) a value of 0.6</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_smart_lmaxmix" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_smart_lmaxmix">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_smart_lmaxmix</span><span class="signature">(structure, lmaxmix_config)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_smart_lmaxmix-524"><a href="#Incar.keyword_modifier_smart_lmaxmix-524"><span class="linenos">524</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-525"><a href="#Incar.keyword_modifier_smart_lmaxmix-525"><span class="linenos">525</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_lmaxmix</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">lmaxmix_config</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-526"><a href="#Incar.keyword_modifier_smart_lmaxmix-526"><span class="linenos">526</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-527"><a href="#Incar.keyword_modifier_smart_lmaxmix-527"><span class="linenos">527</span></a><span class="sd">        This modifier sets LMAXMIX if there are any d or f electrons present</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-528"><a href="#Incar.keyword_modifier_smart_lmaxmix-528"><span class="linenos">528</span></a><span class="sd">        in the structure.</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-529"><a href="#Incar.keyword_modifier_smart_lmaxmix-529"><span class="linenos">529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-530"><a href="#Incar.keyword_modifier_smart_lmaxmix-530"><span class="linenos">530</span></a>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-531"><a href="#Incar.keyword_modifier_smart_lmaxmix-531"><span class="linenos">531</span></a>        <span class="c1"># COMMENT (from pymatgen team):</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-532"><a href="#Incar.keyword_modifier_smart_lmaxmix-532"><span class="linenos">532</span></a>        <span class="c1"># Note that if the user explicitly sets LMAXMIX in settings it will</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-533"><a href="#Incar.keyword_modifier_smart_lmaxmix-533"><span class="linenos">533</span></a>        <span class="c1"># override this logic.</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-534"><a href="#Incar.keyword_modifier_smart_lmaxmix-534"><span class="linenos">534</span></a>        <span class="c1"># Previously, this was only set if Hubbard U was enabled as per the</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-535"><a href="#Incar.keyword_modifier_smart_lmaxmix-535"><span class="linenos">535</span></a>        <span class="c1"># VASP manual but following an investigation it was determined that</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-536"><a href="#Incar.keyword_modifier_smart_lmaxmix-536"><span class="linenos">536</span></a>        <span class="c1"># this would lead to a significant difference between SCF -&gt; NonSCF</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-537"><a href="#Incar.keyword_modifier_smart_lmaxmix-537"><span class="linenos">537</span></a>        <span class="c1"># even without Hubbard U enabled. Thanks to Andrew Rosen for</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-538"><a href="#Incar.keyword_modifier_smart_lmaxmix-538"><span class="linenos">538</span></a>        <span class="c1"># investigating and reporting.</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-539"><a href="#Incar.keyword_modifier_smart_lmaxmix-539"><span class="linenos">539</span></a>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-540"><a href="#Incar.keyword_modifier_smart_lmaxmix-540"><span class="linenos">540</span></a>        <span class="c1"># first iterate through all elements and check for f-electrons</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-541"><a href="#Incar.keyword_modifier_smart_lmaxmix-541"><span class="linenos">541</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">56</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-542"><a href="#Incar.keyword_modifier_smart_lmaxmix-542"><span class="linenos">542</span></a>            <span class="k">return</span> <span class="mi">6</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-543"><a href="#Incar.keyword_modifier_smart_lmaxmix-543"><span class="linenos">543</span></a>        <span class="c1"># now check for elements that contain d-electrons</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-544"><a href="#Incar.keyword_modifier_smart_lmaxmix-544"><span class="linenos">544</span></a>        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-545"><a href="#Incar.keyword_modifier_smart_lmaxmix-545"><span class="linenos">545</span></a>            <span class="k">return</span> <span class="mi">4</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-546"><a href="#Incar.keyword_modifier_smart_lmaxmix-546"><span class="linenos">546</span></a>        <span class="c1"># otherwise use the default for VASP</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-547"><a href="#Incar.keyword_modifier_smart_lmaxmix-547"><span class="linenos">547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_lmaxmix-548"><a href="#Incar.keyword_modifier_smart_lmaxmix-548"><span class="linenos">548</span></a>            <span class="k">return</span> <span class="mi">2</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>This modifier sets LMAXMIX if there are any d or f electrons present
in the structure.</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_smart_ldau" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_smart_ldau">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_smart_ldau</span><span class="signature">(structure, ldau_config)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_smart_ldau-550"><a href="#Incar.keyword_modifier_smart_ldau-550"><span class="linenos">550</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_smart_ldau-551"><a href="#Incar.keyword_modifier_smart_ldau-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_ldau</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ldau_config</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_ldau-552"><a href="#Incar.keyword_modifier_smart_ldau-552"><span class="linenos">552</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_ldau-553"><a href="#Incar.keyword_modifier_smart_ldau-553"><span class="linenos">553</span></a><span class="sd">        This modifier handles a series of keyword arguments that are associated</span>
</span><span id="Incar.keyword_modifier_smart_ldau-554"><a href="#Incar.keyword_modifier_smart_ldau-554"><span class="linenos">554</span></a><span class="sd">        with LDAU, including LDAUJ, LDAUL, LDAUTYPE, LDAUU, LDAUPRINT, and LMAXMIX.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-555"><a href="#Incar.keyword_modifier_smart_ldau-555"><span class="linenos">555</span></a><span class="sd">        Therefore, a complex dictionary is passed to this. The format looks like this...</span>
</span><span id="Incar.keyword_modifier_smart_ldau-556"><a href="#Incar.keyword_modifier_smart_ldau-556"><span class="linenos">556</span></a><span class="sd">            LDAU__multiple_keywords__smart_ldau = dict(</span>
</span><span id="Incar.keyword_modifier_smart_ldau-557"><a href="#Incar.keyword_modifier_smart_ldau-557"><span class="linenos">557</span></a><span class="sd">                LDAU__auto=True,</span>
</span><span id="Incar.keyword_modifier_smart_ldau-558"><a href="#Incar.keyword_modifier_smart_ldau-558"><span class="linenos">558</span></a><span class="sd">                LDAUTYPE=2,</span>
</span><span id="Incar.keyword_modifier_smart_ldau-559"><a href="#Incar.keyword_modifier_smart_ldau-559"><span class="linenos">559</span></a><span class="sd">                LDAUPRINT=1,</span>
</span><span id="Incar.keyword_modifier_smart_ldau-560"><a href="#Incar.keyword_modifier_smart_ldau-560"><span class="linenos">560</span></a><span class="sd">                LDAUJ={...},</span>
</span><span id="Incar.keyword_modifier_smart_ldau-561"><a href="#Incar.keyword_modifier_smart_ldau-561"><span class="linenos">561</span></a><span class="sd">                LDAUL={...},</span>
</span><span id="Incar.keyword_modifier_smart_ldau-562"><a href="#Incar.keyword_modifier_smart_ldau-562"><span class="linenos">562</span></a><span class="sd">                LDAUU={...},</span>
</span><span id="Incar.keyword_modifier_smart_ldau-563"><a href="#Incar.keyword_modifier_smart_ldau-563"><span class="linenos">563</span></a><span class="sd">                LMAXMIX__auto=True,</span>
</span><span id="Incar.keyword_modifier_smart_ldau-564"><a href="#Incar.keyword_modifier_smart_ldau-564"><span class="linenos">564</span></a><span class="sd">                )</span>
</span><span id="Incar.keyword_modifier_smart_ldau-565"><a href="#Incar.keyword_modifier_smart_ldau-565"><span class="linenos">565</span></a><span class="sd">        The LDAUJ, LDAUL, and LDAUU values can be a dictionary of elements to</span>
</span><span id="Incar.keyword_modifier_smart_ldau-566"><a href="#Incar.keyword_modifier_smart_ldau-566"><span class="linenos">566</span></a><span class="sd">        value, or (most commonly) a nested dictionary. For example...</span>
</span><span id="Incar.keyword_modifier_smart_ldau-567"><a href="#Incar.keyword_modifier_smart_ldau-567"><span class="linenos">567</span></a><span class="sd">            LDAUJ = {&quot;F&quot;:{&quot;Co&quot;:0}}</span>
</span><span id="Incar.keyword_modifier_smart_ldau-568"><a href="#Incar.keyword_modifier_smart_ldau-568"><span class="linenos">568</span></a><span class="sd">        This would mean if the structure is a fluoride, set the LDAUJ for Co to 0.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-569"><a href="#Incar.keyword_modifier_smart_ldau-569"><span class="linenos">569</span></a><span class="sd">        If there are multiple options here (e.g. for fluorides and oxides), then</span>
</span><span id="Incar.keyword_modifier_smart_ldau-570"><a href="#Incar.keyword_modifier_smart_ldau-570"><span class="linenos">570</span></a><span class="sd">        priority is placed on the most electronegative element. This would mean</span>
</span><span id="Incar.keyword_modifier_smart_ldau-571"><a href="#Incar.keyword_modifier_smart_ldau-571"><span class="linenos">571</span></a><span class="sd">        some thing like yttrium oxide fluoride would be treated as a fluoride over</span>
</span><span id="Incar.keyword_modifier_smart_ldau-572"><a href="#Incar.keyword_modifier_smart_ldau-572"><span class="linenos">572</span></a><span class="sd">        an oxide.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-573"><a href="#Incar.keyword_modifier_smart_ldau-573"><span class="linenos">573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_ldau-574"><a href="#Incar.keyword_modifier_smart_ldau-574"><span class="linenos">574</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-575"><a href="#Incar.keyword_modifier_smart_ldau-575"><span class="linenos">575</span></a>        <span class="c1"># first we need to go through the LDAUJ, LDAUL, and LDAUU keywords and</span>
</span><span id="Incar.keyword_modifier_smart_ldau-576"><a href="#Incar.keyword_modifier_smart_ldau-576"><span class="linenos">576</span></a>        <span class="c1"># see what their values are. If all of these end up be 0 for all elements</span>
</span><span id="Incar.keyword_modifier_smart_ldau-577"><a href="#Incar.keyword_modifier_smart_ldau-577"><span class="linenos">577</span></a>        <span class="c1"># then we actually don&#39;t need LDAU at all! Therefore, we&#39;ll go through</span>
</span><span id="Incar.keyword_modifier_smart_ldau-578"><a href="#Incar.keyword_modifier_smart_ldau-578"><span class="linenos">578</span></a>        <span class="c1"># all of these keywords and build a dictionary of settings to return</span>
</span><span id="Incar.keyword_modifier_smart_ldau-579"><a href="#Incar.keyword_modifier_smart_ldau-579"><span class="linenos">579</span></a>        <span class="c1"># at the end of this function</span>
</span><span id="Incar.keyword_modifier_smart_ldau-580"><a href="#Incar.keyword_modifier_smart_ldau-580"><span class="linenos">580</span></a>        <span class="n">ldau_settings</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Incar.keyword_modifier_smart_ldau-581"><a href="#Incar.keyword_modifier_smart_ldau-581"><span class="linenos">581</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-582"><a href="#Incar.keyword_modifier_smart_ldau-582"><span class="linenos">582</span></a>        <span class="c1"># To help decide how we set these values, let&#39;s check what the most</span>
</span><span id="Incar.keyword_modifier_smart_ldau-583"><a href="#Incar.keyword_modifier_smart_ldau-583"><span class="linenos">583</span></a>        <span class="c1"># electronegative element is, which will be last in the sorted composition</span>
</span><span id="Incar.keyword_modifier_smart_ldau-584"><a href="#Incar.keyword_modifier_smart_ldau-584"><span class="linenos">584</span></a>        <span class="n">most_electroneg</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span>
</span><span id="Incar.keyword_modifier_smart_ldau-585"><a href="#Incar.keyword_modifier_smart_ldau-585"><span class="linenos">585</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-586"><a href="#Incar.keyword_modifier_smart_ldau-586"><span class="linenos">586</span></a>        <span class="c1"># As we go through these settings, we want see if we are even using LDAU.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-587"><a href="#Incar.keyword_modifier_smart_ldau-587"><span class="linenos">587</span></a>        <span class="c1"># For example if we ran a calculation on NaCl, we&#39;d probably see that</span>
</span><span id="Incar.keyword_modifier_smart_ldau-588"><a href="#Incar.keyword_modifier_smart_ldau-588"><span class="linenos">588</span></a>        <span class="c1"># all LDAUJ/LDAUL/LDAUU values are just 0. In that case, we can just</span>
</span><span id="Incar.keyword_modifier_smart_ldau-589"><a href="#Incar.keyword_modifier_smart_ldau-589"><span class="linenos">589</span></a>        <span class="c1"># throw away (i.e. turn off) all LDAU settings. Therefore, we have a term</span>
</span><span id="Incar.keyword_modifier_smart_ldau-590"><a href="#Incar.keyword_modifier_smart_ldau-590"><span class="linenos">590</span></a>        <span class="c1"># &quot;using_ldau&quot; that is false until proven otherwise.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-591"><a href="#Incar.keyword_modifier_smart_ldau-591"><span class="linenos">591</span></a>        <span class="n">using_ldau</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Incar.keyword_modifier_smart_ldau-592"><a href="#Incar.keyword_modifier_smart_ldau-592"><span class="linenos">592</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-593"><a href="#Incar.keyword_modifier_smart_ldau-593"><span class="linenos">593</span></a>        <span class="k">for</span> <span class="n">ldau_keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUL&quot;</span><span class="p">,</span> <span class="s2">&quot;LDAUU&quot;</span><span class="p">]:</span>
</span><span id="Incar.keyword_modifier_smart_ldau-594"><a href="#Incar.keyword_modifier_smart_ldau-594"><span class="linenos">594</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-595"><a href="#Incar.keyword_modifier_smart_ldau-595"><span class="linenos">595</span></a>            <span class="c1"># grab the sub-dictionary that maps elements to this keyword.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-596"><a href="#Incar.keyword_modifier_smart_ldau-596"><span class="linenos">596</span></a>            <span class="c1"># If it&#39;s not there, just use an empty dictionary.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-597"><a href="#Incar.keyword_modifier_smart_ldau-597"><span class="linenos">597</span></a>            <span class="n">keyword_config</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ldau_keyword</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Incar.keyword_modifier_smart_ldau-598"><a href="#Incar.keyword_modifier_smart_ldau-598"><span class="linenos">598</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-599"><a href="#Incar.keyword_modifier_smart_ldau-599"><span class="linenos">599</span></a>            <span class="c1"># check if the most electronegative element is in the override_values</span>
</span><span id="Incar.keyword_modifier_smart_ldau-600"><a href="#Incar.keyword_modifier_smart_ldau-600"><span class="linenos">600</span></a>            <span class="c1"># and if so, see if it has a subdictionary in it. We use this</span>
</span><span id="Incar.keyword_modifier_smart_ldau-601"><a href="#Incar.keyword_modifier_smart_ldau-601"><span class="linenos">601</span></a>            <span class="c1"># dictionary as our base one to pull values from.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-602"><a href="#Incar.keyword_modifier_smart_ldau-602"><span class="linenos">602</span></a>            <span class="k">if</span> <span class="n">most_electroneg</span> <span class="ow">in</span> <span class="n">keyword_config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Incar.keyword_modifier_smart_ldau-603"><a href="#Incar.keyword_modifier_smart_ldau-603"><span class="linenos">603</span></a>                <span class="n">keyword_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">],</span> <span class="nb">dict</span>
</span><span id="Incar.keyword_modifier_smart_ldau-604"><a href="#Incar.keyword_modifier_smart_ldau-604"><span class="linenos">604</span></a>            <span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_ldau-605"><a href="#Incar.keyword_modifier_smart_ldau-605"><span class="linenos">605</span></a>                <span class="n">keyword_config</span> <span class="o">=</span> <span class="n">keyword_config</span><span class="p">[</span><span class="n">most_electroneg</span><span class="p">]</span>
</span><span id="Incar.keyword_modifier_smart_ldau-606"><a href="#Incar.keyword_modifier_smart_ldau-606"><span class="linenos">606</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-607"><a href="#Incar.keyword_modifier_smart_ldau-607"><span class="linenos">607</span></a>            <span class="c1"># now iterate through all the sites and grab the assigned value. If nothing</span>
</span><span id="Incar.keyword_modifier_smart_ldau-608"><a href="#Incar.keyword_modifier_smart_ldau-608"><span class="linenos">608</span></a>            <span class="c1"># is set then the default is 0.</span>
</span><span id="Incar.keyword_modifier_smart_ldau-609"><a href="#Incar.keyword_modifier_smart_ldau-609"><span class="linenos">609</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Incar.keyword_modifier_smart_ldau-610"><a href="#Incar.keyword_modifier_smart_ldau-610"><span class="linenos">610</span></a>                <span class="n">keyword_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Incar.keyword_modifier_smart_ldau-611"><a href="#Incar.keyword_modifier_smart_ldau-611"><span class="linenos">611</span></a>                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span>
</span><span id="Incar.keyword_modifier_smart_ldau-612"><a href="#Incar.keyword_modifier_smart_ldau-612"><span class="linenos">612</span></a>            <span class="p">]</span>
</span><span id="Incar.keyword_modifier_smart_ldau-613"><a href="#Incar.keyword_modifier_smart_ldau-613"><span class="linenos">613</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-614"><a href="#Incar.keyword_modifier_smart_ldau-614"><span class="linenos">614</span></a>            <span class="c1"># now that we have this keyword all set, we add it to our results</span>
</span><span id="Incar.keyword_modifier_smart_ldau-615"><a href="#Incar.keyword_modifier_smart_ldau-615"><span class="linenos">615</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="n">ldau_keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
</span><span id="Incar.keyword_modifier_smart_ldau-616"><a href="#Incar.keyword_modifier_smart_ldau-616"><span class="linenos">616</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-617"><a href="#Incar.keyword_modifier_smart_ldau-617"><span class="linenos">617</span></a>            <span class="c1"># check to see if we are using ldau here (i.e. any value is not 0)</span>
</span><span id="Incar.keyword_modifier_smart_ldau-618"><a href="#Incar.keyword_modifier_smart_ldau-618"><span class="linenos">618</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_ldau-619"><a href="#Incar.keyword_modifier_smart_ldau-619"><span class="linenos">619</span></a>                <span class="n">using_ldau</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Incar.keyword_modifier_smart_ldau-620"><a href="#Incar.keyword_modifier_smart_ldau-620"><span class="linenos">620</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-621"><a href="#Incar.keyword_modifier_smart_ldau-621"><span class="linenos">621</span></a>        <span class="c1"># now check if we actaully need LDAU here. If not, we can throw out all</span>
</span><span id="Incar.keyword_modifier_smart_ldau-622"><a href="#Incar.keyword_modifier_smart_ldau-622"><span class="linenos">622</span></a>        <span class="c1"># settings and just return an empty dictionary</span>
</span><span id="Incar.keyword_modifier_smart_ldau-623"><a href="#Incar.keyword_modifier_smart_ldau-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="n">using_ldau</span> <span class="ow">and</span> <span class="s2">&quot;LDAU__auto&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_ldau-624"><a href="#Incar.keyword_modifier_smart_ldau-624"><span class="linenos">624</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Incar.keyword_modifier_smart_ldau-625"><a href="#Incar.keyword_modifier_smart_ldau-625"><span class="linenos">625</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_ldau-626"><a href="#Incar.keyword_modifier_smart_ldau-626"><span class="linenos">626</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="Incar.keyword_modifier_smart_ldau-627"><a href="#Incar.keyword_modifier_smart_ldau-627"><span class="linenos">627</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-628"><a href="#Incar.keyword_modifier_smart_ldau-628"><span class="linenos">628</span></a>        <span class="c1"># The remaining LDAU keywords are LDAUPRINT and LDAUTYPE, which we just</span>
</span><span id="Incar.keyword_modifier_smart_ldau-629"><a href="#Incar.keyword_modifier_smart_ldau-629"><span class="linenos">629</span></a>        <span class="c1"># leave at what is set in the input</span>
</span><span id="Incar.keyword_modifier_smart_ldau-630"><a href="#Incar.keyword_modifier_smart_ldau-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="s2">&quot;LDAUPRINT&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_ldau-631"><a href="#Incar.keyword_modifier_smart_ldau-631"><span class="linenos">631</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span>
</span><span id="Incar.keyword_modifier_smart_ldau-632"><a href="#Incar.keyword_modifier_smart_ldau-632"><span class="linenos">632</span></a>        <span class="k">if</span> <span class="s2">&quot;LDAUTYPE&quot;</span> <span class="ow">in</span> <span class="n">ldau_config</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_ldau-633"><a href="#Incar.keyword_modifier_smart_ldau-633"><span class="linenos">633</span></a>            <span class="n">ldau_settings</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ldau_config</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span>
</span><span id="Incar.keyword_modifier_smart_ldau-634"><a href="#Incar.keyword_modifier_smart_ldau-634"><span class="linenos">634</span></a>
</span><span id="Incar.keyword_modifier_smart_ldau-635"><a href="#Incar.keyword_modifier_smart_ldau-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="n">ldau_settings</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>This modifier handles a series of keyword arguments that are associated
with LDAU, including LDAUJ, LDAUL, LDAUTYPE, LDAUU, LDAUPRINT, and LMAXMIX.
Therefore, a complex dictionary is passed to this. The format looks like this...
    LDAU__multiple_keywords__smart_ldau = dict(
        LDAU__auto=True,
        LDAUTYPE=2,
        LDAUPRINT=1,
        LDAUJ={...},
        LDAUL={...},
        LDAUU={...},
        LMAXMIX__auto=True,
        )
The LDAUJ, LDAUL, and LDAUU values can be a dictionary of elements to
value, or (most commonly) a nested dictionary. For example...
    LDAUJ = {"F":{"Co":0}}
This would mean if the structure is a fluoride, set the LDAUJ for Co to 0.
If there are multiple options here (e.g. for fluorides and oxides), then
priority is placed on the most electronegative element. This would mean
some thing like yttrium oxide fluoride would be treated as a fluoride over
an oxide.</p>
</div>


                            </div>
                            <div id="Incar.keyword_modifier_smart_ismear" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Incar.keyword_modifier_smart_ismear">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">keyword_modifier_smart_ismear</span><span class="signature">(structure, ismear_config)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Incar.keyword_modifier_smart_ismear-637"><a href="#Incar.keyword_modifier_smart_ismear-637"><span class="linenos">637</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Incar.keyword_modifier_smart_ismear-638"><a href="#Incar.keyword_modifier_smart_ismear-638"><span class="linenos">638</span></a>    <span class="k">def</span> <span class="nf">keyword_modifier_smart_ismear</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">ismear_config</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_ismear-639"><a href="#Incar.keyword_modifier_smart_ismear-639"><span class="linenos">639</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_ismear-640"><a href="#Incar.keyword_modifier_smart_ismear-640"><span class="linenos">640</span></a><span class="sd">        The smearing value used here depends on if we have a semiconductor,</span>
</span><span id="Incar.keyword_modifier_smart_ismear-641"><a href="#Incar.keyword_modifier_smart_ismear-641"><span class="linenos">641</span></a><span class="sd">        insulator, or metal. This modifier makes a &quot;best-guess&quot; on what the</span>
</span><span id="Incar.keyword_modifier_smart_ismear-642"><a href="#Incar.keyword_modifier_smart_ismear-642"><span class="linenos">642</span></a><span class="sd">        material is and uses the proper smearing type. Note that if this</span>
</span><span id="Incar.keyword_modifier_smart_ismear-643"><a href="#Incar.keyword_modifier_smart_ismear-643"><span class="linenos">643</span></a><span class="sd">        guess is wrong, it is useful to have the IncorrectSmearing error</span>
</span><span id="Incar.keyword_modifier_smart_ismear-644"><a href="#Incar.keyword_modifier_smart_ismear-644"><span class="linenos">644</span></a><span class="sd">        handler to fix this as VASP runs.</span>
</span><span id="Incar.keyword_modifier_smart_ismear-645"><a href="#Incar.keyword_modifier_smart_ismear-645"><span class="linenos">645</span></a>
</span><span id="Incar.keyword_modifier_smart_ismear-646"><a href="#Incar.keyword_modifier_smart_ismear-646"><span class="linenos">646</span></a><span class="sd">        Read more about the VASP recommended ISMEAR settings here:</span>
</span><span id="Incar.keyword_modifier_smart_ismear-647"><a href="#Incar.keyword_modifier_smart_ismear-647"><span class="linenos">647</span></a><span class="sd">            https://www.vasp.at/wiki/index.php/ISMEAR</span>
</span><span id="Incar.keyword_modifier_smart_ismear-648"><a href="#Incar.keyword_modifier_smart_ismear-648"><span class="linenos">648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Incar.keyword_modifier_smart_ismear-649"><a href="#Incar.keyword_modifier_smart_ismear-649"><span class="linenos">649</span></a>
</span><span id="Incar.keyword_modifier_smart_ismear-650"><a href="#Incar.keyword_modifier_smart_ismear-650"><span class="linenos">650</span></a>        <span class="c1"># for now we just go through the structure and if all elements are</span>
</span><span id="Incar.keyword_modifier_smart_ismear-651"><a href="#Incar.keyword_modifier_smart_ismear-651"><span class="linenos">651</span></a>        <span class="c1"># metals, then we say it&#39;s a metal. Otherwise, we treat the structure</span>
</span><span id="Incar.keyword_modifier_smart_ismear-652"><a href="#Incar.keyword_modifier_smart_ismear-652"><span class="linenos">652</span></a>        <span class="c1"># as a semiconductor or insulator.</span>
</span><span id="Incar.keyword_modifier_smart_ismear-653"><a href="#Incar.keyword_modifier_smart_ismear-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">is_metal</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="p">):</span>
</span><span id="Incar.keyword_modifier_smart_ismear-654"><a href="#Incar.keyword_modifier_smart_ismear-654"><span class="linenos">654</span></a>            <span class="n">ismear_settings</span> <span class="o">=</span> <span class="n">ismear_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metal&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Incar.keyword_modifier_smart_ismear-655"><a href="#Incar.keyword_modifier_smart_ismear-655"><span class="linenos">655</span></a>
</span><span id="Incar.keyword_modifier_smart_ismear-656"><a href="#Incar.keyword_modifier_smart_ismear-656"><span class="linenos">656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Incar.keyword_modifier_smart_ismear-657"><a href="#Incar.keyword_modifier_smart_ismear-657"><span class="linenos">657</span></a>            <span class="n">ismear_settings</span> <span class="o">=</span> <span class="n">ismear_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;non-metal&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Incar.keyword_modifier_smart_ismear-658"><a href="#Incar.keyword_modifier_smart_ismear-658"><span class="linenos">658</span></a>
</span><span id="Incar.keyword_modifier_smart_ismear-659"><a href="#Incar.keyword_modifier_smart_ismear-659"><span class="linenos">659</span></a>        <span class="k">return</span> <span class="n">ismear_settings</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>The smearing value used here depends on if we have a semiconductor,
insulator, or metal. This modifier makes a "best-guess" on what the
material is and uses the proper smearing type. Note that if this
guess is wrong, it is useful to have the IncorrectSmearing error
handler to fix this as VASP runs.</p>

<p>Read more about the VASP recommended ISMEAR settings here:
    https://www.vasp.at/wiki/index.php/ISMEAR</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="Incar.get" class="function">get</dd>
                <dd id="Incar.setdefault" class="function">setdefault</dd>
                <dd id="Incar.pop" class="function">pop</dd>
                <dd id="Incar.popitem" class="function">popitem</dd>
                <dd id="Incar.keys" class="function">keys</dd>
                <dd id="Incar.items" class="function">items</dd>
                <dd id="Incar.values" class="function">values</dd>
                <dd id="Incar.update" class="function">update</dd>
                <dd id="Incar.fromkeys" class="function">fromkeys</dd>
                <dd id="Incar.clear" class="function">clear</dd>
                <dd id="Incar.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>